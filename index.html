<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cypher - Advanced Solana Portfolio Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main App Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-chart-line"></i> Cypher
            </div>
            <div class="header-actions">
                <div class="search-container">
                    <input type="text" id="globalSearch" class="search-input" placeholder="Search tokens...">
                    <i class="fas fa-search search-icon"></i>
                    <div id="searchResults" class="search-results"></div>
                </div>
                <div class="wallet-section">
                    <div class="network-indicator">
                        <span class="network-dot"></span>
                        <span>Mainnet</span>
                    </div>
                    <button id="connectWallet" class="wallet-btn btn-primary">
                        <i class="fas fa-plug"></i> <span>Connect Wallet</span>
                    </button>
                    <button id="helpBtn" class="icon-btn" onclick="showHelp()" title="Help & Tutorial">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-container">
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchSection('portfolio')" data-tooltip="View your portfolio performance and holdings">
                <i class="fas fa-chart-pie"></i> Portfolio
            </div>
            <div class="nav-tab" onclick="switchSection('analytics')" data-tooltip="Advanced trading analytics and insights">
                <i class="fas fa-brain"></i> Analytics
            </div>
            <div class="nav-tab" onclick="switchSection('market')" data-tooltip="Market overview and trending tokens">
                <i class="fas fa-globe"></i> Market
            </div>
            <div class="nav-tab" onclick="switchSection('whale')" data-tooltip="Whale tracking and social trading">
                <i class="fas fa-fish"></i> Whale
            </div>
            <div class="nav-tab" onclick="switchSection('alerts')" data-tooltip="Price alerts and notifications">
                <i class="fas fa-bell"></i> Alerts
            </div>
            <div class="nav-tab" onclick="switchSection('social')" data-tooltip="Social features and achievements">
                <i class="fas fa-users"></i> Social
            </div>
        </div>
    </div>

    <main class="content">
        <!-- Portfolio Section -->
        <section id="portfolio" class="section active">
            <!-- Quick Stats Row -->
            <div class="grid grid-4 stat-cards">
                <div class="stat-card primary">
                    <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                    <div class="stat-value" id="totalValue">$0.00</div>
                    <div class="stat-label">Portfolio Value</div>
                    <div class="stat-change"><span id="totalChange">Connect wallet to view</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-coins"></i></div>
                    <div class="stat-value" id="tokenCount">0</div>
                    <div class="stat-label">Holdings</div>
                    <div class="stat-change"><span>Tokens</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="stat-value" id="portfolioGain">0%</div>
                    <div class="stat-label">24h Change</div>
                    <div class="stat-change"><span id="gainAmount">$0.00</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="stat-value" id="riskScore">-</div>
                    <div class="stat-label">Risk Score</div>
                    <div class="stat-change"><span id="riskLevel">Not analyzed</span></div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-grid">
                <div class="card chart-card">
                    <div class="card-header">
                        <h3 class="card-title">Portfolio Performance</h3>
                        <div class="chart-controls">
                            <button class="btn btn-sm" onclick="changeChartTimeframe('1D')">1D</button>
                            <button class="btn btn-sm active" onclick="changeChartTimeframe('7D')">7D</button>
                            <button class="btn btn-sm" onclick="changeChartTimeframe('30D')">30D</button>
                            <button class="btn btn-sm" onclick="changeChartTimeframe('1Y')">1Y</button>
                            <button class="btn btn-secondary" onclick="refreshPortfolio()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="portfolioChart"></canvas>
                    </div>
                </div>

                <div class="card chart-card">
                    <div class="card-header">
                        <h3 class="card-title">Asset Allocation</h3>
                        <div class="allocation-legend" id="allocationLegend"></div>
                    </div>
                    <div class="chart-container allocation-chart">
                        <canvas id="allocationChart"></canvas>
                        <div class="allocation-center">
                            <div class="total-value" id="centerValue">$0</div>
                            <div class="allocation-label">Total Value</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Holdings & Analysis -->
            <div class="portfolio-grid">
                <div class="card holdings-card">
                    <div class="card-header">
                        <h3 class="card-title">Token Holdings</h3>
                        <div class="holdings-controls">
                            <select class="form-select" id="sortHoldings" onchange="sortHoldings()">
                                <option value="value">Sort by Value</option>
                                <option value="change">Sort by Change</option>
                                <option value="alphabetical">Sort A-Z</option>
                            </select>
                            <button class="btn btn-secondary" onclick="exportHoldings()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div id="tokenList" class="token-list">
                        <div class="empty-state">
                            <i class="fas fa-wallet" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                            <h4>No Holdings Found</h4>
                            <p>Connect your wallet to view your token holdings and start tracking your portfolio performance.</p>
                            <button class="btn btn-primary" onclick="connectWallet()">
                                <i class="fas fa-plug"></i> Connect Wallet
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card analysis-card">
                    <div class="card-header">
                        <h3 class="card-title">Portfolio Analysis</h3>
                        <button class="btn btn-secondary" onclick="generateAnalysisReport()">
                            <i class="fas fa-file-alt"></i> Report
                        </button>
                    </div>
                    <div class="analysis-metrics">
                        <div class="metric-row">
                            <span class="metric-label">Diversification Score</span>
                            <div class="metric-value">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="diversificationProgress" style="width: 0%"></div>
                                </div>
                                <span id="diversificationScore">0/100</span>
                            </div>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Largest Position</span>
                            <span class="metric-value" id="largestPosition">-</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Total Transactions</span>
                            <span class="metric-value" id="totalTransactions">0</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Avg. Hold Time</span>
                            <span class="metric-value" id="avgHoldTime">-</span>
                        </div>
                    </div>
                    <div class="risk-indicators">
                        <h4>Risk Indicators</h4>
                        <div class="risk-item">
                            <span>Concentration Risk</span>
                            <span class="risk-badge" id="concentrationRisk">Low</span>
                        </div>
                        <div class="risk-item">
                            <span>Volatility Risk</span>
                            <span class="risk-badge" id="volatilityRisk">Medium</span>
                        </div>
                        <div class="risk-item">
                            <span>Liquidity Risk</span>
                            <span class="risk-badge" id="liquidityRisk">Low</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="section">
            <div class="analytics-header">
                <h2>Advanced Analytics</h2>
                <p>Deep insights into your trading performance and market opportunities</p>
            </div>

            <div class="grid grid-3 analytics-cards">
                <div class="stat-card analytics">
                    <div class="stat-icon"><i class="fas fa-chart-bar"></i></div>
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-change"><span id="totalTrades">0 trades</span></div>
                </div>
                <div class="stat-card analytics">
                    <div class="stat-icon"><i class="fas fa-fire"></i></div>
                    <div class="stat-value" id="bestPerformer">-</div>
                    <div class="stat-label">Best Performer</div>
                    <div class="stat-change"><span id="bestGain">+0%</span></div>
                </div>
                <div class="stat-card analytics">
                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="stat-value" id="sharpeRatio">0.0</div>
                    <div class="stat-label">Sharpe Ratio</div>
                    <div class="stat-change"><span>Risk-adjusted return</span></div>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Performance vs Benchmarks</h3>
                        <select class="form-select" onchange="changeBenchmark(this.value)">
                            <option value="sol">vs SOL</option>
                            <option value="btc">vs BTC</option>
                            <option value="eth">vs ETH</option>
                            <option value="market">vs Market</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="benchmarkChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Trading Pattern Analysis</h3>
                    </div>
                    <div class="trading-patterns">
                        <div class="pattern-item">
                            <div class="pattern-icon"><i class="fas fa-clock"></i></div>
                            <div class="pattern-info">
                                <h4>Most Active Time</h4>
                                <p id="mostActiveTime">Analyzing...</p>
                            </div>
                        </div>
                        <div class="pattern-item">
                            <div class="pattern-icon"><i class="fas fa-calendar"></i></div>
                            <div class="pattern-info">
                                <h4>Trading Frequency</h4>
                                <p id="tradingFrequency">Analyzing...</p>
                            </div>
                        </div>
                        <div class="pattern-item">
                            <div class="pattern-icon"><i class="fas fa-hourglass-half"></i></div>
                            <div class="pattern-info">
                                <h4>Avg Position Duration</h4>
                                <p id="avgPositionDuration">Analyzing...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Token Performance Heatmap</h3>
                    </div>
                    <div id="performanceHeatmap" class="heatmap-container">
                        <div class="heatmap-loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Generating heatmap...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Market Section -->
        <section id="market" class="section">
            <div class="market-header">
                <h2>Market Overview</h2>
                <div class="market-controls">
                    <input type="text" class="search-input" placeholder="Search tokens..." id="marketSearch">
                    <select class="form-select" id="marketFilter">
                        <option value="all">All Tokens</option>
                        <option value="trending">Trending</option>
                        <option value="gainers">Top Gainers</option>
                        <option value="losers">Top Losers</option>
                        <option value="volume">High Volume</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-4 market-stats">
                <div class="stat-card market">
                    <div class="stat-icon"><i class="fab fa-solana"></i></div>
                    <div class="stat-value" id="solPrice">Loading...</div>
                    <div class="stat-label">SOL Price</div>
                    <div class="stat-change" id="solChange">...</div>
                </div>
                <div class="stat-card market">
                    <div class="stat-icon"><i class="fas fa-chart-bar"></i></div>
                    <div class="stat-value" id="marketVol">Loading...</div>
                    <div class="stat-label">24h Volume</div>
                    <div class="stat-change" id="volumeChange">...</div>
                </div>
                <div class="stat-card market">
                    <div class="stat-icon"><i class="fas fa-coins"></i></div>
                    <div class="stat-value" id="trackedTokens">0</div>
                    <div class="stat-label">Tracked Tokens</div>
                    <div class="stat-change"><span>Active</span></div>
                </div>
                <div class="stat-card market">
                    <div class="stat-icon"><i class="fas fa-fire"></i></div>
                    <div class="stat-value" id="marketSentiment">Neutral</div>
                    <div class="stat-label">Market Sentiment</div>
                    <div class="stat-change" id="sentimentScore">50/100</div>
                </div>
            </div>

            <div class="market-grid">
                <div class="card market-trends">
                    <div class="card-header">
                        <h3 class="card-title">Trending Tokens</h3>
                        <div class="trend-filters">
                            <button class="btn btn-sm active" onclick="filterTrending('1h')">1H</button>
                            <button class="btn btn-sm" onclick="filterTrending('24h')">24H</button>
                            <button class="btn btn-sm" onclick="filterTrending('7d')">7D</button>
                        </div>
                    </div>
                    <div id="trendingTokens" class="trending-list">
                        <div class="loading"><div class="spinner"></div></div>
                    </div>
                </div>

                <div class="card market-movers">
                    <div class="card-header">
                        <h3 class="card-title">Market Movers</h3>
                        <div class="mover-tabs">
                            <button class="tab-btn active" onclick="showMovers('gainers')">Gainers</button>
                            <button class="tab-btn" onclick="showMovers('losers')">Losers</button>
                        </div>
                    </div>
                    <div id="marketMovers" class="movers-list">
                        <div class="loading"><div class="spinner"></div></div>
                    </div>
                </div>

                <div class="card market-overview">
                    <div class="card-header">
                        <h3 class="card-title">Market Overview</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="marketOverviewChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Whale Section -->
        <section id="whale" class="section">
            <div class="whale-header">
                <h2>Whale Tracking & Social Trading</h2>
                <p>Monitor large transactions and follow successful traders</p>
            </div>

            <div class="grid grid-4 whale-stats">
                <div class="stat-card whale">
                    <div class="stat-icon"><i class="fas fa-fish"></i></div>
                    <div class="stat-value" id="whaleCount">0</div>
                    <div class="stat-label">Whale Transactions</div>
                    <div class="stat-change"><span>Last 24h</span></div>
                </div>
                <div class="stat-card whale">
                    <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                    <div class="stat-value" id="whaleVol">$0</div>
                    <div class="stat-label">Whale Volume</div>
                    <div class="stat-change" id="whaleVolChange">...</div>
                </div>
                <div class="stat-card whale">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-value" id="followedCount">0</div>
                    <div class="stat-label">Followed Wallets</div>
                    <div class="stat-change"><span>Active</span></div>
                </div>
                <div class="stat-card whale">
                    <div class="stat-icon"><i class="fas fa-copy"></i></div>
                    <div class="stat-value" id="copyTrades">0</div>
                    <div class="stat-label">Copy Trades</div>
                    <div class="stat-change"><span>This month</span></div>
                </div>
            </div>

            <div class="whale-grid">
                <div class="card whale-movements">
                    <div class="card-header">
                        <h3 class="card-title">Live Whale Movements</h3>
                        <div class="whale-filters">
                            <select class="form-select" onchange="filterWhaleMovements(this.value)">
                                <option value="all">All Tokens</option>
                                <option value="holdings">My Holdings Only</option>
                                <option value="trending">Trending Tokens</option>
                            </select>
                            <button class="btn btn-secondary" onclick="refreshWhaleData()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div id="whaleMovements" class="whale-feed">
                        <div class="loading"><div class="spinner"></div></div>
                    </div>
                </div>

                <div class="card followed-wallets">
                    <div class="card-header">
                        <h3 class="card-title">Followed Wallets</h3>
                        <button class="btn btn-primary" onclick="openFollowModal()">
                            <i class="fas fa-plus"></i> Follow
                        </button>
                    </div>
                    <div id="followedWallets" class="wallets-list">
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h4>No Wallets Followed</h4>
                            <p>Start following successful traders to copy their strategies and get notifications about their activities.</p>
                            <button class="btn btn-primary" onclick="openFollowModal()">
                                <i class="fas fa-plus"></i> Follow Your First Trader
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card whale-settings">
                    <div class="card-header">
                        <h3 class="card-title">Whale Tracking Settings</h3>
                    </div>
                    <div class="settings-content">
                        <div class="setting-group">
                            <label>Transaction Threshold</label>
                            <div class="threshold-buttons">
                                <button class="btn btn-secondary active" onclick="setWhaleThreshold(20)">20 SOL</button>
                                <button class="btn btn-secondary" onclick="setWhaleThreshold(50)">50 SOL</button>
                                <button class="btn btn-secondary" onclick="setWhaleThreshold(100)">100 SOL</button>
                                <input type="number" id="customThreshold" class="form-input" placeholder="Custom" style="width: 100px;">
                                <button class="btn btn-primary" onclick="setCustomThreshold()">Set</button>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label>Notification Preferences</label>
                            <div class="notification-toggles">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="whaleNotifications" checked>
                                    <span class="toggle-slider"></span>
                                    <span>Whale Alerts</span>
                                </label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="followedTraderNotifications" checked>
                                    <span class="toggle-slider"></span>
                                    <span>Followed Trader Activity</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Alerts Section -->
        <section id="alerts" class="section">
            <div class="alerts-header">
                <h2>Smart Alerts & Notifications</h2>
                <p>Stay informed with advanced price and market alerts</p>
            </div>

            <div class="grid grid-3 alerts-stats">
                <div class="stat-card alerts">
                    <div class="stat-icon"><i class="fas fa-bell"></i></div>
                    <div class="stat-value" id="activeAlerts">0</div>
                    <div class="stat-label">Active Alerts</div>
                    <div class="stat-change"><span id="triggeredToday">0 triggered today</span></div>
                </div>
                <div class="stat-card alerts">
                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="stat-value" id="priceAlerts">0</div>
                    <div class="stat-label">Price Alerts</div>
                    <div class="stat-change"><span>Active</span></div>
                </div>
                <div class="stat-card alerts">
                    <div class="stat-icon"><i class="fas fa-volume-up"></i></div>
                    <div class="stat-value" id="volumeAlerts">0</div>
                    <div class="stat-label">Volume Alerts</div>
                    <div class="stat-change"><span>Monitoring</span></div>
                </div>
            </div>

            <div class="alerts-grid">
                <div class="card alert-creation">
                    <div class="card-header">
                        <h3 class="card-title">Create Alert</h3>
                        <div class="alert-templates">
                            <button class="btn btn-sm" onclick="useAlertTemplate('price')">Price</button>
                            <button class="btn btn-sm" onclick="useAlertTemplate('volume')">Volume</button>
                            <button class="btn btn-sm" onclick="useAlertTemplate('whale')">Whale</button>
                        </div>
                    </div>
                    <div class="alert-form-container">
                        <form id="quickAlertForm" class="quick-alert-form">
                            <div class="form-row">
                                <input type="text" id="alertToken" class="form-input" placeholder="Token symbol (e.g., SOL)" required>
                                <select id="alertType" class="form-select" onchange="updateAlertForm()">
                                    <option value="price_above">Price Above</option>
                                    <option value="price_below">Price Below</option>
                                    <option value="change_percent">% Change</option>
                                    <option value="volume_spike">Volume Spike</option>
                                    <option value="whale_movement">Whale Movement</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <input type="number" id="alertValue" class="form-input" placeholder="Target value" step="0.000001" required>
                                <select id="alertTimeframe" class="form-select">
                                    <option value="instant">Instant</option>
                                    <option value="5m">5 Minutes</option>
                                    <option value="1h">1 Hour</option>
                                    <option value="24h">24 Hours</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary full-width">
                                <i class="fas fa-plus"></i> Create Alert
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card active-alerts">
                    <div class="card-header">
                        <h3 class="card-title">Active Alerts</h3>
                        <div class="alert-actions">
                            <button class="btn btn-secondary" onclick="pauseAllAlerts()">
                                <i class="fas fa-pause"></i> Pause All
                            </button>
                            <button class="btn btn-secondary" onclick="exportAlerts()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div id="alertsList" class="alerts-list">
                        <div class="empty-state">
                            <i class="fas fa-bell"></i>
                            <h4>No Active Alerts</h4>
                            <p>Create your first alert to get notified of important market movements and price changes.</p>
                            <button class="btn btn-primary" onclick="openAlertModal()">
                                <i class="fas fa-plus"></i> Create Your First Alert
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card alert-history">
                    <div class="card-header">
                        <h3 class="card-title">Recent Notifications</h3>
                        <button class="btn btn-secondary" onclick="clearAlertHistory()">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                    <div id="alertHistory" class="alert-history-list">
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <h4>No Recent Notifications</h4>
                            <p>Your notification history will appear here once you start receiving alerts.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Social Section -->
        <section id="social" class="section">
            <div class="social-header">
                <h2>Social Trading & Achievements</h2>
                <p>Connect with the community and track your progress</p>
            </div>

            <div class="grid grid-4 social-stats">
                <div class="stat-card social">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-value" id="followers">0</div>
                    <div class="stat-label">Followers</div>
                    <div class="stat-change" id="followerChange">...</div>
                </div>
                <div class="stat-card social">
                    <div class="stat-icon"><i class="fas fa-user-plus"></i></div>
                    <div class="stat-value" id="following">0</div>
                    <div class="stat-label">Following</div>
                    <div class="stat-change"><span>Traders</span></div>
                </div>
                <div class="stat-card social">
                    <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                    <div class="stat-value" id="socialRank">#-</div>
                    <div class="stat-label">Community Rank</div>
                    <div class="stat-change" id="rankChange">...</div>
                </div>