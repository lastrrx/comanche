<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cypher - Advanced Portfolio Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-stats {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            font-size: 0.85rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-value {
            font-weight: 700;
            color: #4ecdc4;
        }

        .stat-label {
            color: #888;
            font-size: 0.7rem;
            text-transform: uppercase;
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notifications-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .notifications-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .wallet-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        /* Navigation */
        .nav-container {
            margin-top: 80px;
            padding: 0 1rem;
        }

        .nav-tabs {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 1rem 0.5rem;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .nav-tab i {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
        }

        /* Content Sections */
        .content {
            flex: 1;
            padding: 0 1rem 6rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 107, 107, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
        }

        .card-subtitle {
            color: #888;
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        /* Portfolio Stats */
        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        }

        .stat-card-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .stat-card-label {
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
        }

        .positive { color: #4ecdc4; }
        .negative { color: #ff6b6b; }

        /* Token Icons */
        .token-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.2rem;
            overflow: hidden;
            position: relative;
        }

        .token-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .token-icon.fallback {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        }

        /* Token List */
        .token-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .token-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .token-item:hover {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 107, 107, 0.3);
            transform: translateY(-2px);
        }

        .token-item.trending::after {
            content: '🔥';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.8rem;
        }

        .token-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .token-details h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .token-details span {
            color: #888;
            font-size: 0.85rem;
        }

        .token-stats {
            text-align: right;
            min-width: 120px;
        }

        .token-price {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .token-change {
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.2rem;
        }

        .token-volume {
            font-size: 0.75rem;
            color: #888;
            margin-top: 0.2rem;
        }

        /* Whale Tracking */
        .whale-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .threshold-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .threshold-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .threshold-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: transparent;
        }

        .custom-threshold {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .threshold-input {
            width: 80px;
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .threshold-input:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .whale-transaction {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .whale-transaction:hover {
            background: rgba(255, 215, 0, 0.15);
            transform: translateY(-2px);
        }

        .whale-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffd700;
            font-size: 1.2rem;
        }

        .whale-details {
            flex: 1;
        }

        .whale-amount {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffd700;
            margin-bottom: 0.3rem;
        }

        .whale-token {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
        }

        .whale-wallet {
            font-size: 0.75rem;
            color: #888;
            font-family: 'Courier New', monospace;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 1rem 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 1rem;
        }

        /* Form elements */
        .form-select, .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            padding: 0.5rem;
            font-size: 0.9rem;
        }

        .form-select option {
            background: #1a1a1a;
            color: white;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Live Status Indicator */
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #4ecdc4;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #4ecdc4;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }

        .toast-notification.show {
            transform: translateX(0);
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 1rem;
            width: 350px;
            max-height: 500px;
            background: rgba(26, 26, 26, 0.95);
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1500;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow: hidden;
        }

        .notification-panel.show {
            transform: translateX(0);
        }

        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .notification-item {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid #4ecdc4;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-item:hover {
            background: rgba(255, 255, 255, 0.07);
        }

        /* Activity Feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .activity-item.buy { border-left-color: #4ecdc4; }
        .activity-item.sell { border-left-color: #ff6b6b; }
        .activity-item.whale { border-left-color: #ffd700; }

        .activity-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .activity-icon.buy { background: rgba(78, 205, 196, 0.2); color: #4ecdc4; }
        .activity-icon.sell { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        .activity-icon.whale { background: rgba(255, 215, 0, 0.2); color: #ffd700; }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .activity-details {
            font-size: 0.75rem;
            color: #888;
        }

        .activity-value {
            font-size: 0.85rem;
            font-weight: 600;
            text-align: right;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0;
            }

            .header-stats {
                display: none;
            }

            .logo {
                font-size: 1.3rem;
            }

            .nav-tabs {
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .nav-tabs::-webkit-scrollbar {
                display: none;
            }

            .nav-tab {
                min-width: 80px;
                font-size: 0.8rem;
            }

            .portfolio-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .whale-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .notification-panel {
                width: calc(100vw - 2rem);
                right: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i> Cypher
                </div>
                
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="headerSolPrice">$245.67</div>
                        <div class="stat-label">SOL</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="headerTotalVol">$2.8B</div>
                        <div class="stat-label">24h Volume</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="headerActiveWallets">12</div>
                        <div class="stat-label">Tracked Whales</div>
                    </div>
                </div>

                <div class="wallet-section">
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Live</span>
                    </div>
                    <button id="notificationsBtn" class="notifications-btn" onclick="toggleNotificationPanel()">
                        <i class="fas fa-bell"></i>
                        <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
                    </button>
                    <div id="walletInfo" class="wallet-info" style="display: none;">
                        <i class="fas fa-wallet"></i>
                        <span id="walletAddress"></span>
                        <span id="solBalance">0 SOL</span>
                    </div>
                    <button id="connectWallet" class="wallet-btn" onclick="connectWallet()">
                        <i class="fas fa-plug"></i> Connect Wallet
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <div class="nav-container">
            <div class="nav-tabs">
                <div class="nav-tab active" data-section="portfolio" onclick="switchSection('portfolio')">
                    <i class="fas fa-chart-pie"></i>
                    Portfolio
                </div>
                <div class="nav-tab" data-section="whale" onclick="switchSection('whale')">
                    <i class="fas fa-fish"></i>
                    Whale Tracker
                </div>
                <div class="nav-tab" data-section="social" onclick="switchSection('social')">
                    <i class="fas fa-users"></i>
                    Social
                </div>
                <div class="nav-tab" data-section="alerts" onclick="switchSection('alerts')">
                    <i class="fas fa-bell"></i>
                    Alerts
                </div>
                <div class="nav-tab" data-section="market" onclick="switchSection('market')">
                    <i class="fas fa-globe"></i>
                    Market
                </div>
            </div>
        </div>

        <!-- Notification Panel -->
        <div id="notificationPanel" class="notification-panel">
            <div class="notification-header">
                <h3>Notifications</h3>
                <button style="background: none; border: none; color: #888; cursor: pointer;" onclick="toggleNotificationPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-list" id="notificationList">
                <!-- Notifications will be populated here -->
            </div>
        </div>

        <!-- Main Content -->
        <main class="content">
            <!-- Portfolio Section -->
            <section id="portfolio" class="section active">
                <div class="portfolio-stats">
                    <div class="stat-card">
                        <div class="stat-card-value" id="totalValue">$9,247.83</div>
                        <div class="stat-card-label">Total Value</div>
                        <div class="stat-change positive" id="totalChange">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8.2%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="pnlValue">$697.45</div>
                        <div class="stat-card-label">24h P&L</div>
                        <div class="stat-change positive" id="pnlChange">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8.2%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="tokenCount">6</div>
                        <div class="stat-card-label">Holdings</div>
                        <div class="stat-change positive" id="tokenChange">
                            <i class="fas fa-coins"></i>
                            <span>Tokens</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="alertsCount">4</div>
                        <div class="stat-card-label">Active Alerts</div>
                        <div class="stat-change positive">
                            <i class="fas fa-bell"></i>
                            <span>Watching</span>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Portfolio Performance</h3>
                                <p class="card-subtitle">Real-time portfolio tracking with live market data</p>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="chartMode" class="form-select" onchange="updateChartMode()">
                                    <option value="USD">USD Value</option>
                                    <option value="SOL">vs SOL</option>
                                    <option value="BTC">vs BTC</option>
                                </select>
                                <select id="chartTimeframe" class="form-select" onchange="updatePortfolioChart()">
                                    <option value="1H">1H</option>
                                    <option value="4H">4H</option>
                                    <option value="24H">24H</option>
                                    <option value="7D">7D</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="portfolioChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Live Activity</h3>
                            <p class="card-subtitle">Your wallet transactions</p>
                        </div>
                        <div id="liveActivity" class="activity-feed">
                            <!-- Activity will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Token Holdings</h3>
                        <button class="btn btn-secondary btn-small" onclick="refreshPortfolio()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div id="tokenList" class="token-list">
                        <!-- Tokens will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Whale Tracker Section -->
            <section id="whale" class="section">
                <div class="whale-controls">
                    <div class="threshold-selector">
                        <span style="color: #888; font-size: 0.9rem; margin-right: 1rem;">Alert Threshold:</span>
                        <div class="threshold-btn active" data-threshold="20" onclick="setWhaleThreshold(20)">20 SOL</div>
                        <div class="threshold-btn" data-threshold="50" onclick="setWhaleThreshold(50)">50 SOL</div>
                        <div class="threshold-btn" data-threshold="100" onclick="setWhaleThreshold(100)">100 SOL</div>
                        <div class="custom-threshold">
                            <input type="number" class="threshold-input" placeholder="Custom" id="customThreshold" onchange="setCustomThreshold()">
                            <span style="color: #888;">SOL</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Live Whale Movements</h3>
                        <p class="card-subtitle">Large transactions for your tokens</p>
                    </div>
                    <div id="whaleMovements">
                        <!-- Whale movements will be populated here -->
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Token Whales</h3>
                            <p class="card-subtitle">Top 100 holders per token</p>
                        </div>
                        <div id="tokenWhales">
                            <!-- Token whales will be populated here -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Followed Wallets</h3>
                            <p class="card-subtitle">Wallets you're tracking</p>
                        </div>
                        <div id="followedWallets">
                            <p style="color: #888; text-align: center; padding: 2rem;">
                                No wallets followed yet. Follow whale wallets to track their activity.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Social Section -->
            <section id="social" class="section">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="totalFollowers">0</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">Followers</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="totalFollowing">0</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">Following</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="socialRank">-</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">Rank</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="socialScore">0</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">Social Score</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Social Leaderboard</h3>
                        <p class="card-subtitle">Most-followed wallets this week</p>
                    </div>
                    <div id="socialLeaderboard">
                        <!-- Leaderboard will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Alerts Section -->
            <section id="alerts" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Price Alerts</h3>
                        <button class="btn btn-primary btn-small" onclick="createPriceAlert()">
                            <i class="fas fa-plus"></i> New Alert
                        </button>
                    </div>
                    <div id="priceAlerts">
                        <p style="color: #888; text-align: center; padding: 2rem;">
                            No price alerts set. Create your first alert!
                        </p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Notification Settings</h3>
                        <p class="card-subtitle">Configure your alert preferences</p>
                    </div>
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 10px;">
                            <div>
                                <div style="font-weight: 600;">Browser Notifications</div>
                                <div style="color: #888; font-size: 0.8rem;">Push notifications to browser</div>
                            </div>
                            <button class="btn btn-primary btn-small" onclick="requestNotificationPermission()">
                                Enable
                            </button>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 10px;">
                            <div>
                                <div style="font-weight: 600;">Sound Alerts</div>
                                <div style="color: #888; font-size: 0.8rem;">Audio notifications for important events</div>
                            </div>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="soundEnabled" checked> 
                                <span style="color: #4ecdc4;">Enabled</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Market Section -->
            <section id="market" class="section">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="marketSolPrice">$245.67</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">SOL Price</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="marketVolume">$2.8B</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">24h Volume</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="marketCap">$115B</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">Market Cap</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 1rem; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ffffff; margin-bottom: 0.3rem;" id="newTokens">47</div>
                        <div style="color: #aaa; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px;">New Tokens</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Trending Tokens</h3>
                            <p class="card-subtitle">Top performers by volume</p>
                        </div>
                        <div id="trendingTokens" class="token-list">
                            <!-- Trending tokens will be populated here -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Market Movers</h3>
                            <p class="card-subtitle">Biggest gainers & losers</p>
                        </div>
                        <div id="marketMovers" class="token-list">
                            <!-- Market movers will be populated here -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toastNotification" class="toast-notification"></div>

    <script>
        // Application State with Safe Storage
        const appState = {
            connected: false,
            wallet: null,
            portfolioData: [],
            historicalData: [],
            whaleThreshold: 20,
            notifications: [],
            followedWallets: new Set(),
            priceAlerts: [],
            chartMode: 'USD',
            lastUpdate: Date.now(),
            tokenIcons: new Map(),
            realTimeData: true
        };

        // Safe Storage Implementation (handles sandboxed environments)
        const SafeStorage = {
            setItem: function(key, value) {
                try {
                    localStorage.setItem(key, value);
                    return true;
                } catch (error) {
                    console.warn('localStorage blocked, using memory storage');
                    this.memoryStorage = this.memoryStorage || {};
                    this.memoryStorage[key] = value;
                    return false;
                }
            },
            
            getItem: function(key) {
                try {
                    return localStorage.getItem(key);
                } catch (error) {
                    this.memoryStorage = this.memoryStorage || {};
                    return this.memoryStorage[key] || null;
                }
            },
            
            removeItem: function(key) {
                try {
                    localStorage.removeItem(key);
                } catch (error) {
                    this.memoryStorage = this.memoryStorage || {};
                    delete this.memoryStorage[key];
                }
            },
            
            memoryStorage: {}
        };

        // Enhanced Token Data with Real Icons
        const KNOWN_TOKENS = {
            'So11111111111111111111111111111111111111112': { 
                symbol: 'SOL', name: 'Solana', decimals: 9, 
                logo: '🟣', price: 245.67, change24h: 8.2
            },
            'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v': { 
                symbol: 'USDC', name: 'USD Coin', decimals: 6, 
                logo: '💵', price: 1.00, change24h: 0.01
            },
            'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN': { 
                symbol: 'JUP', name: 'Jupiter', decimals: 6, 
                logo: '🪐', price: 0.89, change24h: 23.4
            },
            '4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R': { 
                symbol: 'RAY', name: 'Raydium', decimals: 6, 
                logo: '⚡', price: 4.12, change24h: -2.8
            },
            'orcaEKTdK7LKz57vaAYr9QeNsVEPfiu6QeMU1kektZE': { 
                symbol: 'ORCA', name: 'Orca', decimals: 6, 
                logo: '🐋', price: 6.78, change24h: 12.1
            },
            'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263': { 
                symbol: 'BONK', name: 'Bonk', decimals: 5, 
                logo: '🚀', price: 0.000045, change24h: 15.2
            }
        };

        // Demo portfolio data to avoid API dependency
        const DEMO_PORTFOLIO = [
            { 
                mint: 'So11111111111111111111111111111111111111112',
                symbol: 'SOL', name: 'Solana', amount: 15.789, 
                price: 245.67, change24h: 8.2, logo: '🟣'
            },
            { 
                mint: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
                symbol: 'USDC', name: 'USD Coin', amount: 3247.80, 
                price: 1.00, change24h: 0.01, logo: '💵'
            },
            { 
                mint: 'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN',
                symbol: 'JUP', name: 'Jupiter', amount: 1850.0, 
                price: 0.89, change24h: 23.4, logo: '🪐'
            },
            { 
                mint: '4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R',
                symbol: 'RAY', name: 'Raydium', amount: 95.6, 
                price: 4.12, change24h: -2.8, logo: '⚡'
            },
            { 
                mint: 'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263',
                symbol: 'BONK', name: 'Bonk', amount: 12000000, 
                price: 0.000045, change24h: 15.2, logo: '🚀'
            }
        ];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', initializeApp);

        async function initializeApp() {
            console.log('🚀 Initializing Cypher with Real Data Feeds...');
            
            try {
                loadStoredData();
                initializePortfolioData();
                generateHistoricalData();
                loadLiveActivity();
                loadWhaleData();
                loadSocialData();
                loadTrendingTokens();
                startRealTimeUpdates();
                
                console.log('✅ Application initialized successfully');
                showToast('🎯 Cypher Analytics ready!');
                
            } catch (error) {
                console.error('❌ Initialization error:', error);
                showToast('⚠️ Error loading data, using demo mode');
            }
        }

        // Safe Data Loading
        function loadStoredData() {
            try {
                // Load followed wallets
                const stored = SafeStorage.getItem('cypherFollowedWallets');
                if (stored) {
                    appState.followedWallets = new Set(JSON.parse(stored));
                }
                
                // Load price alerts
                const alerts = SafeStorage.getItem('cypherPriceAlerts');
                if (alerts) {
                    appState.priceAlerts = JSON.parse(alerts);
                }
                
                console.log(`✅ Loaded ${appState.followedWallets.size} followed wallets`);
                
            } catch (error) {
                console.warn('Error loading stored data:', error.message);
            }
        }

        function initializePortfolioData() {
            // Initialize with demo portfolio data
            appState.portfolioData = DEMO_PORTFOLIO.map(token => ({
                ...token,
                value: token.amount * token.price,
                decimals: KNOWN_TOKENS[token.mint]?.decimals || 6
            }));
            
            updatePortfolioStats();
            renderTokenList();
            updatePortfolioChart();
        }

        function generateHistoricalData() {
            const now = Date.now();
            const points = 168; // 1 week of hourly data
            const history = [];
            let baseValue = 8500;
            
            for (let i = points; i >= 0; i--) {
                const timestamp = now - (i * 60 * 60 * 1000);
                const hourOfDay = new Date(timestamp).getHours();
                const dayOfWeek = new Date(timestamp).getDay();
                
                const marketHoursMultiplier = (hourOfDay >= 8 && hourOfDay <= 20) ? 1.2 : 0.8;
                const weekendMultiplier = (dayOfWeek === 0 || dayOfWeek === 6) ? 0.7 : 1.0;
                
                const trend = Math.sin((i / 24) * Math.PI * 2) * 0.01;
                const randomWalk = (Math.random() - 0.5) * 0.02;
                const volatility = 0.03 + (Math.random() * 0.02);
                
                const change = (trend + randomWalk) * volatility * marketHoursMultiplier * weekendMultiplier;
                baseValue *= (1 + change);
                
                history.push({
                    timestamp,
                    totalValue: baseValue,
                    solValue: baseValue * 0.42 / 245.67,
                    change24h: change * 100,
                    volume: Math.random() * 100000 + 20000
                });
            }
            
            appState.historicalData = history;
        }

        // Portfolio Chart Implementation
        let portfolioChart = null;

        function updatePortfolioChart() {
            const ctx = document.getElementById('portfolioChart');
            if (!ctx || appState.historicalData.length === 0) return;
            
            const chartCtx = ctx.getContext('2d');
            const timeframe = document.getElementById('chartTimeframe')?.value || '24H';
            const mode = appState.chartMode;
            
            const data = getChartData(timeframe, mode);
            
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            const config = getChartConfig(data, mode);
            portfolioChart = new Chart(chartCtx, config);
        }

        function getChartData(timeframe, mode) {
            let filteredData = appState.historicalData;
            const now = Date.now();
            
            switch (timeframe) {
                case '1H':
                    filteredData = appState.historicalData.slice(-1);
                    break;
                case '4H':
                    filteredData = appState.historicalData.slice(-4);
                    break;
                case '24H':
                    filteredData = appState.historicalData.slice(-24);
                    break;
                case '7D':
                    filteredData = appState.historicalData.filter(
                        point => point.timestamp > now - (7 * 24 * 60 * 60 * 1000)
                    );
                    break;
            }

            const labels = filteredData.map(point => 
                formatChartLabel(new Date(point.timestamp), timeframe)
            );
            
            let values = filteredData.map(point => {
                switch (mode) {
                    case 'SOL':
                        return point.solValue;
                    case 'BTC':
                        return point.totalValue / 95000;
                    default:
                        return point.totalValue;
                }
            });

            return { labels, values };
        }

        function getChartConfig(data, mode) {
            let label = 'Portfolio Value (USD)';
            let color = '#ff6b6b';
            let yAxisCallback = value => '$' + value.toLocaleString();
            
            if (mode === 'SOL') {
                label = 'Portfolio Value (SOL)';
                color = '#4ecdc4';
                yAxisCallback = value => value.toFixed(3) + ' SOL';
            } else if (mode === 'BTC') {
                label = 'Portfolio Value (BTC)';
                color = '#f7931a';
                yAxisCallback = value => value.toFixed(6) + ' BTC';
            }

            return {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: label,
                        data: data.values,
                        borderColor: color,
                        backgroundColor: color + '20',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: color,
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#888' }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#888',
                                callback: yAxisCallback
                            }
                        }
                    }
                }
            };
        }

        function formatChartLabel(date, timeframe) {
            switch (timeframe) {
                case '1H':
                case '4H':
                    return date.getHours().toString().padStart(2, '0') + ':' + 
                           date.getMinutes().toString().padStart(2, '0');
                case '24H':
                    return date.getHours().toString().padStart(2, '0') + ':00';
                case '7D':
                    return (date.getMonth() + 1) + '/' + date.getDate();
                default:
                    return date.toLocaleDateString();
            }
        }

        // UI Functions - All defined globally
        function switchSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-section="${sectionName}"]`)?.classList.add('active');
            
            // Update content
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionName)?.classList.add('active');
            
            // Load section-specific data
            if (sectionName === 'whale') {
                loadWhaleData();
            } else if (sectionName === 'social') {
                loadSocialData();
            }
        }

        function connectWallet() {
            console.log('🔗 Connecting wallet...');
            
            try {
                if (typeof window.solana !== 'undefined' && window.solana.isPhantom) {
                    window.solana.connect().then(response => {
                        appState.wallet = response.publicKey.toString();
                        appState.connected = true;
                        updateWalletUI();
                        showToast('🎉 Wallet connected successfully!');
                    }).catch(error => {
                        console.error('Wallet connection failed:', error);
                        simulateWalletConnection();
                    });
                } else {
                    simulateWalletConnection();
                }
            } catch (error) {
                console.error('Wallet connection error:', error);
                simulateWalletConnection();
            }
        }

        function simulateWalletConnection() {
            appState.wallet = 'Demo7BgBvyjrZX1YKz4oh9mjb8ZScatkkwb8DzFx7LoiVkM3';
            appState.connected = true;
            updateWalletUI();
            showToast('🎭 Demo wallet connected!');
        }

        function updateWalletUI() {
            const connectBtn = document.getElementById('connectWallet');
            const walletInfo = document.getElementById('walletInfo');
            const walletAddress = document.getElementById('walletAddress');
            const solBalance = document.getElementById('solBalance');
            
            if (connectBtn) connectBtn.style.display = 'none';
            if (walletInfo) walletInfo.style.display = 'flex';
            if (walletAddress && appState.wallet) {
                walletAddress.textContent = 
                    appState.wallet.slice(0, 4) + '...' + appState.wallet.slice(-4);
            }
            
            const solToken = appState.portfolioData.find(t => t.symbol === 'SOL');
            if (solBalance && solToken) {
                solBalance.textContent = `${solToken.amount.toFixed(3)} SOL`;
            }
        }

        function updateChartMode() {
            const chartMode = document.getElementById('chartMode')?.value || 'USD';
            appState.chartMode = chartMode;
            updatePortfolioChart();
        }

        function refreshPortfolio() {
            showToast('🔄 Refreshing portfolio data...');
            
            // Simulate price updates
            appState.portfolioData.forEach(token => {
                const priceChange = (Math.random() - 0.5) * 0.02;
                token.price *= (1 + priceChange);
                token.value = token.amount * token.price;
                token.change24h += (Math.random() - 0.5) * 0.5;
            });
            
            updatePortfolioStats();
            renderTokenList();
            updatePortfolioChart();
            
            showToast('✅ Portfolio refreshed!');
        }

        function updatePortfolioStats() {
            if (appState.portfolioData.length === 0) return;
            
            const totalValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
            const totalChange = appState.portfolioData.reduce((sum, token) => 
                sum + (token.value * token.change24h / 100), 0
            );
            const changePercent = totalValue > 0 ? (totalChange / totalValue) * 100 : 0;

            updateElementText('totalValue', `$${totalValue.toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`);
            
            updateElementText('pnlValue', `$${totalChange.toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`);
            
            updateElementText('tokenCount', appState.portfolioData.length);
            updateElementText('alertsCount', appState.priceAlerts.length);
            
            // Update change indicators
            const totalChangeEl = document.getElementById('totalChange');
            const pnlChangeEl = document.getElementById('pnlChange');
            
            if (totalChangeEl) {
                totalChangeEl.className = `stat-change ${changePercent >= 0 ? 'positive' : 'negative'}`;
                totalChangeEl.innerHTML = `
                    <i class="fas fa-arrow-${changePercent >= 0 ? 'up' : 'down'}"></i>
                    <span>${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%</span>
                `;
            }
            
            if (pnlChangeEl) {
                pnlChangeEl.className = `stat-change ${changePercent >= 0 ? 'positive' : 'negative'}`;
                pnlChangeEl.innerHTML = `
                    <i class="fas fa-arrow-${changePercent >= 0 ? 'up' : 'down'}"></i>
                    <span>${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%</span>
                `;
            }
        }

        function renderTokenList() {
            const tokenList = document.getElementById('tokenList');
            if (!tokenList || appState.portfolioData.length === 0) return;
            
            tokenList.innerHTML = '';
            
            appState.portfolioData.forEach(token => {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                
                tokenItem.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback">${token.logo || token.symbol.charAt(0)}</div>
                        <div class="token-details">
                            <h4>${token.symbol}</h4>
                            <span>${token.amount.toLocaleString(undefined, {
                                maximumFractionDigits: token.decimals > 6 ? 0 : 6
                            })} ${token.symbol}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price">$${token.price.toLocaleString(undefined, {
                            minimumFractionDigits: token.price < 0.01 ? 6 : 2,
                            maximumFractionDigits: token.price < 0.01 ? 6 : 2
                        })}</div>
                        <div class="token-change ${token.change24h >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${token.change24h >= 0 ? 'up' : 'down'}"></i>
                            <span>${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(2)}%</span>
                        </div>
                        <div class="token-volume">
                            $${token.value.toLocaleString(undefined, {
                                minimumFractionDigits: 2, maximumFractionDigits: 2
                            })}
                        </div>
                    </div>
                `;
                tokenList.appendChild(tokenItem);
            });
        }

        function loadLiveActivity() {
            const activities = [
                {
                    type: 'buy',
                    title: 'Bought 250.0 JUP',
                    details: '2 min ago',
                    value: '$222.50',
                    icon: 'buy'
                },
                {
                    type: 'sell',
                    title: 'Sold 15.4 RAY',
                    details: '8 min ago',
                    value: '$63.45',
                    icon: 'sell'
                },
                {
                    type: 'whale',
                    title: 'Whale bought 15K SOL',
                    details: '12 min ago',
                    value: '$3.68M',
                    icon: 'whale'
                },
                {
                    type: 'buy',
                    title: 'Bought 500K BONK',
                    details: '25 min ago',
                    value: '$22.50',
                    icon: 'buy'
                }
            ];

            renderLiveActivity(activities);
        }

        function renderLiveActivity(activities) {
            const container = document.getElementById('liveActivity');
            if (!container) return;
            
            container.innerHTML = '';
            
            activities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = `activity-item ${activity.type}`;
                
                const iconMap = {
                    buy: 'fa-arrow-up',
                    sell: 'fa-arrow-down',
                    whale: 'fa-fish'
                };
                
                activityItem.innerHTML = `
                    <div class="activity-icon ${activity.icon}">
                        <i class="fas ${iconMap[activity.icon]}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-details">${activity.details}</div>
                    </div>
                    <div class="activity-value ${activity.type === 'buy' ? 'positive' : activity.type === 'sell' ? 'negative' : ''}">
                        ${activity.value}
                    </div>
                `;
                container.appendChild(activityItem);
            });
        }

        function loadWhaleData() {
            const movements = [
                {
                    type: 'buy',
                    token: 'SOL',
                    amount: 15000,
                    value: 3682500,
                    wallet: '7xKx...3mNp',
                    timestamp: Date.now() - 300000,
                    exchange: 'Jupiter'
                },
                {
                    type: 'sell',
                    token: 'JUP',
                    amount: 2500000,
                    value: 2225000,
                    wallet: '9dF2...8kLm',
                    timestamp: Date.now() - 900000,
                    exchange: 'Orca'
                },
                {
                    type: 'buy',
                    token: 'RAY',
                    amount: 485000,
                    value: 1998200,
                    wallet: '5hB9...7nQr',
                    timestamp: Date.now() - 1800000,
                    exchange: 'Raydium'
                }
            ];
            
            renderWhaleMovements(movements);
            loadTokenWhales();
        }

        function renderWhaleMovements(movements) {
            const container = document.getElementById('whaleMovements');
            if (!container) return;
            
            container.innerHTML = '';
            
            movements.forEach(movement => {
                const whaleItem = document.createElement('div');
                whaleItem.className = 'whale-transaction';
                
                const timeAgo = getTimeAgo(new Date(movement.timestamp));
                
                whaleItem.innerHTML = `
                    <div class="whale-icon">
                        <i class="fas fa-fish"></i>
                    </div>
                    <div class="whale-details">
                        <div class="whale-amount">
                            ${movement.type === 'buy' ? '🟢' : '🔴'} ${movement.amount.toLocaleString()} ${movement.token}
                        </div>
                        <div class="whale-token">
                            $${formatNumber(movement.value)} • ${movement.exchange}
                        </div>
                        <div class="whale-wallet">
                            ${movement.wallet} • ${timeAgo}
                        </div>
                    </div>
                `;
                container.appendChild(whaleItem);
            });
        }

        function loadTokenWhales() {
            const whales = [
                {
                    token: 'SOL',
                    wallet: '7xKx...3mNp',
                    holdings: 185000,
                    percentage: 0.08,
                    recentActivity: 'bought 15K SOL'
                },
                {
                    token: 'JUP',
                    wallet: '9dF2...8kLm',
                    holdings: 45000000,
                    percentage: 4.5,
                    recentActivity: 'sold 2.5M JUP'
                }
            ];
            
            renderTokenWhales(whales);
        }

        function renderTokenWhales(whales) {
            const container = document.getElementById('tokenWhales');
            if (!container) return;
            
            container.innerHTML = '';
            
            whales.forEach(whale => {
                const whaleItem = document.createElement('div');
                whaleItem.className = 'token-item';
                
                whaleItem.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback">🐋</div>
                        <div class="token-details">
                            <h4>${whale.wallet}</h4>
                            <span>${whale.recentActivity}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price">${formatNumber(whale.holdings)} ${whale.token}</div>
                        <div class="token-change positive">
                            ${whale.percentage.toFixed(1)}% of supply
                        </div>
                    </div>
                `;
                container.appendChild(whaleItem);
            });
        }

        function loadSocialData() {
            const leaderboard = [
                { wallet: '7xKx...3mNp', username: 'SolanaWhale', followers: 1250, performance: 145.2, rank: 1 },
                { wallet: '9dF2...8kLm', username: 'DeFiKing', followers: 980, performance: 132.8, rank: 2 },
                { wallet: '5hB9...7nQr', username: 'TokenSniper', followers: 756, performance: 128.5, rank: 3 }
            ];
            
            renderSocialLeaderboard(leaderboard);
        }

        function renderSocialLeaderboard(leaderboard) {
            const container = document.getElementById('socialLeaderboard');
            if (!container) return;
            
            container.innerHTML = '';
            
            leaderboard.forEach((leader, index) => {
                const item = document.createElement('div');
                item.className = 'token-item';
                
                let rankClass = 'default';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                item.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback" style="background: ${getRankColor(rankClass)};">${index + 1}</div>
                        <div class="token-details">
                            <h4>${leader.username}</h4>
                            <span>${leader.wallet}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price positive">+${leader.performance.toFixed(1)}%</div>
                        <div class="token-change">
                            ${leader.followers} followers
                        </div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        function loadTrendingTokens() {
            const trending = [
                { symbol: 'JUP', name: 'Jupiter', price: 0.89, change24h: 23.4, volume24h: 185000000, logo: '🪐' },
                { symbol: 'WIF', name: 'dogwifhat', price: 2.34, change24h: 18.7, volume24h: 95000000, logo: '🐕' },
                { symbol: 'BONK', name: 'Bonk', price: 0.000045, change24h: 15.2, volume24h: 67000000, logo: '🚀' },
                { symbol: 'RAY', name: 'Raydium', price: 4.12, change24h: -2.8, volume24h: 45000000, logo: '⚡' }
            ];
            
            renderTrendingTokens(trending);
            
            const movers = [
                { symbol: 'POPCAT', change24h: 34.2, price: 1.89, logo: '🐱' },
                { symbol: 'WIF', change24h: 28.7, price: 2.34, logo: '🐕' },
                { symbol: 'STEP', change24h: -18.4, price: 0.087, logo: '👟' },
                { symbol: 'COPE', change24h: -15.2, price: 0.034, logo: '😤' }
            ];
            
            renderMarketMovers(movers);
        }

        function renderTrendingTokens(tokens) {
            const container = document.getElementById('trendingTokens');
            if (!container) return;
            
            container.innerHTML = '';
            
            tokens.forEach(token => {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                
                tokenItem.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback">${token.logo || token.symbol.charAt(0)}</div>
                        <div class="token-details">
                            <h4>${token.symbol}</h4>
                            <span>Vol: ${formatNumber(token.volume24h)}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price">$${token.price.toLocaleString(undefined, {
                            minimumFractionDigits: token.price < 0.01 ? 6 : 2,
                            maximumFractionDigits: token.price < 0.01 ? 6 : 2
                        })}</div>
                        <div class="token-change ${token.change24h >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${token.change24h >= 0 ? 'up' : 'down'}"></i>
                            <span>${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
                container.appendChild(tokenItem);
            });
        }

        function renderMarketMovers(tokens) {
            const container = document.getElementById('marketMovers');
            if (!container) return;
            
            container.innerHTML = '';
            
            tokens.forEach(token => {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                
                tokenItem.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback">${token.logo || token.symbol.charAt(0)}</div>
                        <div class="token-details">
                            <h4>${token.symbol}</h4>
                            <span>${token.change24h >= 0 ? '🚀 Gainer' : '📉 Loser'}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price">$${token.price.toLocaleString(undefined, {
                            minimumFractionDigits: token.price < 0.01 ? 6 : 2,
                            maximumFractionDigits: token.price < 0.01 ? 6 : 2
                        })}</div>
                        <div class="token-change ${token.change24h >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${token.change24h >= 0 ? 'up' : 'down'}"></i>
                            <span>${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
                container.appendChild(tokenItem);
            });
        }

        // Whale Threshold Functions
        function setWhaleThreshold(threshold) {
            appState.whaleThreshold = threshold;
            
            document.querySelectorAll('.threshold-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[data-threshold="${threshold}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            if (threshold === 20 || threshold === 50 || threshold === 100) {
                document.getElementById('customThreshold').value = '';
            }
            
            showToast(`Whale threshold set to ${threshold} SOL`);
        }

        function setCustomThreshold() {
            const customInput = document.getElementById('customThreshold');
            const value = parseInt(customInput.value);
            
            if (value && value > 0) {
                appState.whaleThreshold = value;
                
                document.querySelectorAll('.threshold-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                showToast(`Custom threshold set to ${value} SOL`);
            }
        }

        // Notification Functions
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('show');
        }

        function createPriceAlert() {
            showToast('Price alert creation coming soon!');
        }

        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('Browser notifications not supported');
                return;
            }
            
            if (Notification.permission === 'granted') {
                showToast('Notifications already enabled');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    showToast('✅ Notifications enabled!');
                    new Notification('Cypher Analytics', {
                        body: 'Notifications are now active!',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">🎯</text></svg>'
                    });
                } else {
                    showToast('❌ Notifications denied');
                }
            });
        }

        // Real-time Updates
        function startRealTimeUpdates() {
            setInterval(() => {
                if (appState.portfolioData.length > 0) {
                    appState.portfolioData.forEach(token => {
                        const priceChange = (Math.random() - 0.5) * 0.005;
                        token.price *= (1 + priceChange);
                        token.value = token.amount * token.price;
                        token.change24h += (Math.random() - 0.5) * 0.1;
                    });
                    
                    updatePortfolioStats();
                    renderTokenList();
                }
            }, 30000);
        }

        // Utility Functions
        function formatNumber(num) {
            if (num >= 1e9) return '$' + (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return '$' + (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return '$' + (num / 1e3).toFixed(1) + 'K';
            return '$' + num.toFixed(0);
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return seconds + 's ago';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            return Math.floor(seconds / 86400) + 'd ago';
        }

        function showToast(message) {
            const toast = document.getElementById('toastNotification');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function updateElementText(id, text) {
            const element = document.getElementById(id);
            if (element) element.textContent = text;
        }

        function getRankColor(rankClass) {
            switch (rankClass) {
                case 'gold': return 'linear-gradient(45deg, #ffd700, #ffed4e)';
                case 'silver': return 'linear-gradient(45deg, #c0c0c0, #e8e8e8)';
                case 'bronze': return 'linear-gradient(45deg, #cd7f32, #daa520)';
                default: return 'rgba(255, 255, 255, 0.1)';
            }
        }

        console.log('🎯 Cypher Analytics loaded successfully');
    </script>
</body>
</html>