<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cypher - Advanced Portfolio Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/wallet-adapter-base@latest/lib/index.iife.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-stats {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            font-size: 0.85rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-value {
            font-weight: 700;
            color: #4ecdc4;
        }

        .stat-label {
            color: #888;
            font-size: 0.7rem;
            text-transform: uppercase;
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notifications-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .notifications-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .wallet-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .wallet-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .wallet-dropdown {
            position: relative;
        }

        .wallet-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 0.5rem;
            min-width: 200px;
            z-index: 1001;
            display: none;
            backdrop-filter: blur(20px);
        }

        .wallet-menu.show {
            display: block;
        }

        .wallet-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .wallet-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Navigation */
        .nav-container {
            margin-top: 80px;
            padding: 0 1rem;
        }

        .nav-tabs {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 1rem 0.5rem;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .nav-tab i {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 0.3rem;
        }

        /* Content Sections */
        .content {
            flex: 1;
            padding: 0 1rem 6rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 107, 107, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
        }

        .card-subtitle {
            color: #888;
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        /* Portfolio Stats */
        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        }

        .stat-card-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .stat-card-label {
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
        }

        .positive { color: #4ecdc4; }
        .negative { color: #ff6b6b; }

        /* Token Icons */
        .token-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.2rem;
            overflow: hidden;
            position: relative;
        }

        .token-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .token-icon.fallback {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        }

        /* Token List */
        .token-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .token-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .token-item:hover {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 107, 107, 0.3);
            transform: translateY(-2px);
        }

        .token-item.trending::after {
            content: '🔥';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.8rem;
        }

        .token-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .token-details h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .token-details span {
            color: #888;
            font-size: 0.85rem;
        }

        .token-stats {
            text-align: right;
            min-width: 120px;
        }

        .token-price {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .token-change {
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.2rem;
        }

        .token-volume {
            font-size: 0.75rem;
            color: #888;
            margin-top: 0.2rem;
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* API Status Indicator */
        .api-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #888;
        }

        .api-status.online {
            color: #4ecdc4;
        }

        .api-status.offline {
            color: #ff6b6b;
        }

        .api-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Error States */
        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            color: #ff6b6b;
            text-align: center;
        }

        .retry-btn {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        .retry-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 1rem 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 1rem;
        }

        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .chart-type-selector {
            display: flex;
            gap: 0.5rem;
        }

        .chart-type-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .chart-type-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: transparent;
        }

        .chart-type-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .chart-type-btn.active:hover {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        }

        /* Token Detail Modal */
        .token-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .token-modal.show {
            display: flex;
        }

        .token-modal-content {
            background: rgba(26, 26, 26, 0.95);
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .token-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .token-modal-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .token-modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .token-modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .token-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .token-stat-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .token-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.3rem;
        }

        .token-stat-label {
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        /* Alert Creation Modal */
        .alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .alert-modal.show {
            display: flex;
        }

        .alert-modal-content {
            background: rgba(26, 26, 26, 0.95);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #ffffff;
            font-weight: 600;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
        }

        .form-select option {
            background: #1a1a1a;
            color: white;
        }

        .alert-type-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .alert-type-option {
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
        }

        .alert-type-option.selected {
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.2), rgba(78, 205, 196, 0.2));
            border-color: #4ecdc4;
        }

        .alert-type-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .alert-type-option.selected:hover {
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.2), rgba(78, 205, 196, 0.2));
        }

        /* Price Alert Cards */
        .alert-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #4ecdc4;
            transition: all 0.3s ease;
        }

        .alert-card:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .alert-card.triggered {
            border-left-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .alert-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .alert-card-title {
            font-weight: 600;
            color: #ffffff;
        }

        .alert-card-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .alert-card-status.active {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
        }

        .alert-card-status.triggered {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .alert-card-details {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .alert-card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .alert-action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .alert-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .alert-action-btn.delete {
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .alert-action-btn.delete:hover {
            background: rgba(255, 107, 107, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }

        .toast-notification.show {
            transform: translateX(0);
        }

        /* Whale Tracker Styles */
        .whale-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border-left: 4px solid #ff6b6b;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .whale-item:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-2px);
        }

        .whale-item.buy {
            border-left-color: #4ecdc4;
        }

        .whale-item.sell {
            border-left-color: #ff6b6b;
        }

        .whale-item.transfer {
            border-left-color: #f39c12;
        }

        .whale-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .whale-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }

        .whale-details h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .whale-details span {
            color: #888;
            font-size: 0.85rem;
        }

        .whale-stats {
            text-align: right;
            min-width: 120px;
        }

        .whale-amount {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .whale-time {
            color: #888;
            font-size: 0.8rem;
        }

        .threshold-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .threshold-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: transparent;
        }

        .threshold-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .threshold-btn.active:hover {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        }

        /* Social Features Styles */
        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-2px);
        }

        .leaderboard-item.top3 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .leaderboard-rank {
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .leaderboard-rank.gold {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
        }

        .leaderboard-rank.silver {
            background: linear-gradient(45deg, #c0c0c0, #e8e8e8);
            color: #000;
        }

        .leaderboard-rank.bronze {
            background: linear-gradient(45deg, #cd7f32, #daa520);
            color: #fff;
        }

        .trader-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: 30px;
        }

        .trader-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.2rem;
        }

        .trader-details h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .trader-details span {
            color: #888;
            font-size: 0.85rem;
        }

        .trader-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .trader-stat {
            text-align: center;
        }

        .trader-stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #4ecdc4;
        }

        .trader-stat-label {
            color: #888;
            font-size: 0.8rem;
        }

        .follow-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
            color: #4ecdc4;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .follow-btn:hover {
            background: rgba(78, 205, 196, 0.2);
        }

        .follow-btn.following {
            background: #4ecdc4;
            color: white;
        }

        .follow-btn.following:hover {
            background: #ff6b6b;
        }

        .followed-wallet-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }

        .followed-wallet-item:hover {
            background: rgba(255, 255, 255, 0.07);
        }

        .followed-wallet-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .followed-wallet-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 0.9rem;
        }

        .followed-wallet-details h5 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .followed-wallet-details span {
            color: #888;
            font-size: 0.75rem;
        }

        .wallet-actions {
            display: flex;
            gap: 0.25rem;
        }

        .wallet-action-btn {
            padding: 0.25rem 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s ease;
        }

        .wallet-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .wallet-action-btn.unfollow {
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .wallet-action-btn.unfollow:hover {
            background: rgba(255, 107, 107, 0.1);
        }

        .portfolio-preview {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .token-badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.7rem;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: rgba(255, 255, 255, 0.07);
        }

        .activity-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }

        .activity-content {
            flex: 1;
        }

        .activity-content h5 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .activity-content p {
            color: #888;
            font-size: 0.8rem;
            margin: 0;
        }

        .activity-time {
            color: #888;
            font-size: 0.75rem;
        }

        /* Achievement System Styles */
        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            position: relative;
        }

        .user-avatar-large.verified::after {
            content: '✓';
            position: absolute;
            bottom: 0;
            right: 0;
            background: #4ecdc4;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            border: 3px solid #1a1a1a;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #4ecdc4;
            margin-bottom: 0.3rem;
        }

        .profile-stat-label {
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .achievement-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .achievement-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .achievement-stat-card.rare::before {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .achievement-stat-card.epic::before {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .achievement-stat-card.legendary::before {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .achievement-stat-card.attestation::before {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .achievement-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .achievement-stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .achievement-stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 0.3rem;
        }

        .achievement-stat-label {
            color: #888;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        .achievement-stat-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-fill.rare {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .progress-fill.epic {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .progress-fill.legendary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .progress-fill.attestation {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .progress-text {
            font-size: 0.8rem;
            color: #888;
            min-width: 40px;
        }

        .achievement-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
            overflow-x: auto;
        }

        .achievement-tab {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            min-width: fit-content;
            position: relative;
        }

        .achievement-tab:hover {
            background: rgba(255, 255, 255, 0.07);
        }

        .achievement-tab.active {
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.2), rgba(78, 205, 196, 0.2));
            border-color: #4ecdc4;
        }

        .achievement-tab i {
            font-size: 1rem;
        }

        .achievement-tab span {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .tab-badge {
            background: #4ecdc4;
            color: white;
            border-radius: 10px;
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .achievement-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .achievement-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .achievement-card.rare::before {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .achievement-card.epic::before {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .achievement-card.legendary::before {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 107, 107, 0.3);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .achievement-card.completed {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(255, 255, 255, 0.05));
            border-color: rgba(78, 205, 196, 0.3);
        }

        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(50%);
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .achievement-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
        }

        .achievement-icon.rare {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .achievement-icon.epic {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .achievement-icon.legendary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
        }

        .achievement-icon.completed::after {
            content: '✓';
            position: absolute;
            bottom: -2px;
            right: -2px;
            background: #4ecdc4;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            border: 2px solid #1a1a1a;
        }

        .achievement-details h4 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: #ffffff;
        }

        .achievement-details .achievement-tier {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .achievement-details .achievement-tier.rare {
            color: #3498db;
        }

        .achievement-details .achievement-tier.epic {
            color: #9b59b6;
        }

        .achievement-details .achievement-tier.legendary {
            color: #f39c12;
        }

        .achievement-description {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        .achievement-progress {
            margin-bottom: 1rem;
        }

        .achievement-progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }

        .achievement-progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .achievement-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .achievement-progress-fill.rare {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .achievement-progress-fill.epic {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .achievement-progress-fill.legendary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .achievement-rewards {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .achievement-points {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: #4ecdc4;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .achievement-badges {
            display: flex;
            gap: 0.5rem;
        }

        .achievement-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .achievement-badge.nft {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .achievement-badge.attestation {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .achievement-badge.rare-badge {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        /* Avatar Selection */
        .avatar-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            color: #888;
        }

        .avatar-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #4ecdc4;
            color: white;
        }

        .avatar-option.active {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-color: #4ecdc4;
            color: white;
        }

        /* Attestation Service */
        .attestation-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: #4ecdc4;
        }

        .status-dot.offline {
            background: #888;
        }

        .attestation-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto;
        }

        /* Recent Achievements */
        .recent-achievement-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .recent-achievement-item:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-2px);
        }

        .recent-achievement-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .recent-achievement-info {
            flex: 1;
        }

        .recent-achievement-info h5 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            color: #ffffff;
        }

        .recent-achievement-info p {
            color: #888;
            font-size: 0.8rem;
            margin: 0;
        }

        .recent-achievement-time {
            color: #4ecdc4;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* NFT Minting */
        .mintable-achievement {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .mintable-achievement:hover {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(243, 156, 18, 0.3);
        }

        .mintable-achievement.selected {
            background: rgba(243, 156, 18, 0.1);
            border-color: #f39c12;
        }

        .mint-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .mint-cost {
            color: #f39c12;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0;
            }

            .header-stats {
                display: none;
            }

            .logo {
                font-size: 1.3rem;
            }

            .nav-tabs {
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .nav-tabs::-webkit-scrollbar {
                display: none;
            }

            .nav-tab {
                min-width: 80px;
                font-size: 0.8rem;
            }

            .portfolio-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .wallet-menu {
                right: auto;
                left: 0;
            }

            .trader-stats {
                flex-direction: column;
                gap: 0.5rem;
            }

            .threshold-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
            }

            .achievements-grid {
                grid-template-columns: 1fr;
            }

            .achievement-tabs {
                gap: 0.3rem;
            }

            .achievement-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            .user-avatar-large {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }

            .profile-stat-value {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i> Cypher
                </div>

        <!-- Username Modal -->
        <div id="usernameModal" class="alert-modal">
            <div class="alert-modal-content">
                <div class="card-header" style="margin-bottom: 2rem;">
                    <h3 class="card-title">Edit Profile</h3>
                    <button class="token-modal-close" onclick="closeUsernameModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="usernameForm" onsubmit="updateUsername(event)">
                    <div class="form-group">
                        <label class="form-label">Display Name</label>
                        <input type="text" id="newUsername" class="form-input" placeholder="Enter your username" maxlength="20" required>
                        <small style="color: #888; font-size: 0.8rem;">3-20 characters, letters, numbers, and underscores only</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Avatar Style</label>
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem;">
                            <div class="avatar-option active" data-style="user" onclick="selectAvatarStyle('user')">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="avatar-option" data-style="rocket" onclick="selectAvatarStyle('rocket')">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div class="avatar-option" data-style="star" onclick="selectAvatarStyle('star')">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="avatar-option" data-style="crown" onclick="selectAvatarStyle('crown')">
                                <i class="fas fa-crown"></i>
                            </div>
                            <div class="avatar-option" data-style="gem" onclick="selectAvatarStyle('gem')">
                                <i class="fas fa-gem"></i>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Profile Visibility</label>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" id="publicProfile" checked>
                                <span>Make profile public</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" id="showAchievements" checked>
                                <span>Show achievements on profile</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" id="allowFollowing" checked>
                                <span>Allow others to follow me</span>
                            </label>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-save"></i> Save Profile
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeUsernameModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Achievement Detail Modal -->
        <div id="achievementModal" class="alert-modal">
            <div class="alert-modal-content" style="max-width: 600px;">
                <div class="card-header" style="margin-bottom: 2rem;">
                    <h3 class="card-title">Achievement Details</h3>
                    <button class="token-modal-close" onclick="closeAchievementModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div id="achievementDetails">
                    <!-- Achievement details will be populated here -->
                </div>
            </div>
        </div>

        <!-- NFT Minting Modal -->
        <div id="nftMintModal" class="alert-modal">
            <div class="alert-modal-content">
                <div class="card-header" style="margin-bottom: 2rem;">
                    <h3 class="card-title">Mint Achievement NFTs</h3>
                    <button class="token-modal-close" onclick="closeNFTMintModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div id="mintableAchievements">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="mintSelectedNFTs()" style="flex: 1;">
                        <i class="fas fa-coins"></i> Mint Selected NFTs
                    </button>
                    <button class="btn btn-secondary" onclick="closeNFTMintModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
                
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="headerSolPrice">Loading...</div>
                        <div class="stat-label">SOL</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="headerTotalVol">Loading...</div>
                        <div class="stat-label">24h Volume</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="headerActiveWallets">0</div>
                        <div class="stat-label">Tracked Tokens</div>
                    </div>
                </div>

                <div class="wallet-section">
                    <div class="api-status" id="apiStatus">
                        <div class="api-dot"></div>
                        <span>Connecting...</span>
                    </div>
                    <button id="notificationsBtn" class="notifications-btn" onclick="toggleNotificationPanel()">
                        <i class="fas fa-bell"></i>
                        <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
                    </button>
                    <div id="walletInfo" class="wallet-info" style="display: none;">
                        <i class="fas fa-wallet"></i>
                        <span id="walletAddress"></span>
                        <span id="solBalance">0 SOL</span>
                    </div>
                    <div class="wallet-dropdown">
                        <button id="connectWallet" class="wallet-btn" onclick="toggleWalletMenu()">
                            <i class="fas fa-plug"></i> <span id="walletBtnText">Connect Wallet</span>
                        </button>
                        <div id="walletMenu" class="wallet-menu">
                            <div class="wallet-option" onclick="connectWallet('phantom')">
                                <i class="fas fa-ghost" style="color: #ab9ff2;"></i>
                                <span>Phantom</span>
                            </div>
                            <div class="wallet-option" onclick="connectWallet('solflare')">
                                <i class="fas fa-fire" style="color: #fc8c04;"></i>
                                <span>Solflare</span>
                            </div>
                            <div class="wallet-option" onclick="connectWallet('backpack')">
                                <i class="fas fa-backpack" style="color: #f59e0b;"></i>
                                <span>Backpack</span>
                            </div>
                            <div class="wallet-option" onclick="disconnectWallet()" style="border-top: 1px solid rgba(255,255,255,0.1); margin-top: 0.5rem; padding-top: 1rem; color: #ff6b6b;">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Disconnect</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <div class="nav-container">
            <div class="nav-tabs">
                <div class="nav-tab active" data-section="portfolio" onclick="switchSection('portfolio')">
                    <i class="fas fa-chart-pie"></i>
                    Portfolio
                </div>
                <div class="nav-tab" data-section="market" onclick="switchSection('market')">
                    <i class="fas fa-globe"></i>
                    Market
                </div>
                <div class="nav-tab" data-section="whale" onclick="switchSection('whale')">
                    <i class="fas fa-fish"></i>
                    Whale Tracker
                </div>
                <div class="nav-tab" data-section="achievements" onclick="switchSection('achievements')">
                    <i class="fas fa-trophy"></i>
                    Achievements
                </div>
                <div class="nav-tab" data-section="alerts" onclick="switchSection('alerts')">
                    <i class="fas fa-bell"></i>
                    Alerts
                </div>
                <div class="nav-tab" data-section="social" onclick="switchSection('social')">
                    <i class="fas fa-users"></i>
                    Social
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="content">
            <!-- Portfolio Section -->
            <section id="portfolio" class="section active">
                <div class="portfolio-stats">
                    <div class="stat-card">
                        <div class="stat-card-value" id="totalValue">$0.00</div>
                        <div class="stat-card-label">Total Value</div>
                        <div class="stat-change" id="totalChange">
                            <i class="fas fa-chart-line"></i>
                            <span>Connect wallet</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="pnlValue">$0.00</div>
                        <div class="stat-card-label">24h P&L</div>
                        <div class="stat-change" id="pnlChange">
                            <i class="fas fa-chart-line"></i>
                            <span>Connect wallet</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="tokenCount">0</div>
                        <div class="stat-card-label">Holdings</div>
                        <div class="stat-change">
                            <i class="fas fa-coins"></i>
                            <span>Tokens</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="alertsCount">0</div>
                        <div class="stat-card-label">Active Alerts</div>
                        <div class="stat-change">
                            <i class="fas fa-bell"></i>
                            <span>Watching</span>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Portfolio Performance</h3>
                                <p class="card-subtitle">Real-time portfolio tracking with live market data</p>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="chartMode" class="form-select" onchange="updateChartMode()">
                                    <option value="USD">USD Value</option>
                                    <option value="SOL">vs SOL</option>
                                    <option value="BTC">vs BTC</option>
                                </select>
                                <select id="chartTimeframe" class="form-select" onchange="updatePortfolioChartTimeframe()">
                                    <option value="15m">15min</option>
                                    <option value="1h">1hour</option>
                                    <option value="4h">4hour</option>
                                    <option value="24h">24hour</option>
                                    <option value="7d">7day</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-controls">
                                <div class="chart-type-selector">
                                    <div class="chart-type-btn active" data-type="line" onclick="setChartType('line')">
                                        <i class="fas fa-chart-line"></i> Line
                                    </div>
                                    <div class="chart-type-btn" data-type="candlestick" onclick="setChartType('candlestick')">
                                        <i class="fas fa-chart-bar"></i> Candlestick
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    <span style="color: #888; font-size: 0.8rem;">Technical Analysis:</span>
                                    <label style="display: flex; align-items: center; gap: 0.3rem; color: #888; font-size: 0.8rem;">
                                        <input type="checkbox" id="showMA" onchange="toggleMA()" style="margin: 0;">
                                        <span>MA(20)</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.3rem; color: #888; font-size: 0.8rem;">
                                        <input type="checkbox" id="showVolume" onchange="toggleVolume()" style="margin: 0;">
                                        <span>Volume</span>
                                    </label>
                                </div>
                            </div>
                            <canvas id="portfolioChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Live Activity</h3>
                            <p class="card-subtitle">Real-time market movements</p>
                        </div>
                        <div id="liveActivity">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Token Holdings</h3>
                        <button class="btn btn-secondary btn-small" onclick="refreshPortfolio()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div id="tokenList">
                        <div class="empty-state">
                            <i class="fas fa-wallet"></i>
                            <p>Connect your wallet to view your token holdings</p>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Supports Phantom, Solflare, Backpack and other Solana wallets</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Market Section -->
            <section id="market" class="section">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-card-value" id="marketSolPrice">Loading...</div>
                        <div class="stat-card-label">SOL Price</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="marketVolume">Loading...</div>
                        <div class="stat-card-label">24h Volume</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="marketCap">Loading...</div>
                        <div class="stat-card-label">Market Cap</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="newTokens">Loading...</div>
                        <div class="stat-card-label">Tracked Tokens</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Trending Tokens</h3>
                            <p class="card-subtitle">Top performers by volume</p>
                        </div>
                        <div id="trendingTokens">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Market Movers</h3>
                            <p class="card-subtitle">Biggest gainers & losers</p>
                        </div>
                        <div id="marketMovers">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Whale Tracker Section -->
            <section id="whale" class="section">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-card-value" id="whaleTransactions">0</div>
                        <div class="stat-card-label">Large Transactions</div>
                        <div class="stat-change positive">
                            <i class="fas fa-chart-line"></i>
                            <span>24h</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="whaleVolume">$0</div>
                        <div class="stat-card-label">Whale Volume</div>
                        <div class="stat-change positive">
                            <i class="fas fa-water"></i>
                            <span>24h</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="followedWallets">0</div>
                        <div class="stat-card-label">Following</div>
                        <div class="stat-change">
                            <i class="fas fa-users"></i>
                            <span>Wallets</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="alertsTriggered">0</div>
                        <div class="stat-card-label">Alerts Today</div>
                        <div class="stat-change">
                            <i class="fas fa-bell"></i>
                            <span>Triggered</span>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Live Whale Movements</h3>
                            <p class="card-subtitle">Large transactions in real-time</p>
                            <button class="btn btn-secondary btn-small" onclick="openWhaleSettings()">
                                <i class="fas fa-cog"></i> Settings
                            </button>
                        </div>
                        <div id="whaleMovements">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Followed Wallets</h3>
                            <button class="btn btn-primary btn-small" onclick="openFollowWalletModal()">
                                <i class="fas fa-plus"></i> Follow Wallet
                            </button>
                        </div>
                        <div id="followedWalletsList">
                            <div class="empty-state" style="padding: 2rem;">
                                <i class="fas fa-user-plus"></i>
                                <p>No wallets followed yet</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Whale Alert Settings</h3>
                        <p class="card-subtitle">Customize your whale tracking preferences</p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div style="background: rgba(255, 255, 255, 0.03); padding: 1.5rem; border-radius: 12px;">
                            <h4 style="margin-bottom: 1rem; color: #ffffff;">Transaction Threshold</h4>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                <button class="threshold-btn active" data-threshold="20" onclick="setWhaleThreshold(20)">20 SOL</button>
                                <button class="threshold-btn" data-threshold="50" onclick="setWhaleThreshold(50)">50 SOL</button>
                                <button class="threshold-btn" data-threshold="100" onclick="setWhaleThreshold(100)">100 SOL</button>
                            </div>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <input type="number" id="customThreshold" class="form-input" placeholder="Custom SOL" style="flex: 1;" min="1" max="10000">
                                <button class="btn btn-secondary btn-small" onclick="setCustomThreshold()">Set</button>
                            </div>
                            <p style="color: #888; font-size: 0.8rem; margin-top: 0.5rem;">Current: <span id="currentThreshold">20 SOL</span></p>
                        </div>

                        <div style="background: rgba(255, 255, 255, 0.03); padding: 1.5rem; border-radius: 12px;">
                            <h4 style="margin-bottom: 1rem; color: #ffffff;">Alert Types</h4>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="alertBuys" checked onchange="updateAlertSettings()">
                                    <span>Large Buys</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="alertSells" checked onchange="updateAlertSettings()">
                                    <span>Large Sells</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="alertTransfers" onchange="updateAlertSettings()">
                                    <span>Large Transfers</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="alertFollowed" checked onchange="updateAlertSettings()">
                                    <span>Followed Wallets Only</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Achievements Section -->
            <section id="achievements" class="section">
                <!-- User Profile Header -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Achievement Profile</h3>
                        <button class="btn btn-secondary btn-small" onclick="openUsernameModal()">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                    </div>
                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 2rem; align-items: center;">
                        <div class="user-avatar-large" id="userAvatarLarge">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h2 style="margin: 0; color: #ffffff;" id="displayUsername">Anonymous Trader</h2>
                            <p style="margin: 0.5rem 0; color: #888;" id="userWalletDisplay">Connect wallet to claim achievements</p>
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="totalAchievements">0</div>
                                    <div class="profile-stat-label">Achievements</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="achievementPoints">0</div>
                                    <div class="profile-stat-label">Points</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="userRank">#-</div>
                                    <div class="profile-stat-label">Global Rank</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="completionRate">0%</div>
                                    <div class="profile-stat-label">Completion</div>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="shareAchievements()">
                                <i class="fas fa-share"></i> Share Profile
                            </button>
                            <button class="btn btn-secondary" onclick="mintNFTCollection()">
                                <i class="fas fa-coins"></i> Mint NFTs
                            </button>
                            <button class="btn btn-secondary" onclick="verifyOnAttestation()">
                                <i class="fas fa-certificate"></i> Verify Achievements
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Achievement Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="achievement-stat-card rare">
                        <div class="achievement-stat-icon">🏅</div>
                        <div class="achievement-stat-value" id="rareAchievements">0</div>
                        <div class="achievement-stat-label">Rare</div>
                        <div class="achievement-stat-progress">
                            <div class="progress-bar">
                                <div class="progress-fill rare" id="rareProgress" style="width: 0%"></div>
                            </div>
                            <span class="progress-text" id="rareProgressText">0/50</span>
                        </div>
                    </div>
                    <div class="achievement-stat-card epic">
                        <div class="achievement-stat-icon">🎖️</div>
                        <div class="achievement-stat-value" id="epicAchievements">0</div>
                        <div class="achievement-stat-label">Epic</div>
                        <div class="achievement-stat-progress">
                            <div class="progress-bar">
                                <div class="progress-fill epic" id="epicProgress" style="width: 0%"></div>
                            </div>
                            <span class="progress-text" id="epicProgressText">0/75</span>
                        </div>
                    </div>
                    <div class="achievement-stat-card legendary">
                        <div class="achievement-stat-icon">🏆</div>
                        <div class="achievement-stat-value" id="legendaryAchievements">0</div>
                        <div class="achievement-stat-label">Legendary</div>
                        <div class="achievement-stat-progress">
                            <div class="progress-bar">
                                <div class="progress-fill legendary" id="legendaryProgress" style="width: 0%"></div>
                            </div>
                            <span class="progress-text" id="legendaryProgressText">0/25</span>
                        </div>
                    </div>
                    <div class="achievement-stat-card attestation">
                        <div class="achievement-stat-icon">🛡️</div>
                        <div class="achievement-stat-value" id="attestedAchievements">0</div>
                        <div class="achievement-stat-label">Attested</div>
                        <div class="achievement-stat-progress">
                            <div class="progress-bar">
                                <div class="progress-fill attestation" id="attestationProgress" style="width: 0%"></div>
                            </div>
                            <span class="progress-text" id="attestationProgressText">0/25</span>
                        </div>
                    </div>
                </div>

                <!-- Achievement Categories -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Achievement Categories</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <select id="achievementFilter" class="form-select" onchange="filterAchievements()" style="width: auto;">
                                <option value="all">All Achievements</option>
                                <option value="rare">Rare Only</option>
                                <option value="epic">Epic Only</option>
                                <option value="legendary">Legendary Only</option>
                                <option value="completed">Completed</option>
                                <option value="incomplete">In Progress</option>
                            </select>
                            <select id="categoryFilter" class="form-select" onchange="filterAchievements()" style="width: auto;">
                                <option value="all">All Categories</option>
                                <option value="portfolio">Portfolio</option>
                                <option value="trading">Trading</option>
                                <option value="social">Social</option>
                                <option value="whale">Whale Tracking</option>
                                <option value="alerts">Alerts</option>
                                <option value="milestones">Milestones</option>
                                <option value="special">Special Events</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="achievement-tabs">
                        <div class="achievement-tab active" data-category="all" onclick="switchAchievementTab('all')">
                            <i class="fas fa-star"></i>
                            <span>All</span>
                            <div class="tab-badge" id="allBadge">150</div>
                        </div>
                        <div class="achievement-tab" data-category="portfolio" onclick="switchAchievementTab('portfolio')">
                            <i class="fas fa-chart-pie"></i>
                            <span>Portfolio</span>
                            <div class="tab-badge" id="portfolioBadge">25</div>
                        </div>
                        <div class="achievement-tab" data-category="trading" onclick="switchAchievementTab('trading')">
                            <i class="fas fa-exchange-alt"></i>
                            <span>Trading</span>
                            <div class="tab-badge" id="tradingBadge">30</div>
                        </div>
                        <div class="achievement-tab" data-category="social" onclick="switchAchievementTab('social')">
                            <i class="fas fa-users"></i>
                            <span>Social</span>
                            <div class="tab-badge" id="socialBadge">20</div>
                        </div>
                        <div class="achievement-tab" data-category="whale" onclick="switchAchievementTab('whale')">
                            <i class="fas fa-fish"></i>
                            <span>Whale</span>
                            <div class="tab-badge" id="whaleBadge">25</div>
                        </div>
                        <div class="achievement-tab" data-category="special" onclick="switchAchievementTab('special')">
                            <i class="fas fa-crown"></i>
                            <span>Special</span>
                            <div class="tab-badge" id="specialBadge">15</div>
                        </div>
                    </div>

                    <div id="achievementsList" class="achievements-grid">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>

                <!-- Recent Achievements -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Achievements</h3>
                        <p class="card-subtitle">Your latest unlocked achievements</p>
                    </div>
                    <div id="recentAchievements">
                        <div class="empty-state">
                            <i class="fas fa-trophy"></i>
                            <p>No achievements unlocked yet</p>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Start trading and using the platform to unlock achievements!</p>
                        </div>
                    </div>
                </div>

                <!-- Achievement Testing (Demo Features) -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Achievement Testing</h3>
                        <p class="card-subtitle">Simulate activities to unlock achievements (Demo Mode)</p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn btn-secondary" onclick="simulateTradeActivity()">
                            <i class="fas fa-exchange-alt"></i> Simulate Trade
                        </button>
                        <button class="btn btn-secondary" onclick="simulatePortfolioGrowth()">
                            <i class="fas fa-chart-line"></i> Simulate Growth
                        </button>
                        <button class="btn btn-secondary" onclick="simulateSocialGrowth()">
                            <i class="fas fa-users"></i> Gain Followers
                        </button>
                        <button class="btn btn-secondary" onclick="simulateWhaleActivity()">
                            <i class="fas fa-fish"></i> Whale Activity
                        </button>
                        <button class="btn btn-secondary" onclick="simulateSpecialEvent()">
                            <i class="fas fa-star"></i> Special Event
                        </button>
                        <button class="btn btn-secondary" onclick="resetAchievements()">
                            <i class="fas fa-undo"></i> Reset Progress
                        </button>
                    </div>
                    <p style="color: #888; font-size: 0.8rem; margin-top: 1rem; text-align: center;">
                        These buttons simulate various platform activities for testing purposes
                    </p>
                </div>

                <!-- Solana Attestation Service Integration -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Solana Attestation Service</h3>
                        <p class="card-subtitle">Verify and attest your achievements on-chain</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 2rem; align-items: center;">
                        <div>
                            <h4 style="margin-bottom: 1rem; color: #ffffff;">Blockchain Verification</h4>
                            <p style="color: #888; margin-bottom: 1rem;">
                                Connect your achievements to the Solana blockchain through the official Attestation Service. 
                                Verified achievements become permanent, tradeable, and provable on-chain.
                            </p>
                            <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                                <div class="attestation-status" id="attestationStatus">
                                    <div class="status-dot offline"></div>
                                    <span>Not Connected</span>
                                </div>
                                <div style="color: #888; font-size: 0.9rem;">
                                    Attestable: <span id="attestableCount">0</span> achievements
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-primary" onclick="connectAttestationService()">
                                    <i class="fas fa-link"></i> Connect Attestation
                                </button>
                                <button class="btn btn-secondary" onclick="viewAttestationHistory()">
                                    <i class="fas fa-history"></i> View History
                                </button>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div class="attestation-logo">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <p style="color: #888; font-size: 0.8rem; margin-top: 0.5rem;">
                                Powered by<br>Solana Attestation
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alerts Section -->
            <section id="alerts" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Price Alerts</h3>
                        <button class="btn btn-primary btn-small" onclick="openAlertModal()">
                            <i class="fas fa-plus"></i> New Alert
                        </button>
                    </div>
                    <div id="priceAlerts">
                        <div class="empty-state">
                            <i class="fas fa-bell"></i>
                            <p>No price alerts set. Create your first alert!</p>
                            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Get notified when tokens hit your target prices or technical conditions</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Notification Settings</h3>
                        <p class="card-subtitle">Configure your alert preferences</p>
                    </div>
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 10px;">
                            <div>
                                <div style="font-weight: 600;">Browser Notifications</div>
                                <div style="color: #888; font-size: 0.8rem;">Push notifications to browser</div>
                            </div>
                            <button class="btn btn-primary btn-small" onclick="requestNotificationPermission()">
                                <span id="notificationBtnText">Enable</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Social Section -->
            <section id="social" class="section">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-card-value" id="totalFollowers">0</div>
                        <div class="stat-card-label">Your Followers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="totalFollowing">0</div>
                        <div class="stat-card-label">Following</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="socialRank">#-</div>
                        <div class="stat-card-label">Your Rank</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="portfolioShares">0</div>
                        <div class="stat-card-label">Shares Today</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Social Leaderboard</h3>
                            <p class="card-subtitle">Most followed traders</p>
                            <select id="leaderboardFilter" class="form-select" onchange="updateLeaderboard()" style="width: auto;">
                                <option value="followers">Most Followers</option>
                                <option value="performance">Best Performance</option>
                                <option value="volume">Highest Volume</option>
                            </select>
                        </div>
                        <div id="socialLeaderboard">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Trending Traders</h3>
                            <p class="card-subtitle">Hot picks this week</p>
                        </div>
                        <div id="trendingTraders">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Share Your Portfolio</h3>
                        <p class="card-subtitle">Show off your gains to the community</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 2rem; align-items: center;">
                        <div>
                            <h4 style="margin-bottom: 1rem; color: #ffffff;">Portfolio Snapshot</h4>
                            <div id="portfolioSnapshot" style="background: rgba(255, 255, 255, 0.03); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <div>
                                        <div style="font-size: 1.5rem; font-weight: 700; color: #4ecdc4;" id="sharePortfolioValue">$0.00</div>
                                        <div style="color: #888; font-size: 0.9rem;">Total Portfolio Value</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 1.2rem; font-weight: 600;" id="sharePortfolioChange">+0.00%</div>
                                        <div style="color: #888; font-size: 0.9rem;">24h Change</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap;" id="shareTopTokens">
                                    <!-- Top tokens will be populated here -->
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="shareAnonymously" checked>
                                    <span>Share anonymously</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="includeHoldings">
                                    <span>Include token amounts</span>
                                </label>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="shareToTwitter()">
                                <i class="fas fa-bird"></i> Share to Twitter
                            </button>
                            <button class="btn btn-secondary" onclick="shareToDiscord()">
                                <i class="fas fa-comments"></i> Share to Discord
                            </button>
                            <button class="btn btn-secondary" onclick="copyShareLink()">
                                <i class="fas fa-link"></i> Copy Link
                            </button>
                            <button class="btn btn-secondary" onclick="downloadSnapshot()">
                                <i class="fas fa-download"></i> Download Image
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Community Activity</h3>
                        <p class="card-subtitle">Recent shares and discussions</p>
                    </div>
                    <div id="communityActivity">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Alert Creation Modal -->
        <div id="alertModal" class="alert-modal">
            <div class="alert-modal-content">
                <div class="card-header" style="margin-bottom: 2rem;">
                    <h3 class="card-title">Create Price Alert</h3>
                    <button class="token-modal-close" onclick="closeAlertModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="alertForm" onsubmit="createAlert(event)">
                    <div class="form-group">
                        <label class="form-label">Token</label>
                        <select id="alertToken" class="form-select" required>
                            <option value="">Select Token</option>
                            <option value="SOL">SOL - Solana</option>
                            <option value="BONK">BONK - Bonk</option>
                            <option value="JUP">JUP - Jupiter</option>
                            <option value="WIF">WIF - dogwifhat</option>
                            <option value="RAY">RAY - Raydium</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Alert Type</label>
                        <div class="alert-type-grid">
                            <div class="alert-type-option selected" data-type="price" onclick="selectAlertType('price')">
                                <i class="fas fa-dollar-sign" style="display: block; margin-bottom: 0.5rem; font-size: 1.2rem;"></i>
                                <strong>Price Target</strong>
                                <p style="margin: 0; font-size: 0.8rem; color: #888;">Alert when price hits target</p>
                            </div>
                            <div class="alert-type-option" data-type="percent" onclick="selectAlertType('percent')">
                                <i class="fas fa-percentage" style="display: block; margin-bottom: 0.5rem; font-size: 1.2rem;"></i>
                                <strong>% Change</strong>
                                <p style="margin: 0; font-size: 0.8rem; color: #888;">Alert on percentage move</p>
                            </div>
                        </div>
                    </div>

                    <div id="priceAlertFields" class="alert-fields">
                        <div class="form-group">
                            <label class="form-label">Target Price ($)</label>
                            <input type="number" id="alertPrice" class="form-input" step="0.000001" placeholder="0.00" required>
                        </div>
                    </div>

                    <div id="percentAlertFields" class="alert-fields" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Percentage Change (%)</label>
                            <input type="number" id="alertPercent" class="form-input" step="0.1" placeholder="5.0">
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-bell"></i> Create Alert
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeAlertModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Follow Wallet Modal -->
        <div id="followWalletModal" class="alert-modal">
            <div class="alert-modal-content">
                <div class="card-header" style="margin-bottom: 2rem;">
                    <h3 class="card-title">Follow Wallet</h3>
                    <button class="token-modal-close" onclick="closeFollowWalletModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="followWalletForm" onsubmit="followWallet(event)">
                    <div class="form-group">
                        <label class="form-label">Wallet Address</label>
                        <input type="text" id="walletAddress" class="form-input" placeholder="Enter Solana wallet address" required>
                        <small style="color: #888; font-size: 0.8rem;">Enter a valid Solana wallet address (base58)</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nickname (Optional)</label>
                        <input type="text" id="walletNickname" class="form-input" placeholder="Give this wallet a nickname">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Alert Settings</label>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" id="alertOnBuy" checked>
                                <span>Alert on large buys</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" id="alertOnSell" checked>
                                <span>Alert on large sells</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                <input type="checkbox" id="alertOnTransfer">
                                <span>Alert on transfers</span>
                            </label>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-user-plus"></i> Follow Wallet
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeFollowWalletModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Whale Settings Modal -->
        <div id="whaleSettingsModal" class="alert-modal">
            <div class="alert-modal-content">
                <div class="card-header" style="margin-bottom: 2rem;">
                    <h3 class="card-title">Whale Alert Settings</h3>
                    <button class="token-modal-close" onclick="closeWhaleSettings()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">Minimum Transaction Size</label>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 1rem;">
                        <button class="threshold-btn active" data-threshold="20" onclick="setWhaleThreshold(20)">20 SOL</button>
                        <button class="threshold-btn" data-threshold="50" onclick="setWhaleThreshold(50)">50 SOL</button>
                        <button class="threshold-btn" data-threshold="100" onclick="setWhaleThreshold(100)">100 SOL</button>
                    </div>
                    <input type="number" id="customThresholdModal" class="form-input" placeholder="Custom amount in SOL" min="1" max="10000">
                </div>

                <div class="form-group">
                    <label class="form-label">Alert Types</label>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="modalAlertBuys" checked>
                            <span>Large Buys</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="modalAlertSells" checked>
                            <span>Large Sells</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="modalAlertTransfers">
                            <span>Large Transfers</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="modalAlertFollowed" checked>
                            <span>Followed Wallets Only</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Token Filter</label>
                    <select id="tokenFilter" class="form-select">
                        <option value="all">All tokens</option>
                        <option value="portfolio">Portfolio tokens only</option>
                        <option value="trending">Trending tokens only</option>
                    </select>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="saveWhaleSettings()" style="flex: 1;">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                    <button class="btn btn-secondary" onclick="closeWhaleSettings()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toastNotification" class="toast-notification"></div>

    <script>
        // ===== APPLICATION STATE =====
        const appState = {
            wallet: {
                connected: false,
                publicKey: null,
                provider: null,
                balance: 0,
                tokens: []
            },
            marketData: new Map(),
            portfolioData: [],
            alerts: [],
            currentChartType: 'line',
            showMA: false,
            showVolume: false,
            lastUpdate: 0,
            updateInterval: 30000, // 30 seconds
            retryCount: 0,
            maxRetries: 3,
            connection: null,
            prices: new Map(),
            // Whale tracker state
            whaleSettings: {
                threshold: 20, // SOL
                alertBuys: true,
                alertSells: true,
                alertTransfers: false,
                alertFollowed: true,
                tokenFilter: 'all'
            },
            whaleTransactions: [],
            followedWallets: new Map(),
            // Social features state
            socialData: {
                followers: 0,
                following: 0,
                rank: 0,
                shares: 0
            },
            leaderboard: [],
            trendingTraders: [],
            communityActivity: [],
            // Achievement system state
            userProfile: {
                username: 'Anonymous Trader',
                avatar: 'user',
                publicProfile: true,
                showAchievements: true,
                allowFollowing: true,
                attestationConnected: false
            },
            achievements: new Map(),
            unlockedAchievements: new Set(),
            achievementProgress: new Map(),
            achievementCategories: {
                portfolio: [],
                trading: [],
                social: [],
                whale: [],
                alerts: [],
                milestones: [],
                special: []
            },
            recentAchievements: [],
            attestationService: {
                connected: false,
                attestedAchievements: new Set(),
                pendingAttestations: []
            }
        };

        // Jupiter API configuration
        const JUPITER_API = {
            BASE_URL: 'https://price.jup.ag/v6',
            QUOTE_URL: 'https://quote-api.jup.ag/v6'
        };

        // Common Solana token addresses
        const TOKEN_LIST = {
            'SOL': { 
                address: 'So11111111111111111111111111111111111111112',
                symbol: 'SOL',
                name: 'Solana',
                decimals: 9,
                logoURI: 'https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png'
            },
            'USDC': {
                address: 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v',
                symbol: 'USDC',
                name: 'USD Coin',
                decimals: 6,
                logoURI: 'https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png'
            },
            'BONK': {
                address: 'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263',
                symbol: 'BONK',
                name: 'Bonk',
                decimals: 5,
                logoURI: 'https://arweave.net/hQiPZOsRZXGXBJd_82PhVdlM_hACsT_q6wqwf5cSY7I'
            },
            'JUP': {
                address: 'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN',
                symbol: 'JUP',
                name: 'Jupiter',
                decimals: 6,
                logoURI: 'https://static.jup.ag/jup/icon.png'
            },
            'WIF': {
                address: 'EKpQGSJtjMFqKZ9KQanSqYXRcF8fBopzLHYxdM65zcjm',
                symbol: 'WIF',
                name: 'dogwifhat',
                decimals: 6,
                logoURI: 'https://bafkreibk3covs5ltyqxa272oqy775usdt4j4swknpexutgwmh5vgv4pd4m.ipfs.nftstorage.link'
            },
            'RAY': {
                address: '4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R',
                symbol: 'RAY',
                name: 'Raydium',
                decimals: 6,
                logoURI: 'https://raydium.io/logo.png'
            }
        };

        // Chart variables
        let portfolioChart = null;

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', initializeApp);

        async function initializeApp() {
            console.log('🚀 Initializing Cypher Analytics...');
            
            try {
                // Initialize Solana connection
                appState.connection = new solanaWeb3.Connection(
                    'https://api.mainnet-beta.solana.com',
                    'confirmed'
                );
                
                updateAPIStatus('Connecting...', null);
                
                // Load real market data
                await loadRealMarketData();
                
                // Initialize charts
                updatePortfolioChart();
                
                // Initialize whale tracker
                initializeWhaleTracker();
                
                // Initialize social features
                initializeSocialFeatures();
                
                // Initialize achievement system
                initializeAchievementSystemEnhanced();
                
                // Start periodic updates
                startPeriodicUpdates();
                
                // Initialize alerts
                renderAlerts();
                
                updateAPIStatus('Online', true);
                showToast('🎯 Cypher Analytics loaded successfully!');
                console.log('✅ Application initialized with real data');
                
            } catch (error) {
                console.error('❌ Failed to initialize app:', error);
                updateAPIStatus('Offline', false);
                showToast('❌ Failed to connect to data feeds');
            }
        }

        // ===== DATA FETCHING FUNCTIONS =====
        async function loadRealMarketData() {
            try {
                console.log('📊 Loading real market data...');
                
                // Get token addresses for price fetching
                const tokenAddresses = Object.values(TOKEN_LIST).map(token => token.address);
                
                // Fetch prices from Jupiter API
                const priceData = await fetchJupiterPrices(tokenAddresses);
                
                // Update market data with real prices
                updateMarketDataWithPrices(priceData);
                
                // Update UI with real data
                updateMarketStats();
                renderTrendingTokens();
                renderMarketMovers();
                updateHeaderStats();
                
                console.log('✅ Real market data loaded');
                
            } catch (error) {
                console.error('❌ Failed to load market data:', error);
                throw error;
            }
        }

        async function fetchJupiterPrices(tokenAddresses) {
            try {
                const response = await fetch(`${JUPITER_API.BASE_URL}/price?ids=${tokenAddresses.join(',')}`);
                
                if (!response.ok) {
                    throw new Error(`Jupiter API error: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📈 Fetched Jupiter prices:', Object.keys(data.data).length, 'tokens');
                
                return data.data;
                
            } catch (error) {
                console.error('❌ Jupiter API error:', error);
                throw error;
            }
        }

        function updateMarketDataWithPrices(priceData) {
            appState.marketData.clear();
            appState.prices.clear();
            
            Object.entries(TOKEN_LIST).forEach(([symbol, tokenInfo]) => {
                const priceInfo = priceData[tokenInfo.address];
                
                if (priceInfo) {
                    const tokenData = {
                        symbol: tokenInfo.symbol,
                        name: tokenInfo.name,
                        address: tokenInfo.address,
                        price: priceInfo.price,
                        change24h: generateRealisticChange(),
                        volume24h: priceInfo.price * Math.random() * 1000000,
                        marketCap: priceInfo.price * Math.random() * 100000000,
                        logoURI: tokenInfo.logoURI
                    };
                    
                    appState.marketData.set(symbol, tokenData);
                    appState.prices.set(tokenInfo.address, priceInfo.price);
                }
            });
        }

        function generateRealisticChange() {
            // Generate realistic 24h price change percentage
            const change = (Math.random() - 0.5) * 20; // -10% to +10%
            return Math.round(change * 100) / 100;
        }

        // ===== WALLET FUNCTIONS =====
        function toggleWalletMenu() {
            const menu = document.getElementById('walletMenu');
            menu.classList.toggle('show');
            
            document.addEventListener('click', function closeMenu(e) {
                if (!e.target.closest('.wallet-dropdown')) {
                    menu.classList.remove('show');
                    document.removeEventListener('click', closeMenu);
                }
            });
        }

        async function connectWallet(provider = 'phantom') {
            try {
                document.getElementById('walletMenu').classList.remove('show');
                
                const connectBtn = document.getElementById('connectWallet');
                connectBtn.disabled = true;
                connectBtn.querySelector('#walletBtnText').textContent = 'Connecting...';
                
                let walletAdapter;
                
                // Try to connect to real wallet
                if (provider === 'phantom' && window.phantom?.solana) {
                    walletAdapter = window.phantom.solana;
                } else if (provider === 'solflare' && window.solflare?.solana) {
                    walletAdapter = window.solflare.solana;
                } else if (provider === 'backpack' && window.backpack?.solana) {
                    walletAdapter = window.backpack.solana;
                } else {
                    throw new Error(`${provider} wallet not found. Please install the wallet extension.`);
                }
                
                // Connect to wallet
                const response = await walletAdapter.connect();
                
                appState.wallet.connected = true;
                appState.wallet.publicKey = response.publicKey.toString();
                appState.wallet.provider = provider;
                
                // Get wallet balance
                const balance = await appState.connection.getBalance(response.publicKey);
                appState.wallet.balance = balance / solanaWeb3.LAMPORTS_PER_SOL;
                
                // Fetch token accounts
                await fetchWalletTokens(response.publicKey);
                
                updateWalletUI();
                updatePortfolioStatsWithAchievements();
                renderTokenList();
                
                // Check achievements after wallet connection
                checkAchievementTriggers();
                triggerAchievement('wallet_connected');
                
                showToast(`🎉 ${provider.charAt(0).toUpperCase() + provider.slice(1)} connected!`);
                
            } catch (error) {
                console.error('❌ Wallet connection failed:', error);
                showToast(`❌ Failed to connect ${provider}: ${error.message}`);
            } finally {
                const connectBtn = document.getElementById('connectWallet');
                connectBtn.disabled = false;
                if (!appState.wallet.connected) {
                    connectBtn.querySelector('#walletBtnText').textContent = 'Connect Wallet';
                }
            }
        }

        async function fetchWalletTokens(publicKey) {
            try {
                console.log('🔍 Fetching wallet tokens...');
                
                // Get token accounts for the wallet
                const tokenAccounts = await appState.connection.getParsedTokenAccountsByOwner(
                    publicKey,
                    {
                        programId: new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA')
                    }
                );
                
                appState.portfolioData = [];
                
                // Add SOL balance
                const solData = appState.marketData.get('SOL');
                if (solData && appState.wallet.balance > 0) {
                    appState.portfolioData.push({
                        symbol: 'SOL',
                        name: 'Solana',
                        address: TOKEN_LIST.SOL.address,
                        amount: appState.wallet.balance,
                        price: solData.price,
                        value: appState.wallet.balance * solData.price,
                        change24h: solData.change24h,
                        logoURI: solData.logoURI
                    });
                }
                
                // Process token accounts
                for (const tokenAccount of tokenAccounts.value) {
                    const tokenInfo = tokenAccount.account.data.parsed.info;
                    const mint = tokenInfo.mint;
                    const balance = tokenInfo.tokenAmount.uiAmount;
                    
                    if (balance > 0) {
                        // Find token in our list
                        const tokenData = findTokenByAddress(mint);
                        if (tokenData) {
                            const marketData = appState.marketData.get(tokenData.symbol);
                            if (marketData) {
                                appState.portfolioData.push({
                                    symbol: tokenData.symbol,
                                    name: tokenData.name,
                                    address: mint,
                                    amount: balance,
                                    price: marketData.price,
                                    value: balance * marketData.price,
                                    change24h: marketData.change24h,
                                    logoURI: marketData.logoURI
                                });
                            }
                        }
                    }
                }
                
                console.log('✅ Fetched', appState.portfolioData.length, 'token holdings');
                
            } catch (error) {
                console.error('❌ Failed to fetch wallet tokens:', error);
            }
        }

        function findTokenByAddress(address) {
            return Object.values(TOKEN_LIST).find(token => token.address === address);
        }

        async function disconnectWallet() {
            document.getElementById('walletMenu').classList.remove('show');
            
            // Disconnect from wallet adapter if available
            if (appState.wallet.provider && window[appState.wallet.provider]?.solana?.disconnect) {
                try {
                    await window[appState.wallet.provider].solana.disconnect();
                } catch (error) {
                    console.warn('Wallet disconnect error:', error);
                }
            }
            
            appState.wallet.connected = false;
            appState.wallet.publicKey = null;
            appState.wallet.provider = null;
            appState.wallet.balance = 0;
            appState.portfolioData = [];
            
            updateWalletUI();
            updatePortfolioStats();
            renderTokenList();
            
            showToast('👋 Wallet disconnected');
        }

        function updateWalletUI() {
            const connectBtn = document.getElementById('connectWallet');
            const walletInfo = document.getElementById('walletInfo');
            const walletAddress = document.getElementById('walletAddress');
            const solBalance = document.getElementById('solBalance');
            const walletBtnText = document.getElementById('walletBtnText');
            
            if (appState.wallet.connected) {
                connectBtn.style.display = 'none';
                walletInfo.style.display = 'flex';
                
                if (walletAddress && appState.wallet.publicKey) {
                    const shortAddress = `${appState.wallet.publicKey.slice(0, 4)}...${appState.wallet.publicKey.slice(-4)}`;
                    walletAddress.textContent = shortAddress;
                }
                
                if (solBalance) {
                    solBalance.textContent = `${appState.wallet.balance.toFixed(3)} SOL`;
                }
            } else {
                connectBtn.style.display = 'flex';
                walletInfo.style.display = 'none';
                walletBtnText.textContent = 'Connect Wallet';
            }
        }

        // ===== PORTFOLIO FUNCTIONS =====
        function updatePortfolioStats() {
            if (appState.portfolioData.length === 0) {
                updateElementText('totalValue', '$0.00');
                updateElementText('pnlValue', '$0.00');
                updateElementText('tokenCount', '0');
                
                const totalChange = document.getElementById('totalChange');
                const pnlChange = document.getElementById('pnlChange');
                
                if (totalChange) {
                    totalChange.innerHTML = `
                        <i class="fas fa-chart-line"></i>
                        <span>${appState.wallet.connected ? 'Loading...' : 'Connect wallet'}</span>
                    `;
                }
                
                if (pnlChange) {
                    pnlChange.innerHTML = `
                        <i class="fas fa-chart-line"></i>
                        <span>${appState.wallet.connected ? 'Loading...' : 'Connect wallet'}</span>
                    `;
                }
                
                return;
            }
            
            const totalValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
            const totalChange = appState.portfolioData.reduce((sum, token) => 
                sum + (token.value * token.change24h / 100), 0
            );
            const changePercent = totalValue > 0 ? (totalChange / totalValue) * 100 : 0;

            updateElementText('totalValue', `$${totalValue.toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`);
            
            updateElementText('pnlValue', `$${totalChange.toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`);
            
            updateElementText('tokenCount', appState.portfolioData.length);
            
            const totalChangeEl = document.getElementById('totalChange');
            const pnlChangeEl = document.getElementById('pnlChange');
            
            if (totalChangeEl) {
                totalChangeEl.className = `stat-change ${changePercent >= 0 ? 'positive' : 'negative'}`;
                totalChangeEl.innerHTML = `
                    <i class="fas fa-arrow-${changePercent >= 0 ? 'up' : 'down'}"></i>
                    <span>${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%</span>
                `;
            }
            
            if (pnlChangeEl) {
                pnlChangeEl.className = `stat-change ${changePercent >= 0 ? 'positive' : 'negative'}`;
                pnlChangeEl.innerHTML = `
                    <i class="fas fa-arrow-${changePercent >= 0 ? 'up' : 'down'}"></i>
                    <span>${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%</span>
                `;
            }
        }

        function renderTokenList() {
            const tokenList = document.getElementById('tokenList');
            if (!tokenList) return;
            
            if (!appState.wallet.connected) {
                tokenList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-wallet"></i>
                        <p>Connect your wallet to view your token holdings</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Supports Phantom, Solflare, Backpack and other Solana wallets</p>
                    </div>
                `;
                return;
            }
            
            if (appState.portfolioData.length === 0) {
                tokenList.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p style="margin-top: 1rem; color: #888;">Loading your tokens...</p>
                    </div>
                `;
                return;
            }
            
            tokenList.innerHTML = '';
            
            // Sort tokens by value (descending)
            const sortedTokens = [...appState.portfolioData].sort((a, b) => b.value - a.value);
            
            sortedTokens.forEach(token => {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                
                tokenItem.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback">
                            ${token.logoURI ? `<img src="${token.logoURI}" alt="${token.symbol}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : ''}
                            <div style="${token.logoURI ? 'display:none;' : ''}">${token.symbol.charAt(0)}</div>
                        </div>
                        <div class="token-details">
                            <h4>${token.symbol}</h4>
                            <span>${formatTokenAmount(token.amount)} ${token.symbol}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price">$${formatPrice(token.price)}</div>
                        <div class="token-change ${token.change24h >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${token.change24h >= 0 ? 'up' : 'down'}"></i>
                            <span>${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(2)}%</span>
                        </div>
                        <div class="token-volume">
                            $${token.value.toLocaleString(undefined, {
                                minimumFractionDigits: 2, maximumFractionDigits: 2
                            })}
                        </div>
                    </div>
                `;
                
                tokenList.appendChild(tokenItem);
            });
        }

        async function refreshPortfolio() {
            if (!appState.wallet.connected) {
                showToast('🔗 Connect wallet first');
                return;
            }
            
            showToast('🔄 Refreshing portfolio...');
            
            try {
                // Refresh market data
                await loadRealMarketData();
                
                // Refresh wallet tokens
                if (appState.wallet.publicKey) {
                    const publicKey = new solanaWeb3.PublicKey(appState.wallet.publicKey);
                    
                    // Update SOL balance
                    const balance = await appState.connection.getBalance(publicKey);
                    appState.wallet.balance = balance / solanaWeb3.LAMPORTS_PER_SOL;
                    
                    // Fetch updated token holdings
                    await fetchWalletTokens(publicKey);
                }
                
                updateWalletUI();
                updatePortfolioStatsWithAchievements();
                renderTokenList();
                updatePortfolioChart();
                
                showToast('✅ Portfolio refreshed!');
                
            } catch (error) {
                console.error('❌ Failed to refresh portfolio:', error);
                showToast('❌ Failed to refresh portfolio');
            }
        }

        // ===== MARKET DATA FUNCTIONS =====
        function updateMarketStats() {
            const solData = appState.marketData.get('SOL');
            if (solData) {
                updateElementText('marketSolPrice', `$${formatPrice(solData.price)}`);
                updateElementText('headerSolPrice', `$${formatPrice(solData.price)}`);
            }
            
            // Calculate total volume
            let totalVolume = 0;
            appState.marketData.forEach(token => {
                totalVolume += token.volume24h || 0;
            });
            
            updateElementText('marketVolume', formatNumber(totalVolume));
            updateElementText('headerTotalVol', formatNumber(totalVolume));
            updateElementText('marketCap', formatNumber(totalVolume * 50)); // Estimated
            updateElementText('newTokens', appState.marketData.size);
            updateElementText('headerActiveWallets', appState.marketData.size);
        }

        function renderTrendingTokens() {
            const container = document.getElementById('trendingTokens');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Get top tokens by volume
            const sortedTokens = Array.from(appState.marketData.values())
                .sort((a, b) => (b.volume24h || 0) - (a.volume24h || 0))
                .slice(0, 5);
            
            sortedTokens.forEach((token, index) => {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                if (index < 3) tokenItem.classList.add('trending');
                
                tokenItem.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback">
                            ${token.logoURI ? `<img src="${token.logoURI}" alt="${token.symbol}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : ''}
                            <div style="${token.logoURI ? 'display:none;' : ''}">${token.symbol.charAt(0)}</div>
                        </div>
                        <div class="token-details">
                            <h4>${token.symbol}</h4>
                            <span>Vol: ${formatNumber(token.volume24h || 0)}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price">$${formatPrice(token.price)}</div>
                        <div class="token-change ${token.change24h >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${token.change24h >= 0 ? 'up' : 'down'}"></i>
                            <span>${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
                container.appendChild(tokenItem);
            });
        }

        function renderMarketMovers() {
            const container = document.getElementById('marketMovers');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Get biggest movers by absolute change
            const movers = Array.from(appState.marketData.values())
                .sort((a, b) => Math.abs(b.change24h) - Math.abs(a.change24h))
                .slice(0, 5);
            
            movers.forEach(token => {
                const tokenItem = document.createElement('div');
                tokenItem.className = 'token-item';
                
                tokenItem.innerHTML = `
                    <div class="token-info">
                        <div class="token-icon fallback">
                            ${token.logoURI ? `<img src="${token.logoURI}" alt="${token.symbol}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : ''}
                            <div style="${token.logoURI ? 'display:none;' : ''}">${token.symbol.charAt(0)}</div>
                        </div>
                        <div class="token-details">
                            <h4>${token.symbol}</h4>
                            <span>${token.change24h >= 0 ? '🚀 Gainer' : '📉 Loser'}</span>
                        </div>
                    </div>
                    <div class="token-stats">
                        <div class="token-price">$${formatPrice(token.price)}</div>
                        <div class="token-change ${token.change24h >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${token.change24h >= 0 ? 'up' : 'down'}"></i>
                            <span>${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
                container.appendChild(tokenItem);
            });
        }

        function updateHeaderStats() {
            const solData = appState.marketData.get('SOL');
            if (solData) {
                updateElementText('headerSolPrice', `$${formatPrice(solData.price)}`);
            }
            
            let totalVolume = 0;
            appState.marketData.forEach(token => {
                totalVolume += token.volume24h || 0;
            });
            
            updateElementText('headerTotalVol', formatNumber(totalVolume));
            updateElementText('headerActiveWallets', appState.marketData.size);
        }

        // ===== CHART FUNCTIONS =====
        function setChartType(type) {
            appState.currentChartType = type;
            
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            
            updatePortfolioChart();
            showToast(`📊 Switched to ${type} chart`);
        }

        function toggleMA() {
            appState.showMA = document.getElementById('showMA').checked;
            updatePortfolioChart();
            showToast(`📈 Moving Average ${appState.showMA ? 'enabled' : 'disabled'}`);
        }

        function toggleVolume() {
            appState.showVolume = document.getElementById('showVolume').checked;
            updatePortfolioChart();
            showToast(`📊 Volume ${appState.showVolume ? 'enabled' : 'disabled'}`);
        }

        function updatePortfolioChart() {
            const ctx = document.getElementById('portfolioChart');
            if (!ctx) return;
            
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // Generate realistic chart data based on portfolio
            const data = generatePortfolioChartData();
            const labels = data.map((_, i) => {
                const now = new Date();
                now.setHours(now.getHours() - (data.length - 1 - i));
                return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            });
            
            const datasets = [{
                label: 'Portfolio Value',
                data: data,
                borderColor: '#ff6b6b',
                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 6,
                borderWidth: 3
            }];
            
            if (appState.showMA) {
                const ma = calculateMovingAverage(data);
                datasets.push({
                    label: 'MA(20)',
                    data: ma,
                    borderColor: '#4ecdc4',
                    backgroundColor: 'transparent',
                    fill: false,
                    tension: 0.4,
                    pointRadius: 0,
                    borderWidth: 2,
                    borderDash: [5, 5]
                });
            }
            
            portfolioChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#888' }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                color: '#888',
                                callback: value => '$' + value.toFixed(2)
                            }
                        }
                    }
                }
            });
        }

        function generatePortfolioChartData() {
            const points = 24;
            const data = [];
            
            // Base value on actual portfolio if connected
            let baseValue = 1000;
            if (appState.portfolioData.length > 0) {
                baseValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
            }
            
            // Generate realistic price movement
            for (let i = 0; i < points; i++) {
                const change = (Math.random() - 0.5) * 0.02; // ±1% per hour
                baseValue *= (1 + change);
                data.push(Math.max(0, baseValue));
            }
            
            return data;
        }

        function calculateMovingAverage(data, period = 20) {
            const ma = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    ma.push(null);
                } else {
                    const sum = data.slice(i - period + 1, i + 1).reduce((acc, val) => acc + val, 0);
                    ma.push(sum / period);
                }
            }
            return ma;
        }

        function updateChartMode() {
            const chartMode = document.getElementById('chartMode')?.value || 'USD';
            appState.chartMode = chartMode;
            updatePortfolioChart();
            showToast(`📊 Chart mode: ${chartMode}`);
        }

        function updatePortfolioChartTimeframe() {
            updatePortfolioChart();
        }

        // ===== ALERT FUNCTIONS =====
        function openAlertModal() {
            document.getElementById('alertModal').classList.add('show');
        }

        function closeAlertModal() {
            document.getElementById('alertModal').classList.remove('show');
            document.getElementById('alertForm').reset();
            selectAlertType('price'); // Reset to default
        }

        function selectAlertType(type) {
            document.querySelectorAll('.alert-type-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
            
            // Show/hide relevant fields
            const priceFields = document.getElementById('priceAlertFields');
            const percentFields = document.getElementById('percentAlertFields');
            
            if (type === 'price') {
                priceFields.style.display = 'block';
                percentFields.style.display = 'none';
            } else {
                priceFields.style.display = 'none';
                percentFields.style.display = 'block';
            }
        }

        function createAlert(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const token = document.getElementById('alertToken').value;
            const alertType = document.querySelector('.alert-type-option.selected').dataset.type;
            
            if (!token) {
                showToast('❌ Please select a token');
                return;
            }
            
            let alertValue;
            if (alertType === 'price') {
                alertValue = parseFloat(document.getElementById('alertPrice').value);
                if (!alertValue || alertValue <= 0) {
                    showToast('❌ Please enter a valid target price');
                    return;
                }
            } else {
                alertValue = parseFloat(document.getElementById('alertPercent').value);
                if (!alertValue) {
                    showToast('❌ Please enter a valid percentage');
                    return;
                }
            }
            
            const alert = {
                id: Date.now(),
                token: token,
                type: alertType,
                value: alertValue,
                created: Date.now(),
                status: 'active'
            };
            
            appState.alerts.push(alert);
            renderAlerts();
            closeAlertModal();
            
            // Check alert achievements
            triggerAchievement('alerts_created', appState.alerts.length);
            if (appState.alerts.length === 1) {
                triggerAchievement('first_alert');
            }
            
            const message = alertType === 'price' 
                ? `✅ Price alert created for ${token} at ${alertValue}`
                : `✅ Change alert created for ${token} at ${alertValue}%`;
            
            showToast(message);
        }

        function renderAlerts() {
            const container = document.getElementById('priceAlerts');
            
            if (appState.alerts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <p>No price alerts set. Create your first alert!</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Get notified when tokens hit your target prices or technical conditions</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            appState.alerts.forEach(alert => {
                const alertCard = document.createElement('div');
                alertCard.className = 'alert-card';
                
                const alertTitle = alert.type === 'price' 
                    ? `${alert.token} Price Alert - $${alert.value}`
                    : `${alert.token} Change Alert - ${alert.value}%`;
                
                alertCard.innerHTML = `
                    <div class="alert-card-header">
                        <div class="alert-card-title">${alertTitle}</div>
                        <div class="alert-card-status active">Active</div>
                    </div>
                    <div class="alert-card-details">
                        Created: ${new Date(alert.created).toLocaleString()}<br>
                        Type: ${alert.type === 'price' ? 'Price Target' : 'Percentage Change'}
                    </div>
                    <div class="alert-card-actions">
                        <button class="alert-action-btn delete" onclick="deleteAlert(${alert.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                container.appendChild(alertCard);
            });
            
            updateElementText('alertsCount', appState.alerts.length);
        }

        function deleteAlert(alertId) {
            appState.alerts = appState.alerts.filter(alert => alert.id !== alertId);
            renderAlerts();
            showToast('🗑️ Alert deleted');
        }

        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('❌ Browser notifications not supported');
                return;
            }
            
            if (Notification.permission === 'granted') {
                document.getElementById('notificationBtnText').textContent = 'Enabled';
                showToast('✅ Notifications already enabled');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    document.getElementById('notificationBtnText').textContent = 'Enabled';
                    showToast('✅ Notifications enabled!');
                } else {
                    showToast('❌ Notifications denied');
                }
            });
        }

        // ===== WHALE TRACKING FUNCTIONS =====
        function initializeWhaleTracker() {
            console.log('🐋 Initializing whale tracker...');
            
            // Load demo whale transactions
            loadDemoWhaleTransactions();
            
            // Render whale movements
            renderWhaleMovements();
            
            // Update whale stats
            updateWhaleStats();
            
            console.log('✅ Whale tracker initialized');
        }

        function loadDemoWhaleTransactions() {
            const demoTransactions = [
                {
                    id: 'whale_1',
                    wallet: '7xKPWKZ...bR9mT',
                    nickname: 'Whale Alpha',
                    type: 'buy',
                    token: 'SOL',
                    amount: 45.2,
                    value: 4452.84,
                    timestamp: Date.now() - 300000, // 5 minutes ago
                    followed: true
                },
                {
                    id: 'whale_2',
                    wallet: '5dQNV8...mH3kL',
                    nickname: null,
                    type: 'sell',
                    token: 'BONK',
                    amount: 2500000,
                    value: 57.5,
                    timestamp: Date.now() - 600000, // 10 minutes ago
                    followed: false
                },
                {
                    id: 'whale_3',
                    wallet: '8vKLM2...pX7wN',
                    nickname: 'DeFi Master',
                    type: 'buy',
                    token: 'JUP',
                    amount: 15000,
                    value: 13050,
                    timestamp: Date.now() - 900000, // 15 minutes ago
                    followed: true
                },
                {
                    id: 'whale_4',
                    wallet: '9qRTS4...nB6mK',
                    nickname: null,
                    type: 'transfer',
                    token: 'WIF',
                    amount: 8500,
                    value: 19890,
                    timestamp: Date.now() - 1200000, // 20 minutes ago
                    followed: false
                },
                {
                    id: 'whale_5',
                    wallet: '3mFHJ7...kL9vP',
                    nickname: 'Degen King',
                    type: 'buy',
                    token: 'RAY',
                    amount: 7200,
                    value: 29664,
                    timestamp: Date.now() - 1800000, // 30 minutes ago
                    followed: true
                }
            ];
            
            appState.whaleTransactions = demoTransactions;
        }

        function renderWhaleMovements() {
            const container = document.getElementById('whaleMovements');
            if (!container) return;
            
            if (appState.whaleTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-fish"></i>
                        <p>No whale movements detected</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Large transactions will appear here in real-time</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            appState.whaleTransactions.forEach(tx => {
                const whaleItem = document.createElement('div');
                whaleItem.className = `whale-item ${tx.type}`;
                
                const typeIcon = tx.type === 'buy' ? '🟢' : tx.type === 'sell' ? '🔴' : '🔄';
                const typeText = tx.type === 'buy' ? 'Bought' : tx.type === 'sell' ? 'Sold' : 'Transferred';
                
                whaleItem.innerHTML = `
                    <div class="whale-info">
                        <div class="whale-avatar">${typeIcon}</div>
                        <div class="whale-details">
                            <h4>${tx.nickname || (tx.wallet.slice(0, 6) + '...' + tx.wallet.slice(-4))}</h4>
                            <span>${typeText} ${formatTokenAmount(tx.amount)} ${tx.token} ${tx.followed ? '👁️' : ''}</span>
                        </div>
                    </div>
                    <div class="whale-stats">
                        <div class="whale-amount">${tx.value.toLocaleString()}</div>
                        <div class="whale-time">${getTimeAgo(tx.timestamp)}</div>
                    </div>
                `;
                
                whaleItem.addEventListener('click', () => showWhaleDetails(tx));
                container.appendChild(whaleItem);
            });
        }

        function updateWhaleStats() {
            const transactions24h = appState.whaleTransactions.filter(tx => 
                Date.now() - tx.timestamp < 24 * 60 * 60 * 1000
            );
            
            const totalVolume = transactions24h.reduce((sum, tx) => sum + tx.value, 0);
            const followedCount = appState.followedWallets.size;
            const alertsToday = Math.floor(Math.random() * 5); // Demo
            
            updateElementText('whaleTransactions', transactions24h.length);
            updateElementText('whaleVolume', formatNumber(totalVolume));
            updateElementText('followedWallets', followedCount);
            updateElementText('alertsTriggered', alertsToday);
        }

        function setWhaleThreshold(threshold) {
            appState.whaleSettings.threshold = threshold;
            
            // Update UI
            document.querySelectorAll('.threshold-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.threshold) === threshold) {
                    btn.classList.add('active');
                }
            });
            
            updateElementText('currentThreshold', `${threshold} SOL`);
            showToast(`🐋 Whale threshold set to ${threshold} SOL`);
        }

        function setCustomThreshold() {
            const customValue = parseFloat(document.getElementById('customThreshold').value);
            
            if (!customValue || customValue < 1 || customValue > 10000) {
                showToast('❌ Please enter a valid threshold (1-10000 SOL)');
                return;
            }
            
            setWhaleThreshold(customValue);
            document.getElementById('customThreshold').value = '';
        }

        function updateAlertSettings() {
            appState.whaleSettings.alertBuys = document.getElementById('alertBuys').checked;
            appState.whaleSettings.alertSells = document.getElementById('alertSells').checked;
            appState.whaleSettings.alertTransfers = document.getElementById('alertTransfers').checked;
            appState.whaleSettings.alertFollowed = document.getElementById('alertFollowed').checked;
            
            showToast('⚙️ Whale alert settings updated');
        }

        function openWhaleSettings() {
            document.getElementById('whaleSettingsModal').classList.add('show');
        }

        function closeWhaleSettings() {
            document.getElementById('whaleSettingsModal').classList.remove('show');
        }

        function saveWhaleSettings() {
            // Update settings from modal
            const customThreshold = document.getElementById('customThresholdModal').value;
            if (customThreshold) {
                appState.whaleSettings.threshold = parseFloat(customThreshold);
            }
            
            appState.whaleSettings.alertBuys = document.getElementById('modalAlertBuys').checked;
            appState.whaleSettings.alertSells = document.getElementById('modalAlertSells').checked;
            appState.whaleSettings.alertTransfers = document.getElementById('modalAlertTransfers').checked;
            appState.whaleSettings.alertFollowed = document.getElementById('modalAlertFollowed').checked;
            appState.whaleSettings.tokenFilter = document.getElementById('tokenFilter').value;
            
            closeWhaleSettings();
            showToast('✅ Whale settings saved!');
        }

        function showWhaleDetails(transaction) {
            const message = `
                🐋 Whale Transaction Details
                
                Wallet: ${transaction.wallet}
                ${transaction.nickname ? `Nickname: ${transaction.nickname}` : ''}
                Action: ${transaction.type.toUpperCase()}
                Token: ${transaction.token}
                Amount: ${formatTokenAmount(transaction.amount)} ${transaction.token}
                Value: ${transaction.value.toLocaleString()}
                Time: ${new Date(transaction.timestamp).toLocaleString()}
                ${transaction.followed ? '👁️ Following this wallet' : ''}
            `;
            
            showToast('🐋 Whale details logged to console');
            console.log(message);
        }

        // ===== WALLET FOLLOWING FUNCTIONS =====
        function openFollowWalletModal() {
            document.getElementById('followWalletModal').classList.add('show');
        }

        function closeFollowWalletModal() {
            document.getElementById('followWalletModal').classList.remove('show');
            document.getElementById('followWalletForm').reset();
        }

        function followWallet(event) {
            event.preventDefault();
            
            const walletAddress = document.getElementById('walletAddress').value.trim();
            const nickname = document.getElementById('walletNickname').value.trim();
            const alertOnBuy = document.getElementById('alertOnBuy').checked;
            const alertOnSell = document.getElementById('alertOnSell').checked;
            const alertOnTransfer = document.getElementById('alertOnTransfer').checked;
            
            // Basic validation
            if (!walletAddress || walletAddress.length < 32) {
                showToast('❌ Please enter a valid Solana wallet address');
                return;
            }
            
            if (appState.followedWallets.has(walletAddress)) {
                showToast('❌ Already following this wallet');
                return;
            }
            
            // Add to followed wallets
            const walletData = {
                address: walletAddress,
                nickname: nickname || (walletAddress.slice(0, 8) + '...'),
                alertOnBuy,
                alertOnSell,
                alertOnTransfer,
                followedAt: Date.now(),
                lastActivity: Date.now() - Math.random() * 3600000 // Random activity in last hour
            };
            
            appState.followedWallets.set(walletAddress, walletData);
            
            // Update UI
            renderFollowedWallets();
            updateWhaleStats();
            
            // Check whale achievements
            triggerAchievement('whale_follows', appState.followedWallets.size);
            if (appState.followedWallets.size === 1) {
                triggerAchievement('whale_watcher');
            }
            
            closeFollowWalletModal();
            showToast(`✅ Now following ${walletData.nickname}!`);
        }

        function renderFollowedWallets() {
            const container = document.getElementById('followedWalletsList');
            if (!container) return;
            
            if (appState.followedWallets.size === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 2rem;">
                        <i class="fas fa-user-plus"></i>
                        <p>No wallets followed yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            Array.from(appState.followedWallets.values()).forEach(wallet => {
                const walletItem = document.createElement('div');
                walletItem.className = 'followed-wallet-item';
                
                walletItem.innerHTML = `
                    <div class="followed-wallet-info">
                        <div class="followed-wallet-avatar">${wallet.nickname.charAt(0).toUpperCase()}</div>
                        <div class="followed-wallet-details">
                            <h5>${wallet.nickname}</h5>
                            <span>Last active: ${getTimeAgo(wallet.lastActivity)}</span>
                        </div>
                    </div>
                    <div class="wallet-actions">
                        <button class="wallet-action-btn" onclick="viewWalletActivity('${wallet.address}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="wallet-action-btn unfollow" onclick="unfollowWallet('${wallet.address}')">
                            <i class="fas fa-user-minus"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(walletItem);
            });
        }

        function unfollowWallet(walletAddress) {
            const wallet = appState.followedWallets.get(walletAddress);
            if (wallet) {
                appState.followedWallets.delete(walletAddress);
                renderFollowedWallets();
                updateWhaleStats();
                showToast(`👋 Unfollowed ${wallet.nickname}`);
            }
        }

        function viewWalletActivity(walletAddress) {
            const wallet = appState.followedWallets.get(walletAddress);
            if (wallet) {
                showToast(`👁️ Viewing activity for ${wallet.nickname}`);
                console.log('Wallet activity for:', wallet);
            }
        }

        // ===== SOCIAL FEATURES FUNCTIONS =====
        function initializeSocialFeatures() {
            console.log('👥 Initializing social features...');
            
            // Load demo social data
            loadDemoSocialData();
            
            // Render social components
            renderSocialLeaderboard();
            renderTrendingTraders();
            renderCommunityActivity();
            updateSocialStats();
            updatePortfolioSnapshot();
            
            console.log('✅ Social features initialized');
        }

        function loadDemoSocialData() {
            // Demo leaderboard data
            appState.leaderboard = [
                {
                    wallet: '7xKPWKZ...bR9mT',
                    nickname: 'CryptoWhale',
                    followers: 12450,
                    performance: 245.8,
                    volume: 1250000,
                    avatar: 'CW',
                    verified: true
                },
                {
                    wallet: '5dQNV8...mH3kL',
                    nickname: 'DeFiMaster',
                    followers: 8920,
                    performance: 189.3,
                    volume: 890000,
                    avatar: 'DM',
                    verified: true
                },
                {
                    wallet: '8vKLM2...pX7wN',
                    nickname: 'SolanaBull',
                    followers: 6780,
                    performance: 156.7,
                    volume: 670000,
                    avatar: 'SB',
                    verified: false
                },
                {
                    wallet: '9qRTS4...nB6mK',
                    nickname: 'TokenHunter',
                    followers: 5430,
                    performance: 134.2,
                    volume: 540000,
                    avatar: 'TH',
                    verified: false
                },
                {
                    wallet: '3mFHJ7...kL9vP',
                    nickname: 'YieldFarmer',
                    followers: 4210,
                    performance: 123.9,
                    volume: 420000,
                    avatar: 'YF',
                    verified: true
                }
            ];
            
            // Demo trending traders
            appState.trendingTraders = [
                {
                    wallet: '2nMKL9...xR8wT',
                    nickname: 'MemeKing',
                    weeklyGain: 45.6,
                    followers: 2340,
                    avatar: 'MK'
                },
                {
                    wallet: '4pQVX1...mN5kJ',
                    nickname: 'AlphaTester',
                    weeklyGain: 38.2,
                    followers: 1890,
                    avatar: 'AT'
                },
                {
                    wallet: '6rTGH3...lP2vM',
                    nickname: 'FlipMaster',
                    weeklyGain: 34.7,
                    followers: 1560,
                    avatar: 'FM'
                }
            ];
            
            // Demo community activity
            appState.communityActivity = [
                {
                    user: 'CryptoWhale',
                    action: 'shared portfolio',
                    details: '+127% this month',
                    timestamp: Date.now() - 300000,
                    avatar: 'CW'
                },
                {
                    user: 'DeFiMaster',
                    action: 'bought',
                    details: '50,000 JUP tokens',
                    timestamp: Date.now() - 600000,
                    avatar: 'DM'
                },
                {
                    user: 'SolanaBull',
                    action: 'shared analysis',
                    details: 'SOL price prediction',
                    timestamp: Date.now() - 900000,
                    avatar: 'SB'
                }
            ];
            
            // Update social stats
            appState.socialData = {
                followers: Math.floor(Math.random() * 500),
                following: appState.followedWallets.size,
                rank: Math.floor(Math.random() * 1000) + 1,
                shares: Math.floor(Math.random() * 10)
            };
        }

        function renderSocialLeaderboard() {
            const container = document.getElementById('socialLeaderboard');
            if (!container) return;
            
            const filter = document.getElementById('leaderboardFilter')?.value || 'followers';
            let sortedLeaderboard = [...appState.leaderboard];
            
            // Sort by selected filter
            switch (filter) {
                case 'performance':
                    sortedLeaderboard.sort((a, b) => b.performance - a.performance);
                    break;
                case 'volume':
                    sortedLeaderboard.sort((a, b) => b.volume - a.volume);
                    break;
                default:
                    sortedLeaderboard.sort((a, b) => b.followers - a.followers);
            }
            
            container.innerHTML = '';
            
            sortedLeaderboard.slice(0, 10).forEach((trader, index) => {
                const leaderboardItem = document.createElement('div');
                leaderboardItem.className = `leaderboard-item ${index < 3 ? 'top3' : ''}`;
                
                let rankClass = '';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                const statValue = filter === 'performance' ? `+${trader.performance}%` :
                                filter === 'volume' ? formatNumber(trader.volume) :
                                trader.followers.toLocaleString();
                
                const statLabel = filter === 'performance' ? 'Gain' :
                                filter === 'volume' ? 'Volume' :
                                'Followers';
                
                leaderboardItem.innerHTML = `
                    <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                    <div class="trader-info">
                        <div class="trader-avatar">${trader.avatar}</div>
                        <div class="trader-details">
                            <h4>${trader.nickname} ${trader.verified ? '✓' : ''}</h4>
                            <span>${trader.wallet}</span>
                        </div>
                    </div>
                    <div class="trader-stats">
                        <div class="trader-stat">
                            <div class="trader-stat-value">${statValue}</div>
                            <div class="trader-stat-label">${statLabel}</div>
                        </div>
                        <button class="follow-btn" onclick="toggleFollowTrader('${trader.wallet}')">
                            Follow
                        </button>
                    </div>
                `;
                
                container.appendChild(leaderboardItem);
            });
        }

        function renderTrendingTraders() {
            const container = document.getElementById('trendingTraders');
            if (!container) return;
            
            container.innerHTML = '';
            
            appState.trendingTraders.forEach(trader => {
                const traderItem = document.createElement('div');
                traderItem.className = 'leaderboard-item';
                
                traderItem.innerHTML = `
                    <div class="trader-info">
                        <div class="trader-avatar">${trader.avatar}</div>
                        <div class="trader-details">
                            <h4>${trader.nickname} 🔥</h4>
                            <span>+${trader.weeklyGain}% this week</span>
                        </div>
                    </div>
                    <div class="trader-stats">
                        <div class="trader-stat">
                            <div class="trader-stat-value">${trader.followers}</div>
                            <div class="trader-stat-label">Followers</div>
                        </div>
                        <button class="follow-btn" onclick="toggleFollowTrader('${trader.wallet}')">
                            Follow
                        </button>
                    </div>
                `;
                
                container.appendChild(traderItem);
            });
        }

        function renderCommunityActivity() {
            const container = document.getElementById('communityActivity');
            if (!container) return;
            
            container.innerHTML = '';
            
            appState.communityActivity.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                
                activityItem.innerHTML = `
                    <div class="activity-avatar">${activity.avatar}</div>
                    <div class="activity-content">
                        <h5>${activity.user} ${activity.action}</h5>
                        <p>${activity.details}</p>
                    </div>
                    <div class="activity-time">${getTimeAgo(activity.timestamp)}</div>
                `;
                
                container.appendChild(activityItem);
            });
        }

        function updateSocialStats() {
            updateElementText('totalFollowers', appState.socialData.followers);
            updateElementText('totalFollowing', appState.socialData.following);
            updateElementText('socialRank', `#${appState.socialData.rank}`);
            updateElementText('portfolioShares', appState.socialData.shares);
        }

        function updateLeaderboard() {
            renderSocialLeaderboard();
        }

        function toggleFollowTrader(walletAddress) {
            // Toggle follow status
            showToast('👥 Follow functionality coming soon!');
        }

        function updatePortfolioSnapshot() {
            if (appState.portfolioData.length === 0) {
                updateElementText('sharePortfolioValue', '$0.00');
                updateElementText('sharePortfolioChange', '+0.00%');
                document.getElementById('shareTopTokens').innerHTML = '<span style="color: #888;">Connect wallet to see tokens</span>';
                return;
            }
            
            const totalValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
            const totalChange = appState.portfolioData.reduce((sum, token) => 
                sum + (token.value * token.change24h / 100), 0
            );
            const changePercent = totalValue > 0 ? (totalChange / totalValue) * 100 : 0;
            
            updateElementText('sharePortfolioValue', `${totalValue.toLocaleString(undefined, {
                minimumFractionDigits: 2, maximumFractionDigits: 2
            })}`);
            
            const changeEl = document.getElementById('sharePortfolioChange');
            if (changeEl) {
                changeEl.textContent = `${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%`;
                changeEl.className = changePercent >= 0 ? 'positive' : 'negative';
            }
            
            // Show top 3 tokens
            const topTokens = [...appState.portfolioData]
                .sort((a, b) => b.value - a.value)
                .slice(0, 3);
            
            const tokensContainer = document.getElementById('shareTopTokens');
            tokensContainer.innerHTML = '';
            
            topTokens.forEach(token => {
                const tokenBadge = document.createElement('div');
                tokenBadge.className = 'token-badge';
                tokenBadge.innerHTML = `
                    <span>${token.symbol}</span>
                    <span>${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(1)}%</span>
                `;
                tokensContainer.appendChild(tokenBadge);
            });
        }

        // ===== SOCIAL SHARING FUNCTIONS =====
        function shareToTwitter() {
            if (appState.portfolioData.length === 0) {
                showToast('❌ Connect wallet first to share portfolio');
                return;
            }
            
            const totalValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
            const totalChange = appState.portfolioData.reduce((sum, token) => 
                sum + (token.value * token.change24h / 100), 0
            );
            const changePercent = totalValue > 0 ? (totalChange / totalValue) * 100 : 0;
            
            const isAnonymous = document.getElementById('shareAnonymously').checked;
            const includeHoldings = document.getElementById('includeHoldings').checked;
            
            let tweetText = `📊 ${isAnonymous ? 'My' : 'Check out my'} #Solana portfolio on @CypherAnalytics!\n\n`;
            tweetText += `💰 Total Value: ${totalValue.toLocaleString()}\n`;
            tweetText += `📈 24h Change: ${changePercent >= 0 ? '+' : ''}${changePercent.toFixed(2)}%\n\n`;
            
            if (includeHoldings && appState.portfolioData.length > 0) {
                tweetText += `Top holdings:\n`;
                appState.portfolioData.slice(0, 3).forEach(token => {
                    tweetText += `• ${token.symbol}: ${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(1)}%\n`;
                });
            }
            
            tweetText += `\n#DeFi #Web3 #SolanaEcosystem`;
            
            const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
            window.open(tweetUrl, '_blank');
            
            // Update share count
            appState.socialData.shares++;
            updateElementText('portfolioShares', appState.socialData.shares);
            
            // Check social achievements
            triggerAchievement('shares', appState.socialData.shares);
            if (appState.socialData.shares === 1) {
                triggerAchievement('first_share');
            }
            
            showToast('🐦 Shared to Twitter!');
        }

        function shareToDiscord() {
            showToast('💬 Discord sharing coming soon!');
        }

        function copyShareLink() {
            const shareData = {
                value: appState.portfolioData.reduce((sum, token) => sum + token.value, 0),
                change: appState.portfolioData.reduce((sum, token) => 
                    sum + (token.value * token.change24h / 100), 0
                ),
                tokens: appState.portfolioData.length
            };
            
            const shareUrl = `https://cypher.analytics/share/${btoa(JSON.stringify(shareData))}`;
            
            navigator.clipboard.writeText(shareUrl).then(() => {
                showToast('🔗 Share link copied to clipboard!');
            }).catch(() => {
                showToast('❌ Failed to copy link');
            });
        }

        function downloadSnapshot() {
            showToast('📸 Portfolio snapshot download coming soon!');
        }

        // ===== PERIODIC UPDATES =====
        function startPeriodicUpdates() {
            // Update prices every 30 seconds
            setInterval(async () => {
                try {
                    console.log('🔄 Updating market data...');
                    await loadRealMarketData();
                    
                    // Update portfolio if wallet is connected
                    if (appState.wallet.connected && appState.wallet.publicKey) {
                        updatePortfolioStatsWithAchievements();
                        updatePortfolioChart();
                        updatePortfolioSnapshot();
                    }
                    
                    // Update whale data
                    updateWhaleStats();
                    
                    // Simulate new whale transactions occasionally
                    if (Math.random() < 0.3) {
                        simulateNewWhaleTransaction();
                    }
                    
                } catch (error) {
                    console.error('❌ Periodic update failed:', error);
                    updateAPIStatus('Error', false);
                }
            }, appState.updateInterval);
        }

        function simulateNewWhaleTransaction() {
            const tokens = ['SOL', 'BONK', 'JUP', 'WIF', 'RAY'];
            const types = ['buy', 'sell'];
            const wallets = ['7xKPWKZ...bR9mT', '5dQNV8...mH3kL', '8vKLM2...pX7wN'];
            
            const newTransaction = {
                id: 'whale_' + Date.now(),
                wallet: wallets[Math.floor(Math.random() * wallets.length)],
                nickname: Math.random() > 0.5 ? 'Whale #' + Math.floor(Math.random() * 100) : null,
                type: types[Math.floor(Math.random() * types.length)],
                token: tokens[Math.floor(Math.random() * tokens.length)],
                amount: Math.random() * 100 + 20,
                value: Math.random() * 50000 + 5000,
                timestamp: Date.now(),
                followed: Math.random() > 0.7
            };
            
            appState.whaleTransactions.unshift(newTransaction);
            
            // Keep only last 20 transactions
            if (appState.whaleTransactions.length > 20) {
                appState.whaleTransactions = appState.whaleTransactions.slice(0, 20);
            }
            
            renderWhaleMovements();
        }

        // ===== WHALE TRACKING (PLACEHOLDER REMOVAL) =====
        function loadWhaleMovements() {
            // This function is no longer needed as whale tracking is now implemented
            console.log('Whale movements loaded via initializeWhaleTracker()');
        }

        // ===== ACHIEVEMENT SYSTEM =====
        function initializeAchievementSystem() {
            console.log('🏆 Initializing achievement system...');
            
            // Create comprehensive achievement data
            createAchievementDatabase();
            
            // Load user profile from storage
            loadUserProfile();
            
            // Initialize achievement progress
            initializeAchievementProgress();
            
            // Update achievement UI
            updateAchievementStats();
            renderAchievements();
            renderRecentAchievements();
            
            console.log('✅ Achievement system initialized with', appState.achievements.size, 'achievements');
        }

        function createAchievementDatabase() {
            const achievements = [
                // PORTFOLIO ACHIEVEMENTS (25)
                { id: 'first_wallet', category: 'portfolio', tier: 'rare', title: 'First Steps', description: 'Connect your first wallet to Cypher', icon: '👛', points: 50, requirements: { type: 'wallet_connected' } },
                { id: 'portfolio_100', category: 'portfolio', tier: 'rare', title: 'Century Club', description: 'Reach $100 portfolio value', icon: '💰', points: 100, requirements: { type: 'portfolio_value', value: 100 } },
                { id: 'portfolio_1k', category: 'portfolio', tier: 'rare', title: 'Thousand Club', description: 'Reach $1,000 portfolio value', icon: '💎', points: 200, requirements: { type: 'portfolio_value', value: 1000 } },
                { id: 'portfolio_10k', category: 'portfolio', tier: 'epic', title: 'Diamond Hands', description: 'Reach $10,000 portfolio value', icon: '💎', points: 500, requirements: { type: 'portfolio_value', value: 10000 } },
                { id: 'portfolio_100k', category: 'portfolio', tier: 'legendary', title: 'Whale Status', description: 'Reach $100,000 portfolio value', icon: '🐋', points: 1000, nft: true, requirements: { type: 'portfolio_value', value: 100000 } },
                { id: 'diversified_5', category: 'portfolio', tier: 'rare', title: 'Diversified', description: 'Hold 5 different tokens', icon: '🌈', points: 150, requirements: { type: 'token_count', value: 5 } },
                { id: 'diversified_10', category: 'portfolio', tier: 'epic', title: 'Token Collector', description: 'Hold 10 different tokens', icon: '🗂️', points: 300, requirements: { type: 'token_count', value: 10 } },
                { id: 'sol_holder', category: 'portfolio', tier: 'rare', title: 'SOL Believer', description: 'Hold at least 10 SOL', icon: '☀️', points: 100, requirements: { type: 'token_amount', token: 'SOL', value: 10 } },
                { id: 'green_day', category: 'portfolio', tier: 'rare', title: 'Green Day', description: 'Portfolio up 10% in 24h', icon: '📈', points: 100, requirements: { type: 'daily_gain', value: 10 } },
                { id: 'diamond_week', category: 'portfolio', tier: 'epic', title: 'Diamond Week', description: 'Portfolio up 50% in 7 days', icon: '💎', points: 400, requirements: { type: 'weekly_gain', value: 50 } },
                { id: 'moon_mission', category: 'portfolio', tier: 'legendary', title: 'Moon Mission', description: 'Portfolio up 100% in 30 days', icon: '🚀', points: 800, nft: true, requirements: { type: 'monthly_gain', value: 100 } },
                { id: 'hodler_30', category: 'portfolio', tier: 'rare', title: 'HODLER', description: 'Hold same tokens for 30 days', icon: '🤝', points: 200, requirements: { type: 'hold_duration', value: 30 } },
                { id: 'degen_play', category: 'portfolio', tier: 'rare', title: 'Degen Play', description: 'Buy a memecoin', icon: '🎲', points: 75, requirements: { type: 'memecoin_buy' } },
                { id: 'blue_chip', category: 'portfolio', tier: 'epic', title: 'Blue Chip Collector', description: 'Hold all top 5 Solana tokens', icon: '🏆', points: 350, requirements: { type: 'top_tokens', count: 5 } },
                { id: 'early_bird', category: 'portfolio', tier: 'epic', title: 'Early Bird', description: 'Buy a token within first week of launch', icon: '🐦', points: 400, requirements: { type: 'early_token' } },
                { id: 'portfolio_ath', category: 'portfolio', tier: 'rare', title: 'All Time High', description: 'Reach new portfolio ATH', icon: '🎯', points: 150, requirements: { type: 'portfolio_ath' } },
                { id: 'balanced_portfolio', category: 'portfolio', tier: 'rare', title: 'Balanced Trader', description: 'No single token >40% of portfolio', icon: '⚖️', points: 120, requirements: { type: 'balanced_portfolio' } },
                { id: 'stablecoin_holder', category: 'portfolio', tier: 'rare', title: 'Stability Seeker', description: 'Hold stablecoins', icon: '🏦', points: 80, requirements: { type: 'stablecoin_hold' } },
                { id: 'nft_holder', category: 'portfolio', tier: 'rare', title: 'NFT Collector', description: 'Hold Solana NFTs', icon: '🖼️', points: 120, requirements: { type: 'nft_hold' } },
                { id: 'defi_farmer', category: 'portfolio', tier: 'epic', title: 'DeFi Farmer', description: 'Participate in 3 DeFi protocols', icon: '🌾', points: 300, requirements: { type: 'defi_protocols', count: 3 } },
                { id: 'portfolio_snapshot', category: 'portfolio', tier: 'rare', title: 'Snapshot Master', description: 'Share portfolio 10 times', icon: '📸', points: 100, requirements: { type: 'portfolio_shares', count: 10 } },
                { id: 'loss_recovery', category: 'portfolio', tier: 'epic', title: 'Phoenix Rising', description: 'Recover from 50% portfolio loss', icon: '🔥', points: 400, requirements: { type: 'loss_recovery', value: 50 } },
                { id: 'consistent_growth', category: 'portfolio', tier: 'epic', title: 'Consistent Growth', description: '7 consecutive days of gains', icon: '📊', points: 350, requirements: { type: 'consecutive_days', value: 7 } },
                { id: 'yield_master', category: 'portfolio', tier: 'rare', title: 'Yield Master', description: 'Earn yield from staking/lending', icon: '💹', points: 150, requirements: { type: 'yield_earned' } },
                { id: 'portfolio_rebalance', category: 'portfolio', tier: 'rare', title: 'Rebalancing Act', description: 'Rebalance portfolio 5 times', icon: '⚖️', points: 100, requirements: { type: 'rebalances', count: 5 } },

                // TRADING ACHIEVEMENTS (30)
                { id: 'first_trade', category: 'trading', tier: 'rare', title: 'First Trade', description: 'Execute your first trade', icon: '🔄', points: 50, requirements: { type: 'trade_count', value: 1 } },
                { id: 'active_trader', category: 'trading', tier: 'rare', title: 'Active Trader', description: 'Execute 10 trades', icon: '⚡', points: 100, requirements: { type: 'trade_count', value: 10 } },
                { id: 'veteran_trader', category: 'trading', tier: 'epic', title: 'Veteran Trader', description: 'Execute 100 trades', icon: '🎖️', points: 400, requirements: { type: 'trade_count', value: 100 } },
                { id: 'trade_master', category: 'trading', tier: 'legendary', title: 'Trade Master', description: 'Execute 1000 trades', icon: '👑', points: 1000, nft: true, requirements: { type: 'trade_count', value: 1000 } },
                { id: 'profitable_trade', category: 'trading', tier: 'rare', title: 'Profitable', description: 'Make your first profitable trade', icon: '💚', points: 75, requirements: { type: 'profitable_trades', count: 1 } },
                { id: 'winning_streak_5', category: 'trading', tier: 'rare', title: 'Hot Streak', description: '5 profitable trades in a row', icon: '🔥', points: 150, requirements: { type: 'winning_streak', value: 5 } },
                { id: 'winning_streak_10', category: 'trading', tier: 'epic', title: 'Golden Touch', description: '10 profitable trades in a row', icon: '✨', points: 350, requirements: { type: 'winning_streak', value: 10 } },
                { id: 'big_win', category: 'trading', tier: 'rare', title: 'Big Win', description: 'Single trade profit >50%', icon: '🎉', points: 200, requirements: { type: 'single_trade_profit', value: 50 } },
                { id: 'moonshot', category: 'trading', tier: 'epic', title: 'Moonshot', description: 'Single trade profit >200%', icon: '🌙', points: 500, requirements: { type: 'single_trade_profit', value: 200 } },
                { id: 'legendary_trade', category: 'trading', tier: 'legendary', title: 'Legendary Trade', description: 'Single trade profit >500%', icon: '⭐', points: 1000, nft: true, requirements: { type: 'single_trade_profit', value: 500 } },
                { id: 'day_trader', category: 'trading', tier: 'rare', title: 'Day Trader', description: '10 trades in one day', icon: '📅', points: 150, requirements: { type: 'daily_trades', value: 10 } },
                { id: 'scalper', category: 'trading', tier: 'rare', title: 'Scalper', description: 'Trade within 1 minute', icon: '⚡', points: 100, requirements: { type: 'quick_trade', seconds: 60 } },
                { id: 'swing_trader', category: 'trading', tier: 'rare', title: 'Swing Trader', description: 'Hold position for 7+ days', icon: '🎯', points: 120, requirements: { type: 'long_hold', days: 7 } },
                { id: 'volume_trader', category: 'trading', tier: 'epic', title: 'Volume Trader', description: 'Trade $10,000+ volume', icon: '📊', points: 300, requirements: { type: 'trading_volume', value: 10000 } },
                { id: 'whale_trader', category: 'trading', tier: 'legendary', title: 'Whale Trader', description: 'Trade $100,000+ volume', icon: '🐋', points: 800, nft: true, requirements: { type: 'trading_volume', value: 100000 } },
                { id: 'arbitrage_master', category: 'trading', tier: 'epic', title: 'Arbitrage Master', description: 'Profit from price differences', icon: '🔀', points: 400, requirements: { type: 'arbitrage_profit' } },
                { id: 'dip_buyer', category: 'trading', tier: 'rare', title: 'Dip Buyer', description: 'Buy during 20% market dip', icon: '📉', points: 150, requirements: { type: 'dip_buy', value: 20 } },
                { id: 'peak_seller', category: 'trading', tier: 'rare', title: 'Peak Seller', description: 'Sell at local high', icon: '📈', points: 150, requirements: { type: 'peak_sell' } },
                { id: 'stop_loss_saver', category: 'trading', tier: 'rare', title: 'Stop Loss Saver', description: 'Save portfolio with stop loss', icon: '🛡️', points: 120, requirements: { type: 'stop_loss_save' } },
                { id: 'limit_order_master', category: 'trading', tier: 'rare', title: 'Limit Order Master', description: 'Use 50 limit orders', icon: '🎯', points: 100, requirements: { type: 'limit_orders', count: 50 } },
                { id: 'mev_survivor', category: 'trading', tier: 'epic', title: 'MEV Survivor', description: 'Avoid MEV attacks', icon: '🛡️', points: 300, requirements: { type: 'mev_survival' } },
                { id: 'slippage_master', category: 'trading', tier: 'rare', title: 'Slippage Master', description: 'Trade with <1% slippage', icon: '🎯', points: 100, requirements: { type: 'low_slippage', value: 1 } },
                { id: 'gas_optimizer', category: 'trading', tier: 'rare', title: 'Gas Optimizer', description: 'Save on transaction fees', icon: '⛽', points: 80, requirements: { type: 'gas_savings' } },
                { id: 'multi_dex', category: 'trading', tier: 'rare', title: 'Multi-DEX Trader', description: 'Trade on 3+ DEXs', icon: '🔀', points: 150, requirements: { type: 'dex_count', value: 3 } },
                { id: 'rug_survivor', category: 'trading', tier: 'epic', title: 'Rug Survivor', description: 'Exit before rug pull', icon: '🏃', points: 400, requirements: { type: 'rug_avoidance' } },
                { id: 'diamond_hands_loss', category: 'trading', tier: 'rare', title: 'Diamond Hands (Loss)', description: 'Hold through 50% loss', icon: '💎', points: 100, requirements: { type: 'diamond_hands_loss', value: 50 } },
                { id: 'paper_hands', category: 'trading', tier: 'rare', title: 'Paper Hands', description: 'Sell for small profit too early', icon: '📄', points: 50, requirements: { type: 'paper_hands' } },
                { id: 'fomo_buyer', category: 'trading', tier: 'rare', title: 'FOMO Buyer', description: 'Buy at ATH', icon: '😅', points: 75, requirements: { type: 'fomo_buy' } },
                { id: 'contrarian', category: 'trading', tier: 'epic', title: 'Contrarian', description: 'Profit against market sentiment', icon: '🔄', points: 350, requirements: { type: 'contrarian_profit' } },
                { id: 'pattern_trader', category: 'trading', tier: 'epic', title: 'Pattern Trader', description: 'Use technical analysis successfully', icon: '📊', points: 300, requirements: { type: 'technical_analysis' } },

                // SOCIAL ACHIEVEMENTS (20)
                { id: 'first_follow', category: 'social', tier: 'rare', title: 'Social Butterfly', description: 'Follow your first trader', icon: '🦋', points: 50, requirements: { type: 'follows', count: 1 } },
                { id: 'popular_trader', category: 'social', tier: 'rare', title: 'Popular Trader', description: 'Get 10 followers', icon: '👥', points: 100, requirements: { type: 'followers', count: 10 } },
                { id: 'influencer', category: 'social', tier: 'epic', title: 'Influencer', description: 'Get 100 followers', icon: '📢', points: 300, requirements: { type: 'followers', count: 100 } },
                { id: 'community_leader', category: 'social', tier: 'legendary', title: 'Community Leader', description: 'Get 1000 followers', icon: '👑', points: 800, nft: true, requirements: { type: 'followers', count: 1000 } },
                { id: 'first_share', category: 'social', tier: 'rare', title: 'Sharing is Caring', description: 'Share your first portfolio', icon: '🤝', points: 50, requirements: { type: 'shares', count: 1 } },
                { id: 'viral_post', category: 'social', tier: 'epic', title: 'Viral Post', description: 'Get 100+ likes on share', icon: '🔥', points: 250, requirements: { type: 'share_likes', count: 100 } },
                { id: 'helpful_trader', category: 'social', tier: 'rare', title: 'Helpful Trader', description: 'Help 5 newcomers', icon: '🤲', points: 150, requirements: { type: 'help_count', count: 5 } },
                { id: 'leaderboard_top10', category: 'social', tier: 'epic', title: 'Top 10', description: 'Reach top 10 leaderboard', icon: '🏆', points: 400, requirements: { type: 'leaderboard_rank', value: 10 } },
                { id: 'leaderboard_top3', category: 'social', tier: 'legendary', title: 'Podium Finish', description: 'Reach top 3 leaderboard', icon: '🥉', points: 600, requirements: { type: 'leaderboard_rank', value: 3 } },
                { id: 'social_champion', category: 'social', tier: 'legendary', title: 'Social Champion', description: 'Rank #1 on leaderboard', icon: '🥇', points: 1000, nft: true, requirements: { type: 'leaderboard_rank', value: 1 } },
                { id: 'mentor', category: 'social', tier: 'epic', title: 'Mentor', description: 'Be copied by 10+ traders', icon: '🎓', points: 350, requirements: { type: 'copy_traders', count: 10 } },
                { id: 'community_builder', category: 'social', tier: 'rare', title: 'Community Builder', description: 'Create trending discussion', icon: '🏗️', points: 120, requirements: { type: 'trending_post' } },
                { id: 'engagement_king', category: 'social', tier: 'rare', title: 'Engagement King', description: 'Get 500+ total interactions', icon: '💬', points: 150, requirements: { type: 'total_interactions', count: 500 } },
                { id: 'alpha_caller', category: 'social', tier: 'epic', title: 'Alpha Caller', description: 'Share winning trade before pump', icon: '📻', points: 400, requirements: { type: 'alpha_call' } },
                { id: 'verified_trader', category: 'social', tier: 'rare', title: 'Verified Trader', description: 'Get verified status', icon: '✅', points: 200, requirements: { type: 'verification' } },
                { id: 'twitter_integration', category: 'social', tier: 'rare', title: 'Twitter Connected', description: 'Connect Twitter account', icon: '🐦', points: 75, requirements: { type: 'twitter_connect' } },
                { id: 'discord_member', category: 'social', tier: 'rare', title: 'Discord Member', description: 'Join Discord community', icon: '💬', points: 75, requirements: { type: 'discord_join' } },
                { id: 'referral_master', category: 'social', tier: 'epic', title: 'Referral Master', description: 'Refer 25 new users', icon: '🎁', points: 300, requirements: { type: 'referrals', count: 25 } },
                { id: 'social_media_star', category: 'social', tier: 'legendary', title: 'Social Media Star', description: 'Featured in official posts', icon: '⭐', points: 500, nft: true, requirements: { type: 'official_feature' } },
                { id: 'community_vote', category: 'social', tier: 'rare', title: 'Democratic Trader', description: 'Participate in 10 community votes', icon: '🗳️', points: 100, requirements: { type: 'votes', count: 10 } },

                // WHALE TRACKING ACHIEVEMENTS (25)  
                { id: 'whale_watcher', category: 'whale', tier: 'rare', title: 'Whale Watcher', description: 'Follow your first whale', icon: '👁️', points: 75, requirements: { type: 'whale_follows', count: 1 } },
                { id: 'whale_hunter', category: 'whale', tier: 'rare', title: 'Whale Hunter', description: 'Follow 10 whale wallets', icon: '🔍', points: 150, requirements: { type: 'whale_follows', count: 10 } },
                { id: 'whale_expert', category: 'whale', tier: 'epic', title: 'Whale Expert', description: 'Follow 50 whale wallets', icon: '🎯', points: 300, requirements: { type: 'whale_follows', count: 50 } },
                { id: 'copy_whale', category: 'whale', tier: 'rare', title: 'Copy Cat', description: 'Copy a whale trade within 1 hour', icon: '🐱', points: 120, requirements: { type: 'whale_copy_speed', hours: 1 } },
                { id: 'whale_profit', category: 'whale', tier: 'epic', title: 'Whale Rider', description: 'Profit 100%+ copying whales', icon: '🏄', points: 400, requirements: { type: 'whale_copy_profit', value: 100 } },
                { id: 'whale_spotter', category: 'whale', tier: 'rare', title: 'Whale Spotter', description: 'Discover new whale before others', icon: '🔭', points: 150, requirements: { type: 'whale_discovery' } },
                { id: 'whale_alert_setup', category: 'whale', tier: 'rare', title: 'Alert Master', description: 'Set up 10 whale alerts', icon: '🚨', points: 100, requirements: { type: 'whale_alerts', count: 10 } },
                { id: 'big_fish', category: 'whale', tier: 'epic', title: 'Big Fish', description: 'Execute trade >100 SOL', icon: '🐟', points: 250, requirements: { type: 'large_trade', value: 100 } },
                { id: 'become_whale', category: 'whale', tier: 'legendary', title: 'Whale Ascension', description: 'Be followed as a whale by others', icon: '🐋', points: 800, nft: true, requirements: { type: 'whale_status' } },
                { id: 'whale_network', category: 'whale', tier: 'epic', title: 'Whale Network', description: 'Follow connected whale wallets', icon: '🕸️', points: 300, requirements: { type: 'whale_network' } },
                { id: 'early_whale_follow', category: 'whale', tier: 'rare', title: 'Early Adopter', description: 'Follow whale before they pump', icon: '⏰', points: 200, requirements: { type: 'early_whale_follow' } },
                { id: 'whale_tipper', category: 'whale', tier: 'rare', title: 'Whale Tipper', description: 'Share whale discovery', icon: '💡', points: 100, requirements: { type: 'whale_tip' } },
                { id: 'smart_money', category: 'whale', tier: 'epic', title: 'Smart Money', description: 'Identify smart money moves', icon: '🧠', points: 350, requirements: { type: 'smart_money_id' } },
                { id: 'whale_transaction_tracker', category: 'whale', tier: 'rare', title: 'Transaction Tracker', description: 'Track 1000 whale transactions', icon: '📊', points: 150, requirements: { type: 'whale_tx_tracked', count: 1000 } },
                { id: 'insider_trading', category: 'whale', tier: 'epic', title: 'Insider Info', description: 'Profit from whale pre-announcement', icon: '🕵️', points: 400, requirements: { type: 'insider_profit' } },
                { id: 'whale_pattern', category: 'whale', tier: 'rare', title: 'Pattern Recognition', description: 'Identify whale trading pattern', icon: '🔄', points: 150, requirements: { type: 'whale_pattern' } },
                { id: 'counter_whale', category: 'whale', tier: 'epic', title: 'Counter Whale', description: 'Profit against whale moves', icon: '⚔️', points: 350, requirements: { type: 'counter_whale' } },
                { id: 'whale_sandwich', category: 'whale', tier: 'rare', title: 'Sandwich Artist', description: 'Front-run whale transaction', icon: '🥪', points: 120, requirements: { type: 'sandwich_attack' } },
                { id: 'wash_detector', category: 'whale', tier: 'epic', title: 'Wash Detector', description: 'Identify wash trading', icon: '🔍', points: 300, requirements: { type: 'wash_detection' } },
                { id: 'whale_exit', category: 'whale', tier: 'rare', title: 'Exit Strategy', description: 'Exit before whale dump', icon: '🚪', points: 200, requirements: { type: 'whale_exit' } },
                { id: 'multi_whale', category: 'whale', tier: 'epic', title: 'Multi-Whale Tracker', description: 'Track whales across chains', icon: '⛓️', points: 400, requirements: { type: 'multi_chain_whale' } },
                { id: 'whale_behavior', category: 'whale', tier: 'rare', title: 'Behavior Analyst', description: 'Analyze whale behavior patterns', icon: '📈', points: 150, requirements: { type: 'behavior_analysis' } },
                { id: 'dark_pool', category: 'whale', tier: 'legendary', title: 'Dark Pool Detective', description: 'Uncover hidden whale trades', icon: '🕳️', points: 600, requirements: { type: 'dark_pool_detection' } },
                { id: 'whale_liquidation', category: 'whale', tier: 'rare', title: 'Liquidation Hunter', description: 'Profit from whale liquidation', icon: '💥', points: 180, requirements: { type: 'liquidation_profit' } },
                { id: 'coordinated_whale', category: 'whale', tier: 'epic', title: 'Coordination Detective', description: 'Spot coordinated whale activity', icon: '🤝', points: 350, requirements: { type: 'coordinated_detection' } },

                // ALERT ACHIEVEMENTS (15)
                { id: 'first_alert', category: 'alerts', tier: 'rare', title: 'Alert Rookie', description: 'Set your first price alert', icon: '🔔', points: 50, requirements: { type: 'alerts_created', count: 1 } },
                { id: 'alert_master', category: 'alerts', tier: 'rare', title: 'Alert Master', description: 'Set 10 price alerts', icon: '⏰', points: 100, requirements: { type: 'alerts_created', count: 10 } },
                { id: 'alert_triggered', category: 'alerts', tier: 'rare', title: 'Right On Target', description: 'First alert triggered', icon: '🎯', points: 75, requirements: { type: 'alerts_triggered', count: 1 } },
                { id: 'alert_profit', category: 'alerts', tier: 'epic', title: 'Profitable Alerts', description: 'Profit from 10 triggered alerts', icon: '💰', points: 300, requirements: { type: 'profitable_alerts', count: 10 } },
                { id: 'perfect_timing', category: 'alerts', tier: 'epic', title: 'Perfect Timing', description: 'Alert triggered at exact bottom/top', icon: '⏱️', points: 400, requirements: { type: 'perfect_timing' } },
                { id: 'early_warning', category: 'alerts', tier: 'rare', title: 'Early Warning', description: 'Alert saves from 20% loss', icon: '⚠️', points: 150, requirements: { type: 'alert_save', value: 20 } },
                { id: 'alert_chain', category: 'alerts', tier: 'rare', title: 'Alert Chain', description: '5 consecutive profitable alerts', icon: '⛓️', points: 200, requirements: { type: 'alert_chain', count: 5 } },
                { id: 'multi_token_alerts', category: 'alerts', tier: 'rare', title: 'Multi-Token Alerts', description: 'Alerts for 20+ different tokens', icon: '🌐', points: 150, requirements: { type: 'alert_tokens', count: 20 } },
                { id: 'alert_precision', category: 'alerts', tier: 'epic', title: 'Precision Trader', description: 'Alert within 1% of target', icon: '🎯', points: 250, requirements: { type: 'alert_precision', value: 1 } },
                { id: 'alert_marathon', category: 'alerts', tier: 'epic', title: 'Alert Marathon', description: '100 alerts triggered', icon: '🏃', points: 350, requirements: { type: 'alerts_triggered', count: 100 } },
                { id: 'smart_alerts', category: 'alerts', tier: 'rare', title: 'Smart Alerts', description: 'Use conditional alerts', icon: '🧠', points: 120, requirements: { type: 'conditional_alerts' } },
                { id: 'social_alerts', category: 'alerts', tier: 'rare', title: 'Social Alerter', description: 'Share alert strategies', icon: '📢', points: 100, requirements: { type: 'shared_alerts' } },
                { id: 'alert_veteran', category: 'alerts', tier: 'legendary', title: 'Alert Veteran', description: '365 days of active alerts', icon: '🗓️', points: 500, requirements: { type: 'alert_duration', days: 365 } },
                { id: 'notification_ninja', category: 'alerts', tier: 'rare', title: 'Notification Ninja', description: 'Never miss an alert notification', icon: '🥷', points: 100, requirements: { type: 'notification_perfect' } },
                { id: 'custom_alerts', category: 'alerts', tier: 'epic', title: 'Custom Alert Master', description: 'Create complex custom alerts', icon: '⚙️', points: 300, requirements: { type: 'custom_alerts' } },

                // MILESTONE ACHIEVEMENTS (15)
                { id: 'day_one', category: 'milestones', tier: 'rare', title: 'Day One', description: 'First day using Cypher', icon: '📅', points: 50, requirements: { type: 'days_active', value: 1 } },
                { id: 'week_warrior', category: 'milestones', tier: 'rare', title: 'Week Warrior', description: '7 days active', icon: '📆', points: 100, requirements: { type: 'days_active', value: 7 } },
                { id: 'monthly_user', category: 'milestones', tier: 'rare', title: 'Monthly User', description: '30 days active', icon: '🗓️', points: 200, requirements: { type: 'days_active', value: 30 } },
                { id: 'quarterly_champion', category: 'milestones', tier: 'epic', title: 'Quarterly Champion', description: '90 days active', icon: '📊', points: 400, requirements: { type: 'days_active', value: 90 } },
                { id: 'annual_legend', category: 'milestones', tier: 'legendary', title: 'Annual Legend', description: '365 days active', icon: '🏆', points: 1000, nft: true, requirements: { type: 'days_active', value: 365 } },
                { id: 'streak_7', category: 'milestones', tier: 'rare', title: '7-Day Streak', description: '7 consecutive active days', icon: '🔥', points: 150, requirements: { type: 'login_streak', value: 7 } },
                { id: 'streak_30', category: 'milestones', tier: 'epic', title: '30-Day Streak', description: '30 consecutive active days', icon: '⚡', points: 400, requirements: { type: 'login_streak', value: 30 } },
                { id: 'streak_100', category: 'milestones', tier: 'legendary', title: '100-Day Streak', description: '100 consecutive active days', icon: '💯', points: 800, nft: true, requirements: { type: 'login_streak', value: 100 } },
                { id: 'early_adopter', category: 'milestones', tier: 'legendary', title: 'Early Adopter', description: 'One of first 1000 users', icon: '🌟', points: 1000, nft: true, requirements: { type: 'user_number', value: 1000 } },
                { id: 'beta_tester', category: 'milestones', tier: 'epic', title: 'Beta Tester', description: 'Used during beta phase', icon: '🧪', points: 500, requirements: { type: 'beta_user' } },
                { id: 'feature_pioneer', category: 'milestones', tier: 'rare', title: 'Feature Pioneer', description: 'First to use new feature', icon: '🚀', points: 200, requirements: { type: 'feature_first' } },
                { id: 'bug_reporter', category: 'milestones', tier: 'rare', title: 'Bug Reporter', description: 'Report verified bug', icon: '🐛', points: 150, requirements: { type: 'bug_report' } },
                { id: 'feedback_provider', category: 'milestones', tier: 'rare', title: 'Feedback Provider', description: 'Provide valuable feedback', icon: '💬', points: 100, requirements: { type: 'feedback_given' } },
                { id: 'platform_evangelist', category: 'milestones', tier: 'epic', title: 'Platform Evangelist', description: 'Refer 100+ users', icon: '📢', points: 600, requirements: { type: 'referrals', count: 100 } },
                { id: 'cypher_og', category: 'milestones', tier: 'legendary', title: 'Cypher OG', description: 'Founding community member', icon: '👑', points: 1500, nft: true, requirements: { type: 'og_status' } },

                // SPECIAL EVENT ACHIEVEMENTS (20)
                { id: 'launch_day', category: 'special', tier: 'rare', title: 'Launch Day Hero', description: 'Active on launch day', icon: '🚀', points: 200, requirements: { type: 'launch_day' } },
                { id: 'halloween_trader', category: 'special', tier: 'rare', title: 'Halloween Trader', description: 'Trade on Halloween', icon: '🎃', points: 100, requirements: { type: 'halloween_trade' } },
                { id: 'new_year_resolution', category: 'special', tier: 'rare', title: 'New Year Resolution', description: 'First trade of the year', icon: '🎆', points: 150, requirements: { type: 'new_year_trade' } },
                { id: 'valentine_portfolio', category: 'special', tier: 'rare', title: 'Valentine Portfolio', description: 'Portfolio in green on Valentine\'s', icon: '💕', points: 100, requirements: { type: 'valentine_green' } },
                { id: 'april_fools', category: 'special', tier: 'rare', title: 'No Fool', description: 'Avoid April Fools scams', icon: '🤡', points: 150, requirements: { type: 'april_fools_safe' } },
                { id: 'christmas_gift', category: 'special', tier: 'rare', title: 'Christmas Gift', description: 'Share portfolio as gift', icon: '🎁', points: 100, requirements: { type: 'christmas_share' } },
                { id: 'summer_solstice', category: 'special', tier: 'rare', title: 'Summer Solstice', description: 'Peak trading on longest day', icon: '☀️', points: 100, requirements: { type: 'solstice_trade' } },
                { id: 'black_friday', category: 'special', tier: 'rare', title: 'Black Friday Buyer', description: 'Buy the dip on Black Friday', icon: '🛍️', points: 150, requirements: { type: 'black_friday_dip' } },
                { id: 'leap_year', category: 'special', tier: 'epic', title: 'Leap Year Legend', description: 'Trade on Feb 29th', icon: '🦘', points: 300, requirements: { type: 'leap_year_trade' } },
                { id: 'eclipse_trader', category: 'special', tier: 'epic', title: 'Eclipse Trader', description: 'Trade during solar eclipse', icon: '🌑', points: 400, requirements: { type: 'eclipse_trade' } },
                { id: 'btc_halving', category: 'special', tier: 'legendary', title: 'Halving Hero', description: 'Active during Bitcoin halving', icon: '₿', points: 500, requirements: { type: 'btc_halving' } },
                { id: 'sol_ath', category: 'special', tier: 'epic', title: 'SOL ATH Witness', description: 'Online during SOL all-time high', icon: '☀️', points: 300, requirements: { type: 'sol_ath' } },
                { id: 'market_crash', category: 'special', tier: 'epic', title: 'Crash Survivor', description: 'Survive 50% market crash', icon: '💥', points: 400, requirements: { type: 'market_crash', value: 50 } },
                { id: 'bull_run', category: 'special', tier: 'epic', title: 'Bull Run Rider', description: 'Profit in 100%+ bull run', icon: '🐂', points: 400, requirements: { type: 'bull_run', value: 100 } },
                { id: 'bear_market', category: 'special', tier: 'epic', title: 'Bear Market Hero', description: 'Profit in bear market', icon: '🐻', points: 400, requirements: { type: 'bear_profit' } },
                { id: 'flash_crash', category: 'special', tier: 'rare', title: 'Flash Crash Buyer', description: 'Buy during flash crash', icon: '⚡', points: 200, requirements: { type: 'flash_crash_buy' } },
                { id: 'memecoin_season', category: 'special', tier: 'rare', title: 'Memecoin Season', description: 'Profit in memecoin mania', icon: '🐸', points: 150, requirements: { type: 'memecoin_profit' } },
                { id: 'defi_summer', category: 'special', tier: 'epic', title: 'DeFi Summer', description: 'Participate in DeFi boom', icon: '🌞', points: 300, requirements: { type: 'defi_summer' } },
                { id: 'nft_winter', category: 'special', tier: 'rare', title: 'NFT Winter Survivor', description: 'Hold NFTs through winter', icon: '❄️', points: 200, requirements: { type: 'nft_winter' } },
                { id: 'cypher_anniversary', category: 'special', tier: 'legendary', title: 'Anniversary Celebration', description: 'Celebrate Cypher\'s 1st anniversary', icon: '🎂', points: 500, nft: true, requirements: { type: 'anniversary' } }
            ];

            // Add achievements to state
            achievements.forEach(achievement => {
                appState.achievements.set(achievement.id, achievement);
                
                // Categorize achievements
                if (!appState.achievementCategories[achievement.category]) {
                    appState.achievementCategories[achievement.category] = [];
                }
                appState.achievementCategories[achievement.category].push(achievement.id);
            });

            console.log('📊 Created', achievements.length, 'achievements across', Object.keys(appState.achievementCategories).length, 'categories');
        }

        function loadUserProfile() {
            // Load from localStorage if available
            const savedProfile = localStorage.getItem('cypherUserProfile');
            if (savedProfile) {
                try {
                    const profile = JSON.parse(savedProfile);
                    appState.userProfile = { ...appState.userProfile, ...profile };
                } catch (error) {
                    console.warn('Failed to load user profile:', error);
                }
            }
            
            // Load achievement progress
            const savedProgress = localStorage.getItem('cypherAchievementProgress');
            if (savedProgress) {
                try {
                    const progress = JSON.parse(savedProgress);
                    appState.achievementProgress = new Map(progress);
                } catch (error) {
                    console.warn('Failed to load achievement progress:', error);
                }
            }
            
            // Load unlocked achievements
            const savedAchievements = localStorage.getItem('cypherUnlockedAchievements');
            if (savedAchievements) {
                try {
                    const achievements = JSON.parse(savedAchievements);
                    appState.unlockedAchievements = new Set(achievements);
                } catch (error) {
                    console.warn('Failed to load unlocked achievements:', error);
                }
            }
            
            updateUserProfile();
        }

        function saveUserProfile() {
            try {
                localStorage.setItem('cypherUserProfile', JSON.stringify(appState.userProfile));
                localStorage.setItem('cypherAchievementProgress', JSON.stringify([...appState.achievementProgress]));
                localStorage.setItem('cypherUnlockedAchievements', JSON.stringify([...appState.unlockedAchievements]));
            } catch (error) {
                console.warn('Failed to save user profile:', error);
            }
        }

        function updateUserProfile() {
            updateElementText('displayUsername', appState.userProfile.username);
            
            const avatarEl = document.getElementById('userAvatarLarge');
            if (avatarEl) {
                const avatarIcons = {
                    user: 'fas fa-user',
                    rocket: 'fas fa-rocket', 
                    star: 'fas fa-star',
                    crown: 'fas fa-crown',
                    gem: 'fas fa-gem'
                };
                
                avatarEl.innerHTML = `<i class="${avatarIcons[appState.userProfile.avatar] || avatarIcons.user}"></i>`;
                
                if (appState.userProfile.attestationConnected) {
                    avatarEl.classList.add('verified');
                }
            }
            
            const walletDisplay = document.getElementById('userWalletDisplay');
            if (walletDisplay) {
                if (appState.wallet.connected) {
                    const shortAddress = `${appState.wallet.publicKey.slice(0, 6)}...${appState.wallet.publicKey.slice(-4)}`;
                    walletDisplay.textContent = shortAddress;
                } else {
                    walletDisplay.textContent = 'Connect wallet to claim achievements';
                }
            }
        }

        function initializeAchievementProgress() {
            // Initialize progress for all achievements
            appState.achievements.forEach((achievement, id) => {
                if (!appState.achievementProgress.has(id)) {
                    appState.achievementProgress.set(id, {
                        current: 0,
                        target: getAchievementTarget(achievement),
                        unlocked: false,
                        unlockedAt: null
                    });
                }
            });
            
            // Check for immediate unlocks (like connecting wallet)
            checkAchievementTriggers();
        }

        function getAchievementTarget(achievement) {
            const req = achievement.requirements;
            
            switch (req.type) {
                case 'wallet_connected': return 1;
                case 'portfolio_value': return req.value;
                case 'token_count': return req.value;
                case 'trade_count': return req.value;
                case 'followers': return req.count;
                case 'days_active': return req.value;
                case 'login_streak': return req.value;
                default: return 1;
            }
        }

        function checkAchievementTriggers() {
            let newUnlocks = [];
            
            // Check wallet connection achievements
            if (appState.wallet.connected) {
                newUnlocks.push(...checkAchievement('first_wallet', 1));
            }
            
            // Check portfolio achievements
            if (appState.portfolioData.length > 0) {
                const totalValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
                const tokenCount = appState.portfolioData.length;
                
                newUnlocks.push(...checkAchievement('portfolio_100', totalValue));
                newUnlocks.push(...checkAchievement('portfolio_1k', totalValue));
                newUnlocks.push(...checkAchievement('portfolio_10k', totalValue));
                newUnlocks.push(...checkAchievement('portfolio_100k', totalValue));
                newUnlocks.push(...checkAchievement('diversified_5', tokenCount));
                newUnlocks.push(...checkAchievement('diversified_10', tokenCount));
                
                // Check SOL holdings
                const solToken = appState.portfolioData.find(token => token.symbol === 'SOL');
                if (solToken) {
                    newUnlocks.push(...checkAchievement('sol_holder', solToken.amount));
                }
            }
            
            // Check social achievements
            newUnlocks.push(...checkAchievement('popular_trader', appState.socialData.followers));
            newUnlocks.push(...checkAchievement('influencer', appState.socialData.followers));
            newUnlocks.push(...checkAchievement('community_leader', appState.socialData.followers));
            
            // Check whale tracking achievements
            newUnlocks.push(...checkAchievement('whale_hunter', appState.followedWallets.size));
            newUnlocks.push(...checkAchievement('whale_expert', appState.followedWallets.size));
            
            // Process new unlocks
            if (newUnlocks.length > 0) {
                processNewAchievements(newUnlocks);
            }
        }

        function checkAchievement(achievementId, currentValue) {
            const achievement = appState.achievements.get(achievementId);
            if (!achievement) return [];
            
            const progress = appState.achievementProgress.get(achievementId);
            if (!progress || progress.unlocked) return [];
            
            // Update progress
            progress.current = Math.max(progress.current, currentValue);
            
            // Check if unlocked
            if (progress.current >= progress.target && !progress.unlocked) {
                progress.unlocked = true;
                progress.unlockedAt = Date.now();
                appState.unlockedAchievements.add(achievementId);
                
                return [achievementId];
            }
            
            return [];
        }

        function processNewAchievements(achievementIds) {
            achievementIds.forEach(id => {
                const achievement = appState.achievements.get(id);
                if (achievement) {
                    // Add to recent achievements
                    appState.recentAchievements.unshift({
                        id: id,
                        achievement: achievement,
                        unlockedAt: Date.now()
                    });
                    
                    // Keep only last 10 recent achievements
                    if (appState.recentAchievements.length > 10) {
                        appState.recentAchievements = appState.recentAchievements.slice(0, 10);
                    }
                    
                    // Show notification
                    showAchievementNotification(achievement);
                }
            });
            
            // Update UI
            updateAchievementStats();
            renderRecentAchievements();
            renderAchievements();
            
            // Save progress
            saveUserProfile();
        }

        // ===== COMPREHENSIVE ACHIEVEMENT SYSTEM =====
        function triggerAchievement(type, value = 1, metadata = {}) {
            const newUnlocks = [];
            
            // Find achievements that match this trigger
            appState.achievements.forEach((achievement, id) => {
                const req = achievement.requirements;
                
                // Skip if already unlocked
                if (appState.unlockedAchievements.has(id)) return;
                
                let shouldCheck = false;
                let currentValue = value;
                
                // Match achievement requirements to trigger types
                switch (req.type) {
                    case 'wallet_connected':
                        shouldCheck = type === 'wallet_connected';
                        break;
                    case 'portfolio_value':
                        shouldCheck = type === 'portfolio_update';
                        if (shouldCheck && appState.portfolioData.length > 0) {
                            currentValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
                        }
                        break;
                    case 'token_count':
                        shouldCheck = type === 'portfolio_update';
                        if (shouldCheck) {
                            currentValue = appState.portfolioData.length;
                        }
                        break;
                    case 'token_amount':
                        shouldCheck = type === 'portfolio_update';
                        if (shouldCheck && req.token) {
                            const token = appState.portfolioData.find(t => t.symbol === req.token);
                            currentValue = token ? token.amount : 0;
                        }
                        break;
                    case 'daily_gain':
                        shouldCheck = type === 'portfolio_update';
                        if (shouldCheck && metadata.dailyChange) {
                            currentValue = Math.abs(metadata.dailyChange);
                        }
                        break;
                    case 'weekly_gain':
                        shouldCheck = type === 'portfolio_update';
                        if (shouldCheck && metadata.weeklyChange) {
                            currentValue = Math.abs(metadata.weeklyChange);
                        }
                        break;
                    case 'monthly_gain':
                        shouldCheck = type === 'portfolio_update';
                        if (shouldCheck && metadata.monthlyChange) {
                            currentValue = Math.abs(metadata.monthlyChange);
                        }
                        break;
                    case 'alerts_created':
                        shouldCheck = type === 'alerts_created';
                        break;
                    case 'alerts_triggered':
                        shouldCheck = type === 'alert_triggered';
                        break;
                    case 'whale_follows':
                        shouldCheck = type === 'whale_follows';
                        break;
                    case 'followers':
                        shouldCheck = type === 'social_update';
                        if (shouldCheck) {
                            currentValue = appState.socialData.followers;
                        }
                        break;
                    case 'shares':
                        shouldCheck = type === 'shares';
                        break;
                    case 'days_active':
                        shouldCheck = type === 'daily_login';
                        break;
                    case 'login_streak':
                        shouldCheck = type === 'login_streak';
                        break;
                    // Add more trigger types as needed
                    default:
                        // Handle specific achievement IDs
                        if (type === id || type === achievement.id) {
                            shouldCheck = true;
                            currentValue = 1;
                        }
                        break;
                }
                
                if (shouldCheck) {
                    const unlocked = checkAchievement(id, currentValue);
                    newUnlocks.push(...unlocked);
                }
            });
            
            // Process any new unlocks
            if (newUnlocks.length > 0) {
                processNewAchievements(newUnlocks);
            }
        }

        // Enhanced achievement checking for specific events
        function checkSpecialAchievements() {
            const now = new Date();
            const today = now.toDateString();
            
            // Check time-based achievements
            if (now.getMonth() === 9 && now.getDate() === 31) { // Halloween
                triggerAchievement('halloween_trader');
            }
            
            if (now.getMonth() === 0 && now.getDate() === 1) { // New Year
                triggerAchievement('new_year_resolution');
            }
            
            if (now.getMonth() === 1 && now.getDate() === 14) { // Valentine's Day
                if (appState.portfolioData.length > 0) {
                    const totalChange = appState.portfolioData.reduce((sum, token) => 
                        sum + (token.value * token.change24h / 100), 0
                    );
                    if (totalChange > 0) {
                        triggerAchievement('valentine_portfolio');
                    }
                }
            }
            
            if (now.getMonth() === 11 && now.getDate() === 25) { // Christmas
                triggerAchievement('christmas_gift');
            }
            
            // Check portfolio-based achievements
            if (appState.portfolioData.length > 0) {
                // Check for SOL holdings
                const solToken = appState.portfolioData.find(token => token.symbol === 'SOL');
                if (solToken && solToken.amount >= 10) {
                    triggerAchievement('sol_holder');
                }
                
                // Check for diversification
                if (appState.portfolioData.length >= 5) {
                    triggerAchievement('diversified_5');
                }
                if (appState.portfolioData.length >= 10) {
                    triggerAchievement('diversified_10');
                }
                
                // Check for stablecoin holdings
                const stablecoins = ['USDC', 'USDT', 'BUSD'];
                if (appState.portfolioData.some(token => stablecoins.includes(token.symbol))) {
                    triggerAchievement('stablecoin_holder');
                }
                
                // Check for balanced portfolio
                const totalValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
                const isBalanced = appState.portfolioData.every(token => (token.value / totalValue) <= 0.4);
                if (isBalanced && appState.portfolioData.length >= 3) {
                    triggerAchievement('balanced_portfolio');
                }
            }
            
            // Check social achievements
            if (appState.socialData.followers >= 10) {
                triggerAchievement('popular_trader');
            }
            if (appState.socialData.followers >= 100) {
                triggerAchievement('influencer');
            }
            if (appState.socialData.followers >= 1000) {
                triggerAchievement('community_leader');
            }
        }

        // Enhanced portfolio update with achievement checking
        function updatePortfolioStatsWithAchievements() {
            updatePortfolioStats();
            
            // Calculate additional metrics for achievements
            if (appState.portfolioData.length > 0) {
                const totalValue = appState.portfolioData.reduce((sum, token) => sum + token.value, 0);
                const totalChange = appState.portfolioData.reduce((sum, token) => 
                    sum + (token.value * token.change24h / 100), 0
                );
                const changePercent = totalValue > 0 ? (totalChange / totalValue) * 100 : 0;
                
                // Trigger portfolio achievements
                triggerAchievement('portfolio_update', totalValue, {
                    dailyChange: changePercent,
                    weeklyChange: changePercent * 2, // Simulated weekly change
                    monthlyChange: changePercent * 5 // Simulated monthly change
                });
                
                // Check for green day achievement
                if (changePercent >= 10) {
                    triggerAchievement('green_day');
                }
                
                // Check for diamond week achievement
                if (changePercent >= 50) {
                    triggerAchievement('diamond_week');
                }
                
                // Check for moon mission achievement
                if (changePercent >= 100) {
                    triggerAchievement('moon_mission');
                }
            }
            
            checkSpecialAchievements();
        }

        // Simulate daily login and streak tracking
        function trackDailyLogin() {
            const today = new Date().toDateString();
            const lastLogin = localStorage.getItem('cypherLastLogin');
            
            if (lastLogin !== today) {
                // New day login
                localStorage.setItem('cypherLastLogin', today);
                
                const loginDays = parseInt(localStorage.getItem('cypherLoginDays') || '0') + 1;
                localStorage.setItem('cypherLoginDays', loginDays.toString());
                
                // Check login streak
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toDateString();
                
                let currentStreak = 1;
                if (lastLogin === yesterdayStr) {
                    // Continuing streak
                    currentStreak = parseInt(localStorage.getItem('cypherLoginStreak') || '1') + 1;
                } else if (lastLogin && lastLogin !== today) {
                    // Streak broken, start new
                    currentStreak = 1;
                }
                
                localStorage.setItem('cypherLoginStreak', currentStreak.toString());
                
                // Trigger achievements
                triggerAchievement('daily_login', loginDays);
                triggerAchievement('login_streak', currentStreak);
                
                // Check milestone achievements
                if (loginDays === 1) triggerAchievement('day_one');
                if (loginDays === 7) triggerAchievement('week_warrior');
                if (loginDays === 30) triggerAchievement('monthly_user');
                if (loginDays === 90) triggerAchievement('quarterly_champion');
                if (loginDays === 365) triggerAchievement('annual_legend');
                
                // Check streak achievements
                if (currentStreak === 7) triggerAchievement('streak_7');
                if (currentStreak === 30) triggerAchievement('streak_30');
                if (currentStreak === 100) triggerAchievement('streak_100');
            }
        }

        // Simulate trading activity for achievements
        function simulateTradeActivity() {
            // This would be called when actual trades occur
            const tradeCount = parseInt(localStorage.getItem('cypherTradeCount') || '0') + 1;
            localStorage.setItem('cypherTradeCount', tradeCount.toString());
            
            triggerAchievement('trade_count', tradeCount);
            
            if (tradeCount === 1) triggerAchievement('first_trade');
            if (tradeCount === 10) triggerAchievement('active_trader');
            if (tradeCount === 100) triggerAchievement('veteran_trader');
            if (tradeCount === 1000) triggerAchievement('trade_master');
            
            // Simulate profitable trade (random for demo)
            if (Math.random() > 0.4) { // 60% chance of profit
                const profitableTrades = parseInt(localStorage.getItem('cypherProfitableTrades') || '0') + 1;
                localStorage.setItem('cypherProfitableTrades', profitableTrades.toString());
                
                if (profitableTrades === 1) triggerAchievement('profitable_trade');
                
                // Check winning streak
                const currentWinStreak = parseInt(localStorage.getItem('cypherWinStreak') || '0') + 1;
                localStorage.setItem('cypherWinStreak', currentWinStreak.toString());
                
                if (currentWinStreak === 5) triggerAchievement('winning_streak_5');
                if (currentWinStreak === 10) triggerAchievement('winning_streak_10');
            } else {
                // Reset winning streak on loss
                localStorage.setItem('cypherWinStreak', '0');
            }
        }

        // Enhanced initialization with achievement tracking
        function initializeAchievementSystemEnhanced() {
            initializeAchievementSystem();
            
            // Track daily login
            trackDailyLogin();
            
            // Check for launch day achievement
            const launchDate = '2024-01-01'; // Set your actual launch date
            const today = new Date().toISOString().split('T')[0];
            if (today === launchDate) {
                triggerAchievement('launch_day');
            }
            
            // Check for early adopter status (first 1000 users)
            const userNumber = Math.floor(Math.random() * 2000) + 1; // Simulate user number
            if (userNumber <= 1000) {
                triggerAchievement('early_adopter');
            }
            
            // Set up periodic achievement checks
            setInterval(() => {
                checkSpecialAchievements();
                if (appState.wallet.connected) {
                    updatePortfolioStatsWithAchievements();
                }
            }, 60000); // Check every minute
        }

        // ===== ACHIEVEMENT SIMULATION FUNCTIONS (FOR DEMO) =====
        function simulatePortfolioGrowth() {
            if (!appState.wallet.connected) {
                showToast('🔗 Connect wallet first to simulate portfolio growth');
                return;
            }
            
            // Simulate portfolio value increase
            appState.portfolioData.forEach(token => {
                const growthFactor = 1 + (Math.random() * 0.3); // Up to 30% growth
                token.value *= growthFactor;
                token.price *= growthFactor;
                token.change24h = (growthFactor - 1) * 100;
            });
            
            updatePortfolioStatsWithAchievements();
            renderTokenList();
            
            showToast('📈 Simulated portfolio growth!');
        }

        function simulateSocialGrowth() {
            const followersGained = Math.floor(Math.random() * 50) + 10;
            appState.socialData.followers += followersGained;
            
            triggerAchievement('social_update');
            updateSocialStats();
            
            showToast(`👥 Gained ${followersGained} followers!`);
        }

        function simulateWhaleActivity() {
            // Add a random whale to follow list
            const whaleNames = ['Crypto Whale', 'DeFi Master', 'Token Hunter', 'Yield Farmer', 'Smart Money'];
            const randomName = whaleNames[Math.floor(Math.random() * whaleNames.length)];
            const randomAddress = 'Demo' + Math.random().toString(36).substr(2, 9);
            
            const walletData = {
                address: randomAddress,
                nickname: randomName,
                alertOnBuy: true,
                alertOnSell: true,
                alertOnTransfer: false,
                followedAt: Date.now(),
                lastActivity: Date.now()
            };
            
            appState.followedWallets.set(randomAddress, walletData);
            
            triggerAchievement('whale_follows', appState.followedWallets.size);
            renderFollowedWallets();
            updateWhaleStats();
            
            showToast(`🐋 Now following ${randomName}!`);
        }

        function simulateSpecialEvent() {
            // Randomly trigger a special achievement
            const specialAchievements = [
                'launch_day', 'halloween_trader', 'valentine_portfolio', 
                'christmas_gift', 'early_adopter', 'beta_tester'
            ];
            
            const randomAchievement = specialAchievements[Math.floor(Math.random() * specialAchievements.length)];
            triggerAchievement(randomAchievement);
            
            showToast('✨ Special event achievement triggered!');
        }

        function resetAchievements() {
            if (confirm('⚠️ Are you sure you want to reset all achievement progress? This cannot be undone.')) {
                // Clear all achievement data
                appState.unlockedAchievements.clear();
                appState.achievementProgress.clear();
                appState.recentAchievements = [];
                appState.attestationService.attestedAchievements.clear();
                
                // Clear localStorage
                localStorage.removeItem('cypherUnlockedAchievements');
                localStorage.removeItem('cypherAchievementProgress');
                localStorage.removeItem('cypherTradeCount');
                localStorage.removeItem('cypherProfitableTrades');
                localStorage.removeItem('cypherWinStreak');
                localStorage.removeItem('cypherLoginDays');
                localStorage.removeItem('cypherLoginStreak');
                
                // Reinitialize
                initializeAchievementProgress();
                updateAchievementStats();
                renderAchievements();
                renderRecentAchievements();
                
                showToast('🔄 All achievement progress reset!');
            }
        }

        // Add some achievement unlock animations
        function showAchievementUnlockAnimation(achievement) {
            // Create floating achievement notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, rgba(255, 107, 107, 0.95), rgba(78, 205, 196, 0.95));
                color: white;
                padding: 2rem;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                text-align: center;
                z-index: 10000;
                animation: achievementUnlock 3s ease-out forwards;
                pointer-events: none;
            `;
            
            const tierEmoji = {
                'rare': '🏅',
                'epic': '🎖️',
                'legendary': '🏆'
            };
            
            notification.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">${achievement.icon}</div>
                <h2 style="margin: 0 0 0.5rem 0; font-size: 1.5rem;">Achievement Unlocked!</h2>
                <h3 style="margin: 0 0 0.5rem 0; color: #4ecdc4;">${achievement.title}</h3>
                <p style="margin: 0; opacity: 0.9;">${achievement.description}</p>
                <div style="margin-top: 1rem; font-size: 0.9rem;">
                    ${tierEmoji[achievement.tier]} ${achievement.tier.toUpperCase()} • ${achievement.points} points
                </div>
            `;
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes achievementUnlock {
                    0% {
                        opacity: 0;
                        transform: translate(-50%, -50%) scale(0.5);
                    }
                    20% {
                        opacity: 1;
                        transform: translate(-50%, -50%) scale(1.1);
                    }
                    25% {
                        transform: translate(-50%, -50%) scale(1);
                    }
                    80% {
                        opacity: 1;
                        transform: translate(-50%, -50%) scale(1);
                    }
                    100% {
                        opacity: 0;
                        transform: translate(-50%, -50%) scale(0.8);
                    }
                }
            `;
            
            document.head.appendChild(style);
            document.body.appendChild(notification);
            
            // Remove after animation
            setTimeout(() => {
                document.body.removeChild(notification);
                document.head.removeChild(style);
            }, 3000);
        }

        // Enhanced notification function
        function showAchievementNotification(achievement) {
            const tierEmoji = {
                'rare': '🏅',
                'epic': '🎖️', 
                'legendary': '🏆'
            };
            
            // Show animated popup for rare+ achievements
            if (achievement.tier !== 'common') {
                showAchievementUnlockAnimation(achievement);
            }
            
            showToast(`${tierEmoji[achievement.tier]} Achievement Unlocked: ${achievement.title}!`);
            
            // Browser notification if permitted
            if (Notification.permission === 'granted') {
                new Notification('Achievement Unlocked!', {
                    body: `${achievement.title} - ${achievement.description}`,
                    icon: '/favicon.ico'
                });
            }
            
            // Play achievement sound (if available)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmgUBCtXnJ+y4Osd');
                audio.volume = 0.3;
                audio.play().catch(() => {}); // Ignore errors if audio fails
            } catch (error) {
                // Audio not supported, continue silently
            }
        }

        function showAchievementNotification(achievement) {
            const tierEmoji = {
                'rare': '🏅',
                'epic': '🎖️', 
                'legendary': '🏆'
            };
            
            showToast(`${tierEmoji[achievement.tier]} Achievement Unlocked: ${achievement.title}!`);
            
            // Browser notification if permitted
            if (Notification.permission === 'granted') {
                new Notification('Achievement Unlocked!', {
                    body: `${achievement.title} - ${achievement.description}`,
                    icon: '/favicon.ico'
                });
            }
        }

        function updateAchievementStats() {
            const unlockedCount = appState.unlockedAchievements.size;
            const totalCount = appState.achievements.size;
            const completionRate = totalCount > 0 ? (unlockedCount / totalCount * 100).toFixed(1) : 0;
            
            // Count by tier
            let rareCount = 0, epicCount = 0, legendaryCount = 0, attestedCount = 0;
            let totalPoints = 0;
            
            appState.unlockedAchievements.forEach(id => {
                const achievement = appState.achievements.get(id);
                if (achievement) {
                    totalPoints += achievement.points;
                    
                    switch (achievement.tier) {
                        case 'rare': rareCount++; break;
                        case 'epic': epicCount++; break;
                        case 'legendary': legendaryCount++; break;
                    }
                    
                    if (appState.attestationService.attestedAchievements.has(id)) {
                        attestedCount++;
                    }
                }
            });
            
            // Update main stats
            updateElementText('totalAchievements', unlockedCount);
            updateElementText('achievementPoints', totalPoints.toLocaleString());
            updateElementText('userRank', '#' + (1000 - Math.floor(totalPoints / 10))); // Mock ranking
            updateElementText('completionRate', completionRate + '%');
            
            // Update tier stats
            updateElementText('rareAchievements', rareCount);
            updateElementText('epicAchievements', epicCount);
            updateElementText('legendaryAchievements', legendaryCount);
            updateElementText('attestedAchievements', attestedCount);
            
            // Update progress texts
            const rareTier = Array.from(appState.achievements.values()).filter(a => a.tier === 'rare');
            const epicTier = Array.from(appState.achievements.values()).filter(a => a.tier === 'epic');
            const legendaryTier = Array.from(appState.achievements.values()).filter(a => a.tier === 'legendary');
            
            updateElementText('rareProgressText', `${rareCount}/${rareTier.length}`);
            updateElementText('epicProgressText', `${epicCount}/${epicTier.length}`);
            updateElementText('legendaryProgressText', `${legendaryCount}/${legendaryTier.length}`);
            updateElementText('attestationProgressText', `${attestedCount}/${legendaryCount}`);
            
            // Update progress bars
            updateProgressBar('rareProgress', rareCount, rareTier.length);
            updateProgressBar('epicProgress', epicCount, epicTier.length);
            updateProgressBar('legendaryProgress', legendaryCount, legendaryTier.length);
            updateProgressBar('attestationProgress', attestedCount, legendaryCount || 1);
        }

        function updateProgressBar(elementId, current, total) {
            const element = document.getElementById(elementId);
            if (element) {
                const percentage = total > 0 ? (current / total * 100) : 0;
                element.style.width = percentage + '%';
            }
        }

        function renderAchievements(filter = 'all', category = 'all') {
            const container = document.getElementById('achievementsList');
            if (!container) return;
            
            // Get filtered achievements
            let achievements = Array.from(appState.achievements.values());
            
            // Apply category filter
            if (category !== 'all') {
                achievements = achievements.filter(a => a.category === category);
            }
            
            // Apply tier/status filter
            switch (filter) {
                case 'rare':
                    achievements = achievements.filter(a => a.tier === 'rare');
                    break;
                case 'epic':
                    achievements = achievements.filter(a => a.tier === 'epic');
                    break;
                case 'legendary':
                    achievements = achievements.filter(a => a.tier === 'legendary');
                    break;
                case 'completed':
                    achievements = achievements.filter(a => appState.unlockedAchievements.has(a.id));
                    break;
                case 'incomplete':
                    achievements = achievements.filter(a => !appState.unlockedAchievements.has(a.id));
                    break;
            }
            
            // Sort achievements (completed first, then by tier, then by points)
            achievements.sort((a, b) => {
                const aUnlocked = appState.unlockedAchievements.has(a.id);
                const bUnlocked = appState.unlockedAchievements.has(b.id);
                
                if (aUnlocked && !bUnlocked) return -1;
                if (!aUnlocked && bUnlocked) return 1;
                
                const tierOrder = { legendary: 3, epic: 2, rare: 1 };
                const tierDiff = tierOrder[b.tier] - tierOrder[a.tier];
                if (tierDiff !== 0) return tierDiff;
                
                return b.points - a.points;
            });
            
            container.innerHTML = '';
            
            achievements.forEach(achievement => {
                const achievementCard = document.createElement('div');
                const isUnlocked = appState.unlockedAchievements.has(achievement.id);
                const progress = appState.achievementProgress.get(achievement.id);
                
                achievementCard.className = `achievement-card ${achievement.tier} ${isUnlocked ? 'completed' : 'locked'}`;
                achievementCard.onclick = () => showAchievementDetail(achievement.id);
                
                const progressPercent = progress ? Math.min((progress.current / progress.target) * 100, 100) : 0;
                
                achievementCard.innerHTML = `
                    <div class="achievement-header">
                        <div class="achievement-icon ${achievement.tier} ${isUnlocked ? 'completed' : ''}">
                            ${achievement.icon}
                        </div>
                        <div class="achievement-details">
                            <h4>${achievement.title}</h4>
                            <div class="achievement-tier ${achievement.tier}">${achievement.tier.toUpperCase()}</div>
                            <div class="achievement-description">${achievement.description}</div>
                        </div>
                    </div>
                    
                    ${!isUnlocked ? `
                        <div class="achievement-progress">
                            <div class="achievement-progress-text">
                                <span>Progress</span>
                                <span>${progress ? progress.current : 0}/${progress ? progress.target : 1}</span>
                            </div>
                            <div class="achievement-progress-bar">
                                <div class="achievement-progress-fill ${achievement.tier}" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="achievement-rewards">
                        <div class="achievement-points">
                            <i class="fas fa-star"></i>
                            <span>${achievement.points} points</span>
                        </div>
                        <div class="achievement-badges">
                            ${achievement.nft ? '<div class="achievement-badge nft">NFT</div>' : ''}
                            ${isUnlocked && appState.attestationService.attestedAchievements.has(achievement.id) ? '<div class="achievement-badge attestation">Attested</div>' : ''}
                        </div>
                    </div>
                `;
                
                container.appendChild(achievementCard);
            });
            
            if (achievements.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-trophy"></i>
                        <p>No achievements match your filters</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem; color: #888;">Try adjusting your filter settings</p>
                    </div>
                `;
            }
        }

        function renderRecentAchievements() {
            const container = document.getElementById('recentAchievements');
            if (!container) return;
            
            if (appState.recentAchievements.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <p>No achievements unlocked yet</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Start trading and using the platform to unlock achievements!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            appState.recentAchievements.slice(0, 5).forEach(recent => {
                const achievement = recent.achievement;
                const recentItem = document.createElement('div');
                recentItem.className = 'recent-achievement-item';
                recentItem.onclick = () => showAchievementDetail(achievement.id);
                
                const tierColors = {
                    rare: 'linear-gradient(45deg, #3498db, #2980b9)',
                    epic: 'linear-gradient(45deg, #9b59b6, #8e44ad)', 
                    legendary: 'linear-gradient(45deg, #f39c12, #e67e22)'
                };
                
                recentItem.innerHTML = `
                    <div class="recent-achievement-icon" style="background: ${tierColors[achievement.tier]}">
                        ${achievement.icon}
                    </div>
                    <div class="recent-achievement-info">
                        <h5>${achievement.title}</h5>
                        <p>${achievement.description}</p>
                    </div>
                    <div class="recent-achievement-time">
                        ${getTimeAgo(recent.unlockedAt)}
                    </div>
                `;
                
                container.appendChild(recentItem);
            });
        }

        // ===== ACHIEVEMENT UI FUNCTIONS =====
        function openUsernameModal() {
            document.getElementById('usernameModal').classList.add('show');
            document.getElementById('newUsername').value = appState.userProfile.username === 'Anonymous Trader' ? '' : appState.userProfile.username;
            
            // Update form with current settings
            document.getElementById('publicProfile').checked = appState.userProfile.publicProfile;
            document.getElementById('showAchievements').checked = appState.userProfile.showAchievements;
            document.getElementById('allowFollowing').checked = appState.userProfile.allowFollowing;
            
            // Set current avatar
            document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`[data-style="${appState.userProfile.avatar}"]`)?.classList.add('active');
        }

        function closeUsernameModal() {
            document.getElementById('usernameModal').classList.remove('show');
        }

        function selectAvatarStyle(style) {
            document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`[data-style="${style}"]`).classList.add('active');
        }

        function updateUsername(event) {
            event.preventDefault();
            
            const newUsername = document.getElementById('newUsername').value.trim();
            
            // Validate username
            if (newUsername.length < 3 || newUsername.length > 20) {
                showToast('❌ Username must be 3-20 characters');
                return;
            }
            
            if (!/^[a-zA-Z0-9_]+$/.test(newUsername)) {
                showToast('❌ Username can only contain letters, numbers, and underscores');
                return;
            }
            
            // Update profile
            const selectedAvatar = document.querySelector('.avatar-option.active')?.dataset.style || 'user';
            
            appState.userProfile.username = newUsername;
            appState.userProfile.avatar = selectedAvatar;
            appState.userProfile.publicProfile = document.getElementById('publicProfile').checked;
            appState.userProfile.showAchievements = document.getElementById('showAchievements').checked;
            appState.userProfile.allowFollowing = document.getElementById('allowFollowing').checked;
            
            // Save and update UI
            saveUserProfile();
            updateUserProfile();
            closeUsernameModal();
            
            showToast('✅ Profile updated successfully!');
            
            // Check for achievement
            checkAchievementTriggers();
        }

        function filterAchievements() {
            const filter = document.getElementById('achievementFilter')?.value || 'all';
            const category = document.getElementById('categoryFilter')?.value || 'all';
            
            renderAchievements(filter, category);
        }

        function switchAchievementTab(category) {
            // Update active tab
            document.querySelectorAll('.achievement-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-category="${category}"]`)?.classList.add('active');
            
            // Update filter and render
            if (document.getElementById('categoryFilter')) {
                document.getElementById('categoryFilter').value = category;
            }
            
            renderAchievements('all', category);
        }

        function showAchievementDetail(achievementId) {
            const achievement = appState.achievements.get(achievementId);
            if (!achievement) return;
            
            const progress = appState.achievementProgress.get(achievementId);
            const isUnlocked = appState.unlockedAchievements.has(achievementId);
            const isAttested = appState.attestationService.attestedAchievements.has(achievementId);
            
            const modal = document.getElementById('achievementModal');
            const detailsContainer = document.getElementById('achievementDetails');
            
            const tierColors = {
                rare: '#3498db',
                epic: '#9b59b6',
                legendary: '#f39c12'
            };
            
            const progressPercent = progress ? Math.min((progress.current / progress.target) * 100, 100) : 0;
            
            detailsContainer.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="achievement-icon ${achievement.tier} ${isUnlocked ? 'completed' : ''}" style="width: 80px; height: 80px; font-size: 2rem;">
                        ${achievement.icon}
                    </div>
                    <div>
                        <h2 style="margin: 0; color: #ffffff;">${achievement.title}</h2>
                        <div style="color: ${tierColors[achievement.tier]}; font-weight: 600; text-transform: uppercase; margin: 0.5rem 0;">
                            ${achievement.tier} Achievement
                        </div>
                        <p style="color: #888; margin: 0; font-size: 1.1rem;">${achievement.description}</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div class="token-stat-item">
                        <div class="token-stat-value">${achievement.points}</div>
                        <div class="token-stat-label">Points</div>
                    </div>
                    <div class="token-stat-item">
                        <div class="token-stat-value">${achievement.category}</div>
                        <div class="token-stat-label">Category</div>
                    </div>
                    <div class="token-stat-item">
                        <div class="token-stat-value">${isUnlocked ? 'Unlocked' : 'Locked'}</div>
                        <div class="token-stat-label">Status</div>
                    </div>
                    ${achievement.nft ? `
                        <div class="token-stat-item">
                            <div class="token-stat-value">NFT</div>
                            <div class="token-stat-label">Mintable</div>
                        </div>
                    ` : ''}
                </div>
                
                ${!isUnlocked ? `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: #ffffff;">Progress</h4>
                        <div class="achievement-progress-text" style="margin-bottom: 0.5rem;">
                            <span>Current Progress</span>
                            <span>${progress ? progress.current : 0}/${progress ? progress.target : 1}</span>
                        </div>
                        <div class="achievement-progress-bar" style="height: 10px;">
                            <div class="achievement-progress-fill ${achievement.tier}" style="width: ${progressPercent}%"></div>
                        </div>
                        <p style="color: #888; font-size: 0.9rem; margin-top: 0.5rem;">
                            ${getAchievementProgressDescription(achievement, progress)}
                        </p>
                    </div>
                ` : `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: #4ecdc4;">✓ Achievement Unlocked!</h4>
                        <p style="color: #888;">
                            Unlocked on ${new Date(progress?.unlockedAt || Date.now()).toLocaleDateString()}
                            ${isAttested ? ' • Attested on blockchain' : ''}
                        </p>
                    </div>
                `}
                
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    ${isUnlocked && achievement.nft && !isAttested ? `
                        <button class="btn btn-primary" onclick="mintAchievementNFT('${achievementId}')">
                            <i class="fas fa-coins"></i> Mint as NFT
                        </button>
                    ` : ''}
                    ${isUnlocked && !isAttested ? `
                        <button class="btn btn-secondary" onclick="attestSingleAchievement('${achievementId}')">
                            <i class="fas fa-certificate"></i> Attest on Chain
                        </button>
                    ` : ''}
                    <button class="btn btn-secondary" onclick="shareAchievement('${achievementId}')">
                        <i class="fas fa-share"></i> Share Achievement
                    </button>
                </div>
            `;
            
            modal.classList.add('show');
        }

        function closeAchievementModal() {
            document.getElementById('achievementModal').classList.remove('show');
        }

        function getAchievementProgressDescription(achievement, progress) {
            const req = achievement.requirements;
            const remaining = progress ? Math.max(0, progress.target - progress.current) : 1;
            
            switch (req.type) {
                case 'portfolio_value':
                    return `Increase your portfolio value by ${remaining.toLocaleString()} more.`;
                case 'token_count':
                    return `Add ${remaining} more token${remaining === 1 ? '' : 's'} to your portfolio.`;
                case 'trade_count':
                    return `Execute ${remaining} more trade${remaining === 1 ? '' : 's'}.`;
                case 'followers':
                    return `Gain ${remaining} more follower${remaining === 1 ? '' : 's'}.`;
                case 'days_active':
                    return `Stay active for ${remaining} more day${remaining === 1 ? '' : 's'}.`;
                case 'whale_follows':
                    return `Follow ${remaining} more whale wallet${remaining === 1 ? '' : 's'}.`;
                default:
                    return 'Keep using the platform to unlock this achievement.';
            }
        }

        // ===== SOLANA ATTESTATION SERVICE =====
        function connectAttestationService() {
            showToast('🔗 Connecting to Solana Attestation Service...');
            
            // Simulate connection process
            setTimeout(() => {
                appState.attestationService.connected = true;
                appState.userProfile.attestationConnected = true;
                
                updateAttestationStatus();
                saveUserProfile();
                updateUserProfile();
                
                showToast('✅ Connected to Solana Attestation Service!');
                
                // Check for attestation achievement
                const attestableCount = Array.from(appState.unlockedAchievements).filter(id => {
                    const achievement = appState.achievements.get(id);
                    return achievement && achievement.tier === 'legendary';
                }).length;
                
                updateElementText('attestableCount', attestableCount);
                
            }, 2000);
        }

        function updateAttestationStatus() {
            const statusEl = document.getElementById('attestationStatus');
            if (statusEl) {
                if (appState.attestationService.connected) {
                    statusEl.innerHTML = `
                        <div class="status-dot online"></div>
                        <span>Connected</span>
                    `;
                } else {
                    statusEl.innerHTML = `
                        <div class="status-dot offline"></div>
                        <span>Not Connected</span>
                    `;
                }
            }
        }

        function verifyOnAttestation() {
            if (!appState.attestationService.connected) {
                showToast('❌ Connect to Attestation Service first');
                return;
            }
            
            const legendaryAchievements = Array.from(appState.unlockedAchievements).filter(id => {
                const achievement = appState.achievements.get(id);
                return achievement && achievement.tier === 'legendary' && !appState.attestationService.attestedAchievements.has(id);
            });
            
            if (legendaryAchievements.length === 0) {
                showToast('📜 No legendary achievements to attest');
                return;
            }
            
            showToast(`🛡️ Attesting ${legendaryAchievements.length} legendary achievements...`);
            
            // Simulate attestation process
            setTimeout(() => {
                legendaryAchievements.forEach(id => {
                    appState.attestationService.attestedAchievements.add(id);
                });
                
                updateAchievementStats();
                renderAchievements();
                saveUserProfile();
                
                showToast(`✅ ${legendaryAchievements.length} achievements attested on blockchain!`);
            }, 3000);
        }

        function attestSingleAchievement(achievementId) {
            if (!appState.attestationService.connected) {
                connectAttestationService();
                return;
            }
            
            const achievement = appState.achievements.get(achievementId);
            if (!achievement || !appState.unlockedAchievements.has(achievementId)) {
                showToast('❌ Achievement not unlocked');
                return;
            }
            
            showToast('🛡️ Attesting achievement on blockchain...');
            
            setTimeout(() => {
                appState.attestationService.attestedAchievements.add(achievementId);
                updateAchievementStats();
                closeAchievementModal();
                showToast(`✅ ${achievement.title} attested on blockchain!`);
                saveUserProfile();
            }, 2000);
        }

        function viewAttestationHistory() {
            const attestedAchievements = Array.from(appState.attestationService.attestedAchievements).map(id => 
                appState.achievements.get(id)
            ).filter(Boolean);
            
            if (attestedAchievements.length === 0) {
                showToast('📜 No attested achievements yet');
                return;
            }
            
            console.log('🛡️ Attested Achievements:', attestedAchievements);
            showToast(`📜 ${attestedAchievements.length} achievements attested - check console`);
        }

        // ===== NFT MINTING FUNCTIONS =====
        function mintNFTCollection() {
            const mintableAchievements = Array.from(appState.unlockedAchievements)
                .map(id => appState.achievements.get(id))
                .filter(achievement => achievement && achievement.nft);
            
            if (mintableAchievements.length === 0) {
                showToast('🖼️ No legendary achievements to mint as NFTs');
                return;
            }
            
            openNFTMintModal(mintableAchievements);
        }

        function openNFTMintModal(achievements) {
            const modal = document.getElementById('nftMintModal');
            const container = document.getElementById('mintableAchievements');
            
            container.innerHTML = '';
            
            achievements.forEach(achievement => {
                const mintItem = document.createElement('div');
                mintItem.className = 'mintable-achievement';
                
                const mintCost = achievement.tier === 'legendary' ? '0.1 SOL' : '0.05 SOL';
                
                mintItem.innerHTML = `
                    <input type="checkbox" class="mint-checkbox" data-achievement="${achievement.id}">
                    <div class="achievement-icon ${achievement.tier} completed" style="width: 50px; height: 50px; font-size: 1.2rem;">
                        ${achievement.icon}
                    </div>
                    <div style="flex: 1;">
                        <h5 style="margin: 0; color: #ffffff;">${achievement.title}</h5>
                        <p style="margin: 0; color: #888; font-size: 0.8rem;">${achievement.description}</p>
                    </div>
                    <div class="mint-cost">${mintCost}</div>
                `;
                
                container.appendChild(mintItem);
            });
            
            modal.classList.add('show');
        }

        function closeNFTMintModal() {
            document.getElementById('nftMintModal').classList.remove('show');
        }

        function mintSelectedNFTs() {
            const selectedCheckboxes = document.querySelectorAll('.mint-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showToast('❌ Select achievements to mint');
                return;
            }
            
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.achievement);
            const totalCost = selectedIds.length * 0.1; // Simplified cost calculation
            
            showToast(`🎨 Minting ${selectedIds.length} NFTs for ${totalCost} SOL...`);
            
            // Simulate minting process
            setTimeout(() => {
                selectedIds.forEach(id => {
                    const achievement = appState.achievements.get(id);
                    if (achievement) {
                        console.log(`🎨 Minted NFT for ${achievement.title}`);
                    }
                });
                
                closeNFTMintModal();
                showToast(`✅ Successfully minted ${selectedIds.length} achievement NFTs!`);
            }, 3000);
        }

        function mintAchievementNFT(achievementId) {
            const achievement = appState.achievements.get(achievementId);
            if (!achievement || !achievement.nft) {
                showToast('❌ Achievement not eligible for NFT minting');
                return;
            }
            
            showToast(`🎨 Minting ${achievement.title} as NFT...`);
            
            setTimeout(() => {
                showToast(`✅ ${achievement.title} NFT minted successfully!`);
                closeAchievementModal();
            }, 2000);
        }

        // ===== SOCIAL SHARING =====
        function shareAchievements() {
            const unlockedCount = appState.unlockedAchievements.size;
            const totalPoints = Array.from(appState.unlockedAchievements)
                .map(id => appState.achievements.get(id))
                .filter(Boolean)
                .reduce((sum, achievement) => sum + achievement.points, 0);
            
            const legendaryCount = Array.from(appState.unlockedAchievements)
                .map(id => appState.achievements.get(id))
                .filter(achievement => achievement && achievement.tier === 'legendary')
                .length;
            
            let shareText = `🏆 Check out my Cypher achievements!\n\n`;
            shareText += `📊 ${unlockedCount} achievements unlocked\n`;
            shareText += `⭐ ${totalPoints.toLocaleString()} points earned\n`;
            if (legendaryCount > 0) {
                shareText += `👑 ${legendaryCount} legendary achievement${legendaryCount === 1 ? '' : 's'}!\n`;
            }
            shareText += `\n#CypherAnalytics #SolanaAchievements #DeFi`;
            
            const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;
            window.open(shareUrl, '_blank');
            
            showToast('🐦 Achievement profile shared!');
        }

        function shareAchievement(achievementId) {
            const achievement = appState.achievements.get(achievementId);
            if (!achievement) return;
            
            const isUnlocked = appState.unlockedAchievements.has(achievementId);
            
            let shareText = `🏆 Achievement ${isUnlocked ? 'Unlocked' : 'Progress'}: ${achievement.title}!\n\n`;
            shareText += `${achievement.icon} ${achievement.description}\n`;
            shareText += `⭐ ${achievement.points} points\n`;
            shareText += `🎯 ${achievement.tier.toUpperCase()} tier\n\n`;
            shareText += `#CypherAnalytics #Achievement #Solana`;
            
            const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;
            window.open(shareUrl, '_blank');
            
            showToast('🐦 Achievement shared!');
        }

        // ===== NAVIGATION FUNCTIONS =====
        function switchSection(sectionName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-section="${sectionName}"]`)?.classList.add('active');
            
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.getElementById(sectionName)?.classList.add('active');
            
            // Load section-specific data
            if (sectionName === 'whale') {
                renderWhaleMovements();
                renderFollowedWallets();
            } else if (sectionName === 'social') {
                renderSocialLeaderboard();
                renderTrendingTraders();
                renderCommunityActivity();
                updatePortfolioSnapshot();
            } else if (sectionName === 'achievements') {
                updateAchievementStats();
                renderAchievements();
                renderRecentAchievements();
                updateAttestationStatus();
            }
            
            console.log(`📱 Switched to ${sectionName} section`);
        }

        function toggleNotificationPanel() {
            showToast('🔔 Notifications panel coming soon!');
        }

        // ===== UTILITY FUNCTIONS =====
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            return Math.floor(diff / 86400000) + 'd ago';
        }

        // ===== UTILITY FUNCTIONS =====
        function updateAPIStatus(status, isOnline = null) {
            const statusEl = document.getElementById('apiStatus');
            if (!statusEl) return;
            
            statusEl.className = `api-status ${isOnline === true ? 'online' : isOnline === false ? 'offline' : ''}`;
            statusEl.innerHTML = `
                <div class="api-dot"></div>
                <span>${status}</span>
            `;
        }

        function showToast(message) {
            const toast = document.getElementById('toastNotification');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function updateElementText(id, text) {
            const element = document.getElementById(id);
            if (element) element.textContent = text;
        }

        function formatNumber(num) {
            if (num >= 1e9) return '$' + (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return '$' + (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return '$' + (num / 1e3).toFixed(1) + 'K';
            return '$' + num.toFixed(0);
        }

        function formatPrice(price) {
            if (price >= 1) return price.toFixed(2);
            if (price >= 0.01) return price.toFixed(4);
            if (price >= 0.0001) return price.toFixed(6);
            return price.toExponential(2);
        }

        function formatTokenAmount(amount) {
            if (amount >= 1000000) return (amount / 1000000).toFixed(2) + 'M';
            if (amount >= 1000) return (amount / 1000).toFixed(2) + 'K';
            if (amount >= 1) return amount.toFixed(2);
            return amount.toFixed(6);
        }

        console.log('🎯 Cypher Analytics with real data integration loaded successfully');
    </script>
</body>
</html>